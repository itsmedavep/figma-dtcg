{
  "version": 3,
  "sources": ["../src/core/normalize.ts", "../src/core/plan.ts", "../src/core/ir.ts", "../src/adapters/dtcg-reader.ts", "../src/adapters/dtcg-writer.ts", "../src/adapters/figma-reader.ts", "../src/figma/variables.ts", "../src/adapters/figma-writer.ts", "../src/core/pipeline.ts", "../src/app/main.ts"],
  "sourcesContent": ["\nimport type { TokenGraph, TokenNode } from './ir';\n\nexport function normalize(graph: TokenGraph): TokenGraph {\n  // Here we could add: cycle detection for aliases, dedupe, etc.\n  // For now, ensure stable order and unique paths.\n  const seen = new Set<string>();\n  const tokens: TokenNode[] = [];\n  for (const t of graph.tokens) {\n    const key = t.path.join('/');\n    if (!seen.has(key)) {\n      seen.add(key);\n      tokens.push(t);\n    }\n  }\n  return { tokens };\n}\n", "\nimport type { TokenGraph, TokenNode, ValueOrAlias } from './ir';\n\nexport interface ApplyItem {\n  path: string[];\n  type: TokenNode['type'];\n  perContext: Record<string, ValueOrAlias>;\n}\nexport interface ApplyPlan { items: ApplyItem[] }\n\n/** A minimal 'plan': just upsert all tokens and set their per-context values. */\nexport function planChanges(current: TokenGraph, desired: TokenGraph): ApplyPlan {\n  // In a real diff we would compute creates/updates/deletes.\n  // For now, just adopt everything from desired.\n  return {\n    items: desired.tokens.map(t => ({\n      path: t.path,\n      type: t.type,\n      perContext: t.byContext\n    }))\n  };\n}\n", "\nexport type PrimitiveType = 'color' | 'number' | 'string' | 'boolean' | 'dimension';\n\nexport type AliasRef = { kind: 'alias'; path: string };\nexport type ColorValue = { colorSpace: 'srgb'; components: [number, number, number]; alpha?: number; hex?: string };\nexport type DimensionValue = { value: number; unit: 'px'|'rem'|'em'|'pt'|'percent' };\n\nexport type PrimitiveValue =\n  | { kind: 'color'; value: ColorValue }\n  | { kind: 'number'; value: number }\n  | { kind: 'string'; value: string }\n  | { kind: 'boolean'; value: boolean }\n  | { kind: 'dimension'; value: DimensionValue };\n\nexport type ValueOrAlias = PrimitiveValue | AliasRef;\n\nexport interface TokenNode {\n  path: string[];                     // group path + name\n  type: PrimitiveType;                // resolved type\n  byContext: Record<string, ValueOrAlias>; // 'Collection/mode=Light' => value\n  description?: string;\n  extensions?: Record<string, unknown>;\n}\n\nexport interface TokenGraph {\n  tokens: TokenNode[];\n}\n\nexport const ctxKey = (collection: string, mode: string) => `${collection}/mode=${mode}`;\nexport const tokenNameFromPath = (p: string[]) => p.join('/');\n", "import type { TokenGraph, TokenNode, PrimitiveType, ValueOrAlias } from '../core/ir';\nimport { ctxKey } from '../core/ir';\n\ntype Dict = { [key: string]: unknown };\nfunction isDict(o: unknown): o is Dict { return typeof o === 'object' && o !== null; }\n\nexport function parse(root: unknown): TokenGraph {\n  if (!isDict(root)) throw new Error('DTCG: root must be an object');\n  var tokens: Array<TokenNode> = [];\n  walkGroup(root, [], undefined, tokens);\n  return { tokens: tokens };\n}\n\nfunction walkGroup(node: unknown, path: Array<string>, inheritedType: PrimitiveType | undefined, out: Array<TokenNode>) {\n  if (!isDict(node)) return;\n  var groupType: PrimitiveType | undefined = inheritedType;\n  if (typeof node['$type'] === 'string') groupType = node['$type'] as PrimitiveType;\n\n  var key: string;\n  for (key in node) {\n    if (!Object.prototype.hasOwnProperty.call(node, key)) continue;\n    if (key.length > 0 && key.charAt(0) === '$') continue;\n\n    var value = (node as Dict)[key];\n\n    if (isDict(value)) {\n      if (hasTokenShape(value)) {\n        var t = tokenFromEntry(path.concat(key), value, groupType);\n        out.push(t);\n      } else {\n        walkGroup(value, path.concat(key), groupType, out);\n      }\n    }\n  }\n}\n\nfunction hasTokenShape(o: Dict): boolean {\n  if (Object.prototype.hasOwnProperty.call(o, '$value')) return true;\n  if (Object.prototype.hasOwnProperty.call(o, '$type')) return true;\n  if (Object.prototype.hasOwnProperty.call(o, '$description')) return true;\n  if (Object.prototype.hasOwnProperty.call(o, '$extensions')) return true;\n  return false;\n}\n\nfunction tokenFromEntry(path: Array<string>, entry: Dict, inheritedType: PrimitiveType | undefined): TokenNode {\n  var explicitType: PrimitiveType | undefined = undefined;\n  if (typeof entry['$type'] === 'string') explicitType = entry['$type'] as PrimitiveType;\n  var type: PrimitiveType | undefined = explicitType ? explicitType : inheritedType;\n  if (!type) {\n    type = guessType(entry);\n    if (!type) throw new Error('Token ' + path.join('/') + ' missing $type and cannot be inferred');\n  }\n\n  var description: string | undefined = undefined;\n  if (typeof entry['$description'] === 'string') description = String(entry['$description']);\n\n  var extensions: Record<string, unknown> | undefined = undefined;\n  if (isDict(entry['$extensions'])) extensions = entry['$extensions'] as Record<string, unknown>;\n\n  // Prefer contexts from $extensions.org.figma.valuesByContext\n  var byContext: Record<string, ValueOrAlias> = {};\n  var ctxMap = contextsFromExtensions(entry, type);\n  if (ctxMap) {\n    byContext = ctxMap;\n  } else {\n    var raw = (entry as any)['$value'];\n    var coll = 'Imported';\n    var mode = 'Default';\n    var extOrg = safeGet(entry, ['$extensions', 'org', 'figma']);\n    if (isDict(extOrg)) {\n      var cName = (extOrg as any)['collectionName'];\n      var mName = (extOrg as any)['modeName'];\n      if (typeof cName === 'string') coll = cName;\n      if (typeof mName === 'string') mode = mName;\n    }\n    byContext[ctxKey(coll, mode)] = parseValueOrAlias(raw, type);\n  }\n\n  return { path: path, type: type, byContext: byContext, description: description, extensions: extensions };\n}\n\nfunction safeGet(obj: unknown, path: Array<string>): unknown {\n  var cur: unknown = obj;\n  var i: number;\n  for (i = 0; i < path.length; i++) {\n    if (!isDict(cur)) return undefined;\n    var k = path[i];\n    if (!Object.prototype.hasOwnProperty.call(cur, k)) return undefined;\n    cur = (cur as Dict)[k];\n  }\n  return cur;\n}\n\nfunction contextsFromExtensions(entry: Dict, type: PrimitiveType): Record<string, ValueOrAlias> | null {\n  var valuesByCtx = safeGet(entry, ['$extensions', 'org', 'figma', 'valuesByContext']);\n  if (!isDict(valuesByCtx)) return null;\n\n  var byContext: Record<string, ValueOrAlias> = {};\n  var k: string;\n  for (k in valuesByCtx as Dict) {\n    if (!Object.prototype.hasOwnProperty.call(valuesByCtx, k)) continue;\n    var raw = (valuesByCtx as Dict)[k];\n    byContext[k] = parseValueOrAlias(raw, type);\n  }\n  return byContext;\n}\n\nfunction guessType(entry: Dict): PrimitiveType | undefined {\n  if (Object.prototype.hasOwnProperty.call(entry, '$value')) {\n    var v = (entry as any)['$value'];\n    if (typeof v === 'string') {\n      if (/^\\{[^}]+\\}$/.test(v)) return 'string';\n      if (/^#?[0-9a-f]{3,8}$/i.test(v)) return 'color';\n      return 'string';\n    } else if (typeof v === 'number') return 'number';\n    else if (typeof v === 'boolean') return 'boolean';\n    else if (isDict(v) && Object.prototype.hasOwnProperty.call(v, 'colorSpace')) return 'color';\n  }\n  return undefined;\n}\n\nfunction parseValueOrAlias(raw: unknown, type: PrimitiveType): ValueOrAlias {\n  if (typeof raw === 'string' && /^\\{[^}]+\\}$/.test(raw)) {\n    return { kind: 'alias', path: raw.slice(1, raw.length - 1) };\n  }\n  if (type === 'color') {\n    if (typeof raw === 'string') {\n      var hex = raw.replace(/^#/, '');\n      var rgb: Array<number> | null = null;\n      if (hex.length === 3) {\n        rgb = [0, 1, 2].map(function (i) { var c = hex.charAt(i); return parseInt(c + c, 16) / 255; });\n      } else if (hex.length === 6 || hex.length === 8) {\n        rgb = [0, 1, 2].map(function (i) { return parseInt(hex.slice(i * 2, i * 2 + 2), 16) / 255; });\n      }\n      var alpha: number | undefined = undefined;\n      if (hex.length === 8) alpha = parseInt(hex.slice(6, 8), 16) / 255;\n      if (!rgb) throw new Error('Unsupported hex color: ' + String(raw));\n      return { kind: 'color', value: { colorSpace: 'srgb', components: [rgb[0], rgb[1], rgb[2]], alpha: alpha, hex: '#' + hex } };\n    } else if (isDict(raw) && Object.prototype.hasOwnProperty.call(raw, 'colorSpace')) {\n      return { kind: 'color', value: raw as any };\n    }\n    throw new Error('Color token requires hex or srgb object');\n  }\n  if (type === 'number') return { kind: 'number', value: Number(raw) };\n  if (type === 'boolean') return { kind: 'boolean', value: Boolean(raw) };\n  if (type === 'string') return { kind: 'string', value: String(raw) };\n  return { kind: 'string', value: String(raw) };\n}\n", "\nimport type { TokenGraph, TokenNode, ValueOrAlias } from '../core/ir';\n\ninterface SerializeResult {\n  files: Array<{ name: string; json: any }>;\n}\ninterface ExportOpts { format: 'single'|'perMode' }\n\nexport function serialize(graph: TokenGraph, opts: ExportOpts): SerializeResult {\n  return opts.format === 'perMode' ? serializePerMode(graph) : serializeSingle(graph);\n}\n\nfunction serializePerMode(graph: TokenGraph): SerializeResult {\n  // group by context key\n  const byCtx: Record<string, TokenNode[]> = {};\n  for (const t of graph.tokens) {\n    for (const [ctx, v] of Object.entries(t.byContext)) {\n      ((byCtx[ctx]) ? byCtx[ctx] : (byCtx[ctx] = [])).push((function(){ const copy:any = { path: t.path.slice(0), type: t.type, byContext: {} }; if (t.description) copy.description = t.description; if (t.extensions) copy.extensions = t.extensions; copy.byContext[ctx] = v; return copy; })());\n    }\n  }\n  const files: Array<{ name: string; json: any }> = [];\n  for (const [ctx, tokens] of Object.entries(byCtx)) {\n    const json = tokensToDtcg(tokens, { includeExtensions: true });\n    const safeName = ctx.replace(/[\\/:]/g, '_');\n    files.push({ name: `tokens_${safeName}.json`, json });\n  }\n  return { files };\n}\n\nfunction serializeSingle(graph: TokenGraph): SerializeResult {\n  const json = tokensToDtcg(graph.tokens, { includeExtensions: true, includeAllContexts: true });\n  return { files: [{ name: 'tokens_all.json', json }] };\n}\n\nfunction tokensToDtcg(tokens: TokenNode[], opts: { includeExtensions: boolean; includeAllContexts?: boolean }) {\n  // Emit a flat object with group nesting based on path segments.\n  const root: any = {};\n  for (const t of tokens) {\n    const leafContainer = ensurePath(root, t.path.slice(0, -1));\n    const name = t.path[t.path.length-1];\n\n    // Choose one value if only one context; else emit $extensions.org.figma.valuesByContext\n    let value: any;\n    let exts: any = undefined;\n    const entries = Object.entries(t.byContext);\n    if (entries.length === 1 && !opts.includeAllContexts) {\n      value = valueOut(entries[0][1]);\n    } else {\n      // keep values by context\n      const valuesByContext: Record<string, any> = {};\n      for (const [ctx, v] of entries) valuesByContext[ctx] = valueOut(v);\n      exts = (function(){ var base:any = {}; if (t.extensions) { for (var k in t.extensions) { if (Object.prototype.hasOwnProperty.call(t.extensions, k)) base[k] = (t.extensions as any)[k]; } } base.org = { figma: { valuesByContext: valuesByContext } }; return base; })();\n      value = valueOut(entries[0][1]); // pick first as default\n    }\n    const obj: any = { $type: t.type, $value: value };\n    if (t.description) obj.$description = t.description;\n    if (opts.includeExtensions && (exts || t.extensions)) {\n      obj.$extensions = exts || t.extensions;\n    }\n    leafContainer[name] = obj;\n  }\n  return root;\n}\n\nfunction valueOut(v: ValueOrAlias) {\n  if ('kind' in v && v.kind === 'alias') return `{${v.path}}`;\n  if ('kind' in v && v.kind === 'color') {\n    if (v.value.hex) return v.value.hex;\n    const [r,g,b] = v.value.components;\n    const a = v.value.alpha || 1;\n    if (a === 1) return rgbToHex(r,g,b);\n    return { colorSpace: 'srgb', components: [r,g,b], alpha: a };\n  }\n  if ('kind' in v && v.kind === 'dimension') return v.value;\n  if ('kind' in v) return v.value as any;\n  return v as any;\n}\n\nfunction ensurePath(root:any, path:string[]) {\n  let cur = root;\n  for (var i=0; i<path.length; i++){ var p = path[i]; if (!Object.prototype.hasOwnProperty.call(cur, p) || cur[p] == null) { cur[p] = {}; } cur = cur[p]; }\n  return cur;\n}\n\nfunction rgbToHex(r:number,g:number,b:number) {\n  const c = (x:number) => Math.round(x*255).toString(16).padStart(2, '0');\n  return '#' + c(r)+c(g)+c(b);\n}\n\n", "// src/adapters/figma-reader.ts\nimport type { TokenGraph, TokenNode, ValueOrAlias } from '../core/ir';\nimport { ctxKey } from '../core/ir';\n\ntype VariablesAPI = typeof figma.variables & {\n  getLocalVariableCollectionsAsync?: () => Promise<VariableCollection[]>;\n  getVariableCollectionByIdAsync?: (id: string) => Promise<VariableCollection | null>;\n  getVariableByIdAsync?: (id: string) => Promise<Variable | null>;\n};\n\nfunction mapType(rt: string): 'color' | 'number' | 'boolean' | 'string' {\n  // Figma Variable.resolvedType is one of: 'COLOR' | 'FLOAT' | 'BOOLEAN' | 'STRING'\n  if (rt === 'COLOR') return 'color';\n  if (rt === 'FLOAT') return 'number';\n  if (rt === 'BOOLEAN') return 'boolean';\n  return 'string';\n}\n\nfunction isAliasValue(v: unknown): v is { type: string; id: string } {\n  return typeof v === 'object' && v !== null &&\n    (v as any).type === 'VARIABLE_ALIAS' &&\n    typeof (v as any).id === 'string';\n}\n\nfunction isRGBA(v: unknown): v is { r: number; g: number; b: number; a: number } {\n  if (typeof v !== 'object' || v === null) return false;\n  var o: any = v;\n  return typeof o.r === 'number' && typeof o.g === 'number' &&\n    typeof o.b === 'number' && typeof o.a === 'number';\n}\n\n// Keep this near the top of the file, with the other helpers.\ntype SrgbComponents = [number, number, number];\ntype SrgbColorValue = { colorSpace: 'srgb'; components: SrgbComponents; alpha: number };\n\nfunction figmaColorToIR(c: { r: number; g: number; b: number; a: number }): SrgbColorValue {\n  const comps: SrgbComponents = [c.r, c.g, c.b];\n  // SRGB typed as the string literal 'srgb' (no \"as\" needed)\n  const SRGB: 'srgb' = 'srgb';\n  return { colorSpace: SRGB, components: comps, alpha: c.a };\n}\n\nexport async function snapshot(): Promise<TokenGraph> {\n  const tokens: TokenNode[] = [];\n\n  const vars = figma.variables as VariablesAPI;\n\n  // 1) Get collections (async preferred)\n  let collections: VariableCollection[] = [];\n  if (typeof vars.getLocalVariableCollectionsAsync === 'function' && vars.getLocalVariableCollectionsAsync) {\n    collections = await vars.getLocalVariableCollectionsAsync();\n  } else {\n    // Fallback to deprecated sync API\n    collections = vars.getLocalVariableCollections();\n    // If you want to re-hydrate via async by id, you could do it here,\n    // but most data we need is already on the collection object.\n  }\n\n  // 2) Walk collections, variables, modes\n  let ci: number;\n  for (ci = 0; ci < collections.length; ci++) {\n    const c = collections[ci];\n    if (!c) continue;\n\n    let vi: number;\n    for (vi = 0; vi < c.variableIds.length; vi++) {\n      const vid = c.variableIds[vi];\n\n      // Get variable (async preferred)\n      let v: Variable | null = null;\n      if (typeof vars.getVariableByIdAsync === 'function' && vars.getVariableByIdAsync) {\n        v = await vars.getVariableByIdAsync(vid);\n      } else {\n        v = vars.getVariableById(vid);\n      }\n      if (!v) continue;\n\n      const path = v.name.split('/');\n      const type = mapType(v.resolvedType);\n\n      const byContext: Record<string, ValueOrAlias> = {};\n      let mi: number;\n      for (mi = 0; mi < c.modes.length; mi++) {\n        const m = c.modes[mi];\n        const ctx = ctxKey(c.name, m.name);\n        const mv = v.valuesByMode[m.modeId];\n\n        // Alias\n        if (isAliasValue(mv)) {\n          // Resolve the alias's target to build a stable path string\n          let target: Variable | null = null;\n          if (typeof vars.getVariableByIdAsync === 'function' && vars.getVariableByIdAsync) {\n            target = await vars.getVariableByIdAsync(mv.id);\n          } else {\n            target = vars.getVariableById(mv.id);\n          }\n          if (target) {\n            byContext[ctx] = {\n              kind: 'alias',\n              // Use the canonical slash-separated variable name as path\n              path: target.name\n            };\n          }\n          continue;\n        }\n\n        // Color\n        if (isRGBA(mv)) {\n          byContext[ctx] = { kind: 'color', value: figmaColorToIR({ r: mv.r, g: mv.g, b: mv.b, a: mv.a }) };\n          continue;\n        }\n\n        // Number / Boolean / String\n        if (typeof mv === 'number') { byContext[ctx] = { kind: 'number', value: mv }; continue; }\n        if (typeof mv === 'boolean') { byContext[ctx] = { kind: 'boolean', value: mv }; continue; }\n        if (typeof mv === 'string') { byContext[ctx] = { kind: 'string', value: mv }; continue; }\n\n        // Unhandled: leave empty for this mode\n      }\n\n      tokens.push({ path: path, type: type, byContext: byContext });\n    }\n  }\n\n  return { tokens: tokens };\n}\n", "\nimport type { ValueOrAlias, ColorValue } from '../core/ir';\nimport { figmaToSrgb } from '../core/color';\n\nexport function ensureCollection(name: string): VariableCollection {\n  const found = figma.variables.getLocalVariableCollections().find(c => c.name === name);\n  if (found) { return found; } return figma.variables.createVariableCollection(name);\n}\nexport function ensureMode(c: VariableCollection, modeName: string): string {\n  const found = c.modes.find(m => m.name === modeName);\n  if (found) { return found.modeId; } return c.addMode(modeName);\n}\nexport function upsertVariable(c: VariableCollection, name: string, resolvedType: VariableResolvedDataType): Variable {\n  for (const id of c.variableIds) {\n    const v = figma.variables.getVariableById(id);\n    if (v && v.name === name) return v;\n  }\n  return figma.variables.createVariable(name, c, resolvedType);\n}\nexport function findVariableByPath(path: string): Variable | null {\n  const name = path; // already 'a/b/c'\n  for (const c of figma.variables.getLocalVariableCollections()) {\n    for (const id of c.variableIds) {\n      const v = figma.variables.getVariableById(id);\n      if (v && v.name === name) return v;\n    }\n  }\n  return null;\n}\n\nexport function irToFigmaValue(v: ValueOrAlias): any {\n  if ('kind' in v && v.kind === 'color') {\n    const { components, alpha } = v.value;\n    return { r: components[0], g: components[1], b: components[2], a: (typeof alpha === 'number' ? alpha : 1) };\n  }\n  if ('kind' in v && v.kind === 'number') return v.value;\n  if ('kind' in v && v.kind === 'boolean') return v.value;\n  if ('kind' in v && v.kind === 'string') return v.value;\n  if ('kind' in v && v.kind === 'dimension') return v.value.value; // no unit in Figma\n  return v as any;\n}\n\nexport function figmaColorToIR(c: {r:number;g:number;b:number;a:number}): ColorValue {\n  return figmaToSrgb(c.r, c.g, c.b, c.a);\n}\n", "\nimport type { ApplyPlan } from '../core/plan';\nimport type { ValueOrAlias } from '../core/ir';\nimport { ensureCollection, ensureMode, upsertVariable, irToFigmaValue, findVariableByPath } from '../figma/variables';\n\nexport async function apply(plan: ApplyPlan) {\n  // For each item: ensure collection+mode, upsert variable, set per-mode values.\n  // Context key format: 'Collection/mode=Name'\n  for (const item of plan.items) {\n    // group changes by collection\n    const perCollection: Record<string, Array<{ mode: string; value: ValueOrAlias }>> = {};\n    for (const [ctx, val] of Object.entries(item.perContext)) {\n      const [collection, modeEq] = ctx.split('/mode=');\n      if (!perCollection[collection]) { perCollection[collection] = []; } perCollection[collection].push({ mode: modeEq, value: val });\n    }\n\n    for (const [collectionName, entries] of Object.entries(perCollection)) {\n      const c = ensureCollection(collectionName);\n      // Determine Figma type\n      const figmaType = mapToFigmaType(item.type);\n      const varName = item.path.join('/');\n      const variable = upsertVariable(c, varName, figmaType);\n      // Ensure modes\n      for (const { mode, value } of entries) {\n        const modeId = ensureMode(c, mode);\n        if (value && 'kind' in value && value.kind === 'alias') {\n          const target = findVariableByPath(value.path);\n          if (!target) throw new Error(`Alias target not found: ${value.path}`);\n          variable.setValueForMode(modeId, figma.variables.createVariableAlias(target));\n        } else {\n          variable.setValueForMode(modeId, irToFigmaValue(value));\n        }\n      }\n    }\n  }\n}\n\nfunction mapToFigmaType(t: string): VariableResolvedDataType {\n  switch (t) {\n    case 'color': return 'COLOR';\n    case 'number': return 'FLOAT';\n    case 'string': return 'STRING';\n    case 'boolean': return 'BOOLEAN';\n    default: return 'STRING';\n  }\n}\n", "\nimport { normalize } from './normalize';\nimport { planChanges } from './plan';\nimport * as DtcgReader from '../adapters/dtcg-reader';\nimport * as DtcgWriter from '../adapters/dtcg-writer';\nimport * as FigmaReader from '../adapters/figma-reader';\nimport * as FigmaWriter from '../adapters/figma-writer';\n\nexport interface ExportOpts { format: 'single' | 'perMode' }\n\nexport async function importDtcg(json: unknown): Promise<void> {\n  // File defines contexts; no UI opts needed.\n  const desiredGraph = normalize(DtcgReader.parse(json)); // \u2190 single arg\n  const current = await FigmaReader.snapshot();\n  const plan = planChanges(current, desiredGraph);\n  await FigmaWriter.apply(plan);\n}\n\nexport async function exportDtcg(opts: ExportOpts) {\n  const current = await FigmaReader.snapshot();\n  const graph = normalize(current);\n  return DtcgWriter.serialize(graph, opts);\n}\n", "// src/app/main.ts\nimport type { UiToPlugin, PluginToUi } from './messages';\nimport { importDtcg, exportDtcg } from '../core/pipeline';\n\n// __html__ is injected by esbuild.config.mjs from dist/ui.html with ui.js inlined\ndeclare const __html__: string;\n\nfigma.showUI(__html__, { width: 960, height: 540 });\n\nfunction send(msg: PluginToUi): void {\n  figma.ui.postMessage(msg);\n}\n\nasync function snapshotCollectionsForUi(): Promise<{\n  collections: Array<{\n    id: string;\n    name: string;\n    modes: Array<{ id: string; name: string }>;\n    variables: Array<{ id: string; name: string; type: string }>;\n  }>;\n  rawText: string;\n}> {\n  if (typeof figma.editorType !== 'string' || figma.editorType !== 'figma') {\n    return {\n      collections: [],\n      rawText:\n        'Variables API is not available in this editor.\\n' +\n        'Open a Figma Design file (not FigJam) and try again.'\n    };\n  }\n  if (\n    typeof figma.variables === 'undefined' ||\n    typeof figma.variables.getLocalVariableCollectionsAsync !== 'function' ||\n    typeof figma.variables.getVariableByIdAsync !== 'function'\n  ) {\n    return {\n      collections: [],\n      rawText:\n        'Variables API methods not found. Ensure your Figma version supports Variables and try again.'\n    };\n  }\n\n  const locals: VariableCollection[] = await figma.variables.getLocalVariableCollectionsAsync();\n\n  const out: Array<{\n    id: string;\n    name: string;\n    modes: Array<{ id: string; name: string }>;\n    variables: Array<{ id: string; name: string; type: string }>;\n  }> = [];\n  const rawLines: string[] = [];\n\n  let i = 0;\n  for (i = 0; i < locals.length; i++) {\n    const c = locals[i];\n    if (!c) continue;\n\n    const modes: Array<{ id: string; name: string }> = [];\n    let mi = 0;\n    for (mi = 0; mi < c.modes.length; mi++) {\n      const m = c.modes[mi];\n      modes.push({ id: m.modeId, name: m.name });\n    }\n\n    const varsList: Array<{ id: string; name: string; type: string }> = [];\n    let vi = 0;\n    for (vi = 0; vi < c.variableIds.length; vi++) {\n      const varId = c.variableIds[vi];\n      const v = await figma.variables.getVariableByIdAsync(varId);\n      if (!v) continue;\n      varsList.push({ id: v.id, name: v.name, type: v.resolvedType });\n    }\n\n    out.push({ id: c.id, name: c.name, modes: modes, variables: varsList });\n\n    rawLines.push('Collection: ' + c.name + ' (' + c.id + ')');\n    const modeNames: string[] = [];\n    let zi = 0; for (zi = 0; zi < modes.length; zi++) modeNames.push(modes[zi].name);\n    rawLines.push('  Modes: ' + (modeNames.length > 0 ? modeNames.join(', ') : '(none)'));\n    rawLines.push('  Variables (' + String(varsList.length) + '):');\n    let qi = 0; for (qi = 0; qi < varsList.length; qi++) rawLines.push('    - ' + varsList[qi].name + ' [' + varsList[qi].type + ']');\n    rawLines.push('');\n  }\n\n  if (out.length === 0) {\n    rawLines.push('No local Variable Collections found.');\n    rawLines.push('Create one in the Variables panel, then press Refresh.');\n  }\n\n  return { collections: out, rawText: rawLines.join('\\n') };\n}\n\nfunction safeKeyFromCollectionAndMode(collectionName: string, modeName: string): string {\n  const base = collectionName + '/mode=' + modeName;\n  let i = 0, out = '';\n  for (i = 0; i < base.length; i++) {\n    const ch = base.charAt(i);\n    if (ch === '/' || ch === '\\\\' || ch === ':') out += '_'; else out += ch;\n  }\n  return out;\n}\n\nfigma.ui.onmessage = async (msg: UiToPlugin) => {\n  try {\n    if (msg.type === 'UI_READY') {\n      const snap = await snapshotCollectionsForUi();\n      send({ type: 'INFO', payload: { message: 'Fetched ' + String(snap.collections.length) + ' collections (initial)' } });\n      send({ type: 'COLLECTIONS_DATA', payload: { collections: snap.collections } });\n      send({ type: 'RAW_COLLECTIONS_TEXT', payload: { text: snap.rawText } });\n      return;\n    }\n\n    if (msg.type === 'FETCH_COLLECTIONS') {\n      const snapshot = await snapshotCollectionsForUi();\n      send({ type: 'INFO', payload: { message: 'Fetched ' + String(snapshot.collections.length) + ' collections' } });\n      send({ type: 'COLLECTIONS_DATA', payload: { collections: snapshot.collections } });\n      send({ type: 'RAW_COLLECTIONS_TEXT', payload: { text: snapshot.rawText } });\n      return;\n    }\n\n    if (msg.type === 'IMPORT_DTCG') {\n      await importDtcg(msg.payload.json);\n      send({ type: 'INFO', payload: { message: 'Import completed.' } });\n      const snap2 = await snapshotCollectionsForUi();\n      send({ type: 'COLLECTIONS_DATA', payload: { collections: snap2.collections } });\n      send({ type: 'RAW_COLLECTIONS_TEXT', payload: { text: snap2.rawText } });\n      return;\n    }\n\n    if (msg.type === 'EXPORT_DTCG') {\n      const exportAll = !!msg.payload.exportAll;\n      if (exportAll) {\n        const all = await exportDtcg({ format: 'single' });\n        send({ type: 'EXPORT_RESULT', payload: { files: all.files } });\n        return;\n      }\n\n      const collectionName = msg.payload.collection ? msg.payload.collection : '';\n      const modeName = msg.payload.mode ? msg.payload.mode : '';\n      const per = await exportDtcg({ format: 'perMode' });\n\n      const key = safeKeyFromCollectionAndMode(collectionName, modeName);\n      const picked: Array<{ name: string; json: unknown }> = [];\n      let i2 = 0; for (i2 = 0; i2 < per.files.length; i2++) if (per.files[i2].name.indexOf(key) !== -1) picked.push(per.files[i2]);\n      send({ type: 'EXPORT_RESULT', payload: { files: picked.length > 0 ? picked : per.files } });\n      return;\n    }\n  } catch (e) {\n    let message = 'Unknown error';\n    if (e instanceof Error) message = e.message;\n    send({ type: 'ERROR', payload: { message: message } });\n    // eslint-disable-next-line no-console\n    console.error(e);\n  }\n};\n"],
  "mappings": "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AO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAAU,EAAE,OAAO,KAAK,QAAQ,IAAI,CA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",
  "names": ["snapshot"]
}
