{
  "version": 3,
  "sources": ["../src/app/github/ui/auth.ts", "../src/app/github/ui/repo.ts", "../src/app/github/ui/branch.ts", "../src/app/github/ui/folder.ts", "../src/app/github/ui/import.ts", "../src/app/github/ui/export.ts", "../src/app/github/ui.ts", "../src/app/ui/dom.ts", "../src/app/ui/utils.ts", "../src/app/ui/state.ts", "../src/app/ui/storage.ts", "../src/app/ui/features/import.ts", "../src/app/ui/features/export.ts", "../src/app/ui/features/resize.ts", "../src/app/ui.ts"],
  "sourcesContent": ["import type { PluginToUi } from \"../../messages\";\nimport type { GithubUiDependencies, AttachContext } from \"./types\";\n\nconst GH_MASK = \"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\";\n\nexport class GithubAuthUi {\n    private deps: GithubUiDependencies;\n    private doc: Document | null = null;\n\n    private ghTokenInput: HTMLInputElement | null = null;\n    private ghRememberChk: HTMLInputElement | null = null;\n    private ghConnectBtn: HTMLButtonElement | null = null;\n    private ghVerifyBtn: HTMLButtonElement | null = null;\n    private ghLogoutBtn: HTMLButtonElement | null = null;\n    private ghAuthStatusEl: HTMLElement | null = null;\n    private ghTokenMetaEl: HTMLElement | null = null;\n\n    private ghIsAuthed = false;\n    private ghTokenExpiresAt: string | number | null = null;\n    private ghRememberPref = true;\n\n    constructor(deps: GithubUiDependencies) {\n        this.deps = deps;\n    }\n\n    public attach(context: AttachContext) {\n        this.doc = context.document;\n\n        this.ghTokenInput = this.findTokenInput();\n        this.ghRememberChk =\n            (this.doc.getElementById(\n                \"githubRememberChk\"\n            ) as HTMLInputElement) ||\n            (this.doc.getElementById(\"ghRememberChk\") as HTMLInputElement);\n        this.ghConnectBtn =\n            (this.doc.getElementById(\n                \"githubConnectBtn\"\n            ) as HTMLButtonElement) ||\n            (this.doc.getElementById(\"ghConnectBtn\") as HTMLButtonElement);\n        this.ghVerifyBtn =\n            (this.doc.getElementById(\"githubVerifyBtn\") as HTMLButtonElement) ||\n            (this.doc.getElementById(\"ghVerifyBtn\") as HTMLButtonElement);\n        this.ghLogoutBtn = this.doc.getElementById(\n            \"ghLogoutBtn\"\n        ) as HTMLButtonElement;\n\n        this.ensureGhStatusElements();\n\n        if (this.ghRememberChk) {\n            this.ghRememberChk.checked = this.ghRememberPref;\n            this.ghRememberChk.addEventListener(\"change\", () => {\n                this.updateRememberPref(!!this.ghRememberChk!.checked, true);\n            });\n        }\n\n        if (this.ghConnectBtn) {\n            this.ghConnectBtn.addEventListener(\"click\", () =>\n                this.onGitHubConnectClick()\n            );\n        }\n        if (this.ghVerifyBtn) {\n            this.ghVerifyBtn.addEventListener(\"click\", () =>\n                this.onGitHubVerifyClick()\n            );\n        }\n        if (this.ghLogoutBtn) {\n            this.ghLogoutBtn.addEventListener(\"click\", () =>\n                this.onGitHubLogoutClick()\n            );\n        }\n\n        // Initial UI update\n        this.updateGhStatusUi();\n    }\n\n    public handleMessage(msg: PluginToUi): boolean {\n        if (msg.type === \"GITHUB_AUTH_RESULT\") {\n            const p = msg.payload || ({} as any);\n            this.ghIsAuthed = !!p.ok;\n            this.ghTokenExpiresAt =\n                typeof p.exp !== \"undefined\" && p.exp !== null\n                    ? p.exp\n                    : typeof p.tokenExpiration !== \"undefined\" &&\n                      p.tokenExpiration !== null\n                    ? p.tokenExpiration\n                    : null;\n\n            if (typeof p.remember === \"boolean\") {\n                this.updateRememberPref(p.remember, false);\n            }\n\n            if (this.ghIsAuthed) {\n                this.setPatFieldObfuscated(true);\n                const who = p.login || \"unknown\";\n                const name = p.name ? ` (${p.name})` : \"\";\n                this.deps.log(`GitHub: Authenticated as ${who}${name}.`);\n            } else {\n                this.setPatFieldObfuscated(false);\n                const why = p.error ? `: ${p.error}` : \".\";\n                this.deps.log(`GitHub: Authentication failed${why}`);\n            }\n\n            this.updateGhStatusUi();\n            return true;\n        }\n        return false;\n    }\n\n    public isAuthed(): boolean {\n        return this.ghIsAuthed;\n    }\n\n    public logout() {\n        this.onGitHubLogoutClick();\n    }\n\n    private findTokenInput(): HTMLInputElement | null {\n        if (!this.doc) return null;\n        return (\n            (this.doc.getElementById(\"githubTokenInput\") as HTMLInputElement) ||\n            (this.doc.getElementById(\"ghTokenInput\") as HTMLInputElement) ||\n            (this.doc.getElementById(\"githubPatInput\") as HTMLInputElement) ||\n            (this.doc.querySelector(\n                'input[name=\"githubToken\"]'\n            ) as HTMLInputElement) ||\n            (this.doc.querySelector(\n                'input[type=\"password\"]'\n            ) as HTMLInputElement)\n        );\n    }\n\n    private readPatFromUi(): string {\n        if (!this.ghTokenInput) this.ghTokenInput = this.findTokenInput();\n        if (!this.ghTokenInput) return \"\";\n        if (this.ghTokenInput.getAttribute(\"data-filled\") === \"1\")\n            return GH_MASK;\n        return (this.ghTokenInput.value || \"\").trim();\n    }\n\n    private updateRememberPref(pref: boolean, persist = false): void {\n        const next = !!pref;\n        this.ghRememberPref = next;\n        if (this.ghRememberChk) {\n            this.ghRememberChk.checked = this.ghRememberPref;\n        }\n        this.updateGhStatusUi();\n        if (persist) {\n            this.deps.postToPlugin({\n                type: \"SAVE_PREFS\",\n                payload: { githubRememberToken: this.ghRememberPref },\n            });\n        }\n    }\n\n    private ensureGhStatusElements(): void {\n        if (!this.doc) return;\n        if (!this.ghAuthStatusEl)\n            this.ghAuthStatusEl = this.doc.getElementById(\"ghAuthStatus\");\n        if (!this.ghTokenMetaEl)\n            this.ghTokenMetaEl = this.doc.getElementById(\"ghTokenMeta\");\n        if (!this.ghLogoutBtn)\n            this.ghLogoutBtn = this.doc.getElementById(\n                \"ghLogoutBtn\"\n            ) as HTMLButtonElement;\n    }\n\n    private formatTimeLeft(expInput: string | number): string {\n        const exp =\n            typeof expInput === \"number\" ? expInput : Date.parse(expInput);\n        if (!isFinite(exp)) return \"expiration: unknown\";\n        const now = Date.now();\n        const ms = exp - now;\n        if (ms <= 0) return \"expired\";\n        const days = Math.floor(ms / (24 * 60 * 60 * 1000));\n        const hours = Math.floor(\n            (ms % (24 * 60 * 60 * 1000)) / (60 * 60 * 1000)\n        );\n        if (days > 0) return `${days}d ${hours}h left`;\n        const mins = Math.floor((ms % (60 * 60 * 1000)) / (60 * 1000));\n        if (hours > 0) return `${hours}h ${mins}m left`;\n        const secs = Math.floor((ms % (60 * 1000)) / 1000);\n        if (mins > 0) return `${mins}m ${secs}s left`;\n        return `${secs}s left`;\n    }\n\n    private setPatFieldObfuscated(filled: boolean): void {\n        if (!this.ghTokenInput) this.ghTokenInput = this.findTokenInput();\n        if (!this.ghTokenInput) return;\n        this.ghTokenInput.type = \"password\";\n        if (filled) {\n            this.ghTokenInput.value = GH_MASK;\n            this.ghTokenInput.setAttribute(\"data-filled\", \"1\");\n        } else {\n            this.ghTokenInput.value = \"\";\n            this.ghTokenInput.removeAttribute(\"data-filled\");\n        }\n    }\n\n    private updateGhStatusUi(): void {\n        this.ensureGhStatusElements();\n\n        if (this.ghAuthStatusEl) {\n            this.ghAuthStatusEl.textContent = this.ghIsAuthed\n                ? \"GitHub: authenticated.\"\n                : \"GitHub: not authenticated.\";\n        }\n\n        if (this.ghTokenMetaEl) {\n            const rememberTxt = this.ghRememberPref\n                ? \"Remember me: on\"\n                : \"Remember me: off\";\n            const expTxt = this.ghTokenExpiresAt\n                ? `Token ${this.formatTimeLeft(this.ghTokenExpiresAt)}`\n                : \"Token expiration: unknown\";\n            this.ghTokenMetaEl.textContent = `${expTxt} \u2022 ${rememberTxt}`;\n        }\n\n        if (this.ghTokenInput) {\n            this.ghTokenInput.oninput = () => {\n                if (\n                    this.ghTokenInput &&\n                    this.ghTokenInput.getAttribute(\"data-filled\") === \"1\"\n                ) {\n                    this.ghTokenInput.removeAttribute(\"data-filled\");\n                }\n                if (this.ghConnectBtn) this.ghConnectBtn.disabled = false;\n            };\n        }\n\n        if (this.ghConnectBtn && this.ghTokenInput) {\n            const isMasked =\n                this.ghTokenInput.getAttribute(\"data-filled\") === \"1\";\n            this.ghConnectBtn.disabled = this.ghIsAuthed && isMasked;\n        }\n\n        if (this.ghLogoutBtn) {\n            this.ghLogoutBtn.disabled = !this.ghIsAuthed;\n        }\n\n        if (this.ghRememberChk) {\n            this.ghRememberChk.checked = this.ghRememberPref;\n        }\n    }\n\n    private onGitHubConnectClick(): void {\n        const tokenRaw = this.readPatFromUi();\n        const isMasked = this.ghTokenInput?.getAttribute(\"data-filled\") === \"1\";\n        if (this.ghIsAuthed && isMasked) return;\n        if (!tokenRaw) {\n            this.deps.log(\"GitHub: Paste a Personal Access Token first.\");\n            return;\n        }\n        const remember = !!(this.ghRememberChk && this.ghRememberChk.checked);\n        this.deps.log(\"GitHub: Verifying token\u2026\");\n        this.deps.postToPlugin({\n            type: \"GITHUB_SET_TOKEN\",\n            payload: { token: tokenRaw, remember },\n        });\n    }\n\n    private onGitHubVerifyClick(): void {\n        this.onGitHubConnectClick();\n    }\n\n    private onGitHubLogoutClick(): void {\n        this.deps.postToPlugin({ type: \"GITHUB_FORGET_TOKEN\" });\n        this.ghIsAuthed = false;\n        this.ghTokenExpiresAt = null;\n        this.setPatFieldObfuscated(false);\n        this.updateGhStatusUi();\n        this.deps.log(\"GitHub: Logged out.\");\n\n        // Dispatch a custom event so other modules can react\n        // We can't easily dispatch DOM events from here without a target,\n        // but the main UI orchestrator can call this.logout() and then do cleanup.\n        // Alternatively, we can expose an event emitter or callback.\n        // For now, the orchestrator will handle the side effects of logout\n        // by observing the state or we can add a callback to the constructor/method.\n    }\n}\n", "import type { PluginToUi } from \"../../messages\";\nimport type { GithubUiDependencies, AttachContext } from \"./types\";\n\nexport class GithubRepoUi {\n    private deps: GithubUiDependencies;\n    private doc: Document | null = null;\n    private ghRepoSelect: HTMLSelectElement | null = null;\n\n    private currentOwner = \"\";\n    private currentRepo = \"\";\n\n    // Callbacks\n    public onRepoChange: ((owner: string, repo: string) => void) | null = null;\n\n    constructor(deps: GithubUiDependencies) {\n        this.deps = deps;\n    }\n\n    public attach(context: AttachContext) {\n        this.doc = context.document;\n        this.ghRepoSelect = this.doc.getElementById(\n            \"ghRepoSelect\"\n        ) as HTMLSelectElement;\n\n        if (this.ghRepoSelect) {\n            let lastRepoKey = \"\";\n            this.ghRepoSelect.addEventListener(\"change\", () => {\n                const value = this.ghRepoSelect!.value;\n                if (!value) return;\n                if (value === lastRepoKey) return;\n                lastRepoKey = value;\n\n                const parts = value.split(\"/\");\n                this.currentOwner = parts[0] || \"\";\n                this.currentRepo = parts[1] || \"\";\n\n                this.deps.postToPlugin({\n                    type: \"GITHUB_SELECT_REPO\",\n                    payload: {\n                        owner: this.currentOwner,\n                        repo: this.currentRepo,\n                    },\n                });\n\n                if (this.onRepoChange) {\n                    this.onRepoChange(this.currentOwner, this.currentRepo);\n                }\n            });\n        }\n    }\n\n    public handleMessage(msg: PluginToUi): boolean {\n        if (msg.type === \"GITHUB_REPOS\") {\n            const repos = (msg.payload?.repos ?? []) as Array<{\n                full_name: string;\n                default_branch: string;\n                private: boolean;\n            }>;\n            this.populateGhRepos(repos);\n            this.deps.log(`GitHub: Repository list updated (${repos.length}).`);\n            return true;\n        }\n\n        if (msg.type === \"GITHUB_RESTORE_SELECTED\") {\n            const p = msg.payload || {};\n            const newOwner = typeof p.owner === \"string\" ? p.owner : \"\";\n            const newRepo = typeof p.repo === \"string\" ? p.repo : \"\";\n\n            if (\n                newOwner === this.currentOwner &&\n                newRepo === this.currentRepo\n            ) {\n                return false;\n            }\n\n            this.currentOwner = newOwner;\n            this.currentRepo = newRepo;\n            // If repos are already populated, we should select it.\n            this.syncSelect();\n\n            // Notify listeners so downstream UIs know a repo is selected\n            if (this.currentOwner && this.currentRepo && this.onRepoChange) {\n                this.onRepoChange(this.currentOwner, this.currentRepo);\n            }\n            return false; // Allow other modules to handle RESTORE_SELECTED too\n        }\n\n        return false;\n    }\n\n    public reset() {\n        this.populateGhRepos([]);\n        this.currentOwner = \"\";\n        this.currentRepo = \"\";\n    }\n\n    public getSelected(): { owner: string; repo: string } {\n        return { owner: this.currentOwner, repo: this.currentRepo };\n    }\n\n    private populateGhRepos(\n        list: Array<{\n            full_name: string;\n            default_branch: string;\n            private: boolean;\n        }>\n    ): void {\n        if (!this.ghRepoSelect || !this.doc) return;\n        while (this.ghRepoSelect.options.length) this.ghRepoSelect.remove(0);\n\n        for (const r of list) {\n            const opt = this.doc.createElement(\"option\");\n            opt.value = r.full_name;\n            opt.textContent = r.full_name;\n            this.ghRepoSelect.appendChild(opt);\n        }\n        this.ghRepoSelect.disabled = list.length === 0;\n\n        if (list.length > 0) {\n            const prevOwner = this.currentOwner;\n            const prevRepo = this.currentRepo;\n\n            this.syncSelect();\n\n            // Only notify if the repo actually changed (e.g. we defaulted to a new one,\n            // or the previously selected one is no longer available).\n            // If it didn't change, it means we restored it correctly and already notified.\n            if (\n                (this.currentOwner !== prevOwner ||\n                    this.currentRepo !== prevRepo) &&\n                this.onRepoChange\n            ) {\n                this.onRepoChange(this.currentOwner, this.currentRepo);\n            }\n        }\n    }\n\n    private syncSelect() {\n        if (!this.ghRepoSelect) return;\n        if (this.currentOwner && this.currentRepo) {\n            const want = `${this.currentOwner}/${this.currentRepo}`;\n            let matched = false;\n            for (let i = 0; i < this.ghRepoSelect.options.length; i++) {\n                if (this.ghRepoSelect.options[i].value === want) {\n                    this.ghRepoSelect.selectedIndex = i;\n                    matched = true;\n                    break;\n                }\n            }\n            // console.log(`[RepoUi] syncSelect: want=${want}, matched=${matched}`);\n            if (matched) {\n                // We don't dispatch change event here to avoid loops.\n            }\n        } else {\n            // Default to first\n            if (this.ghRepoSelect.options.length > 0) {\n                this.ghRepoSelect.selectedIndex = 0;\n                // If we default to first, we should update state and notify\n                const val = this.ghRepoSelect.options[0].value;\n                const parts = val.split(\"/\");\n                if (parts.length === 2) {\n                    this.currentOwner = parts[0];\n                    this.currentRepo = parts[1];\n                    // We'll notify in populateGhRepos if this was called from there.\n                    // If called from elsewhere, we might need to notify.\n                    // But syncSelect is mostly internal.\n                }\n            }\n        }\n    }\n}\n", "// src/app/github/ui/branch.ts\n// Branch picker UI: search, pagination, selection, and creation flows.\nimport type { PluginToUi } from \"../../messages\";\nimport type { GithubUiDependencies, AttachContext } from \"./types\";\n\nconst BRANCH_TTL_MS = 60_000;\nconst RENDER_STEP = 200;\nconst BRANCH_INPUT_PLACEHOLDER = \"Search branches\u2026\";\n\ntype BranchSelectionResult = \"selected\" | \"more\" | \"fetch\" | \"noop\";\ntype BranchListState = {\n    all: string[];\n    filtered: string[];\n    renderCount: number;\n    menuVisible: boolean;\n    highlightIndex: number;\n    lastQuery: string;\n    inputPristine: boolean;\n};\n\nexport class GithubBranchUi {\n    private deps: GithubUiDependencies;\n    private doc: Document | null = null;\n    private win: Window | null = null;\n\n    // Elements\n    private ghBranchInput: HTMLInputElement | null = null;\n    private ghBranchClearBtn: HTMLButtonElement | null = null;\n    private ghBranchToggleBtn: HTMLButtonElement | null = null;\n    private ghBranchMenu: HTMLUListElement | null = null;\n    private ghBranchCountEl: HTMLElement | null = null;\n    private ghBranchRefreshBtn: HTMLButtonElement | null = null;\n\n    private ghNewBranchBtn: HTMLButtonElement | null = null;\n    private ghNewBranchRow: HTMLElement | null = null;\n    private ghNewBranchName: HTMLInputElement | null = null;\n    private ghCreateBranchConfirmBtn: HTMLButtonElement | null = null;\n    private ghCancelBranchBtn: HTMLButtonElement | null = null;\n\n    // State\n    private currentOwner = \"\";\n    private currentRepo = \"\";\n    private desiredBranch: string | null = null;\n    private defaultBranchFromApi: string | undefined = undefined;\n    private loadedPages = 0;\n    private hasMorePages = false;\n    private isFetchingBranches = false;\n    private lastBranchesFetchedAtMs = 0;\n    private listState: BranchListState = {\n        all: [],\n        filtered: [],\n        renderCount: 0,\n        menuVisible: false,\n        highlightIndex: -1,\n        lastQuery: \"\",\n        inputPristine: true,\n    };\n\n    // Callbacks\n    public onBranchChange: ((branch: string) => void) | null = null;\n\n    constructor(deps: GithubUiDependencies) {\n        this.deps = deps;\n    }\n\n    public attach(context: AttachContext) {\n        this.doc = context.document;\n        this.win = context.window;\n\n        this.ghBranchInput = this.doc.getElementById(\n            \"ghBranchInput\"\n        ) as HTMLInputElement;\n        this.ghBranchClearBtn = this.doc.getElementById(\n            \"ghBranchClearBtn\"\n        ) as HTMLButtonElement;\n        this.ghBranchToggleBtn = this.doc.getElementById(\n            \"ghBranchToggleBtn\"\n        ) as HTMLButtonElement;\n        this.ghBranchMenu = this.doc.getElementById(\n            \"ghBranchMenu\"\n        ) as HTMLUListElement;\n        this.ghBranchCountEl = this.doc.getElementById(\"ghBranchCount\");\n        this.ghBranchRefreshBtn = this.doc.getElementById(\n            \"ghBranchRefreshBtn\"\n        ) as HTMLButtonElement;\n\n        this.ghNewBranchBtn = this.doc.getElementById(\n            \"ghNewBranchBtn\"\n        ) as HTMLButtonElement;\n        this.ghNewBranchRow = this.doc.getElementById(\"ghNewBranchRow\");\n        this.ghNewBranchName = this.doc.getElementById(\n            \"ghNewBranchName\"\n        ) as HTMLInputElement;\n        this.ghCreateBranchConfirmBtn = this.doc.getElementById(\n            \"ghCreateBranchConfirmBtn\"\n        ) as HTMLButtonElement;\n        this.ghCancelBranchBtn = this.doc.getElementById(\n            \"ghCancelBranchBtn\"\n        ) as HTMLButtonElement;\n\n        this.setupEventListeners();\n    }\n\n    public setRepo(owner: string, repo: string) {\n        this.currentOwner = owner;\n        this.currentRepo = repo;\n        this.reset();\n\n        if (owner && repo) {\n            this.setBranchDisabled(true, \"Loading branches\u2026\");\n            this.updateBranchCount();\n            this.cancelNewBranchFlow(false);\n\n            this.deps.log(`GitHub: loading branches for ${owner}/${repo}\u2026`);\n            this.isFetchingBranches = true;\n            this.deps.postToPlugin({\n                type: \"GITHUB_FETCH_BRANCHES\",\n                payload: { owner, repo, page: 1 },\n            });\n        } else {\n            this.setBranchDisabled(true, \"Pick a repository first\u2026\");\n            this.updateBranchCount();\n            this.cancelNewBranchFlow(false);\n        }\n    }\n\n    public getCurrentBranch(): string {\n        if (this.desiredBranch) return this.desiredBranch;\n        if (this.ghBranchInput && !this.ghBranchInput.disabled) {\n            const raw = this.ghBranchInput.value.trim();\n            if (raw && raw !== \"__more__\" && raw !== \"__fetch__\") {\n                if (\n                    this.listState.all.includes(raw) ||\n                    raw === this.defaultBranchFromApi\n                )\n                    return raw;\n            }\n        }\n        return this.defaultBranchFromApi || \"\";\n    }\n\n    public getPrBaseBranch(): string {\n        return this.defaultBranchFromApi || \"\";\n    }\n\n    public handleMessage(msg: PluginToUi): boolean {\n        if (msg.type === \"GITHUB_BRANCHES\") {\n            const pl = (msg.payload || {}) as Record<string, unknown>;\n            const owner = String(pl.owner || \"\");\n            const repo = String(pl.repo || \"\");\n            if (owner !== this.currentOwner || repo !== this.currentRepo)\n                return true;\n\n            this.lastBranchesFetchedAtMs = Date.now();\n            this.loadedPages = Number(pl.page || 1);\n            this.hasMorePages = !!pl.hasMore;\n            this.isFetchingBranches = false;\n\n            if (\n                typeof pl.defaultBranch === \"string\" &&\n                !this.defaultBranchFromApi\n            ) {\n                this.defaultBranchFromApi = pl.defaultBranch;\n            }\n\n            if (this.ghNewBranchBtn) this.ghNewBranchBtn.disabled = false;\n\n            const names = Array.isArray(pl.branches)\n                ? (pl.branches as Array<{ name: string }>).map((b) => b.name)\n                : [];\n            const set = new Set(this.listState.all);\n            for (const n of names) if (n) set.add(n);\n            this.listState.all = Array.from(set).sort((a, b) =>\n                a.localeCompare(b)\n            );\n\n            this.applyBranchFilter();\n            this.setBranchDisabled(false);\n\n            // Notify change if we auto-selected something (like default branch)\n            // But usually we wait for user action.\n            // However, if we just loaded, we might want to ensure the UI reflects the default if nothing selected.\n\n            this.deps.log(\n                `Loaded ${names.length} branches (page ${\n                    this.loadedPages\n                }) for ${repo}${this.hasMorePages ? \"\u2026\" : \"\"}`\n            );\n            return true;\n        }\n\n        if (msg.type === \"GITHUB_BRANCHES_ERROR\") {\n            const pl = (msg.payload || {}) as Record<string, unknown>;\n            const owner = String(pl.owner || \"\");\n            const repo = String(pl.repo || \"\");\n            if (owner !== this.currentOwner || repo !== this.currentRepo)\n                return true;\n            this.isFetchingBranches = false;\n            this.setBranchDisabled(false);\n            this.deps.log(\n                `Branch load failed (status ${pl.status}): ${\n                    pl.message || \"unknown error\"\n                }`\n            );\n            return true;\n        }\n\n        if (msg.type === \"GITHUB_CREATE_BRANCH_RESULT\") {\n            this.handleCreateBranchResult(msg.payload);\n            return true;\n        }\n\n        if (msg.type === \"GITHUB_RESTORE_SELECTED\") {\n            const p = msg.payload || {};\n            this.desiredBranch = typeof p.branch === \"string\" ? p.branch : null;\n            if (this.desiredBranch && this.ghBranchInput) {\n                this.ghBranchInput.value = this.desiredBranch;\n                this.listState.lastQuery = this.desiredBranch;\n                this.listState.inputPristine = false;\n                this.updateClearButtonVisibility();\n                if (this.onBranchChange)\n                    this.onBranchChange(this.desiredBranch);\n            }\n            return false;\n        }\n\n        return false;\n    }\n\n    public reset() {\n        this.desiredBranch = null;\n        this.defaultBranchFromApi = undefined;\n        this.loadedPages = 0;\n        this.hasMorePages = false;\n        this.isFetchingBranches = false;\n        this.listState.all = [];\n        this.listState.filtered = [];\n        this.listState.renderCount = 0;\n        if (this.ghBranchInput) {\n            this.ghBranchInput.value = \"\";\n            this.listState.lastQuery = \"\";\n            this.listState.inputPristine = true;\n            this.updateClearButtonVisibility();\n        }\n        if (this.ghBranchMenu)\n            while (this.ghBranchMenu.firstChild)\n                this.ghBranchMenu.removeChild(this.ghBranchMenu.firstChild);\n        this.closeBranchMenu();\n    }\n\n    private setupEventListeners() {\n        if (this.ghBranchInput) {\n            let timeout: number | undefined;\n            this.ghBranchInput.addEventListener(\"focus\", () => {\n                if (this.ghBranchInput!.disabled) return;\n                // Show all branches when focusing (not filtered by current value)\n                this.showAllBranches();\n                this.openBranchMenu();\n            });\n            this.ghBranchInput.addEventListener(\"input\", () => {\n                if (timeout) this.win?.clearTimeout(timeout);\n                const value = this.ghBranchInput!.value;\n                if (value !== \"__more__\" && value !== \"__fetch__\") {\n                    this.listState.lastQuery = value;\n                }\n                this.listState.inputPristine = false;\n                this.updateClearButtonVisibility();\n                if (!this.listState.menuVisible) this.openBranchMenu();\n                timeout = this.win?.setTimeout(() => {\n                    this.applyBranchFilter();\n                }, 120) as number | undefined;\n            });\n            this.ghBranchInput.addEventListener(\"keydown\", (e: KeyboardEvent) =>\n                this.handleInputKeydown(e)\n            );\n            this.ghBranchInput.addEventListener(\"change\", () => {\n                const result = this.processBranchSelection(\n                    this.ghBranchInput!.value,\n                    false\n                );\n                if (result === \"selected\") this.closeBranchMenu();\n                else if (result === \"more\" || result === \"fetch\")\n                    this.syncBranchHighlightAfterRender();\n            });\n        }\n\n        if (this.ghBranchClearBtn) {\n            this.ghBranchClearBtn.addEventListener(\"click\", (e) => {\n                e.preventDefault();\n                e.stopPropagation();\n                if (this.ghBranchInput) {\n                    this.ghBranchInput.value = \"\";\n                    this.listState.lastQuery = \"\";\n                    this.desiredBranch = null;\n                    this.listState.inputPristine = false;\n                    this.updateClearButtonVisibility();\n                    this.showAllBranches();\n                    this.ghBranchInput.focus();\n                }\n            });\n        }\n\n        if (this.ghBranchToggleBtn) {\n            this.ghBranchToggleBtn.addEventListener(\"click\", () => {\n                if (this.ghBranchToggleBtn!.disabled) return;\n                if (this.listState.menuVisible) {\n                    this.closeBranchMenu();\n                    return;\n                }\n                // Show all branches when opening dropdown\n                this.showAllBranches();\n                this.openBranchMenu();\n                if (\n                    this.ghBranchInput &&\n                    this.doc?.activeElement !== this.ghBranchInput\n                )\n                    this.ghBranchInput.focus();\n            });\n        }\n\n        if (this.ghBranchMenu) {\n            this.ghBranchMenu.addEventListener(\"mousedown\", (event) =>\n                event.preventDefault()\n            );\n            this.ghBranchMenu.addEventListener(\"click\", (event) =>\n                this.handleMenuClick(event)\n            );\n        }\n\n        if (this.doc) {\n            this.doc.addEventListener(\"mousedown\", (event) =>\n                this.handleOutsideClick(event)\n            );\n            this.doc.addEventListener(\"focusin\", (event) =>\n                this.handleOutsideClick(event)\n            );\n        }\n\n        if (this.ghBranchRefreshBtn) {\n            this.ghBranchRefreshBtn.addEventListener(\"click\", () => {\n                this.lastBranchesFetchedAtMs = 0;\n                this.revalidateBranchesIfStale(true);\n            });\n        }\n\n        if (this.ghNewBranchBtn) {\n            this.ghNewBranchBtn.addEventListener(\"click\", () => {\n                if (this.ghNewBranchBtn!.disabled) return;\n                const next = !this.isNewBranchRowVisible();\n                if (next) this.showNewBranchRow(true);\n                else this.cancelNewBranchFlow(false);\n            });\n        }\n\n        if (this.ghNewBranchName) {\n            this.ghNewBranchName.addEventListener(\"keydown\", (event) => {\n                if (event.key === \"Enter\") {\n                    event.preventDefault();\n                    this.requestNewBranchCreation();\n                } else if (event.key === \"Escape\") {\n                    event.preventDefault();\n                    this.cancelNewBranchFlow(true);\n                }\n            });\n        }\n\n        if (this.ghCreateBranchConfirmBtn) {\n            this.ghCreateBranchConfirmBtn.addEventListener(\"click\", () =>\n                this.requestNewBranchCreation()\n            );\n        }\n\n        if (this.ghCancelBranchBtn) {\n            this.ghCancelBranchBtn.addEventListener(\"click\", () =>\n                this.cancelNewBranchFlow(true)\n            );\n        }\n    }\n\n    private handleInputKeydown(e: KeyboardEvent) {\n        if (e.key === \"ArrowDown\") {\n            this.openBranchMenu();\n            this.moveBranchHighlight(1);\n            e.preventDefault();\n            return;\n        }\n        if (e.key === \"ArrowUp\") {\n            this.openBranchMenu();\n            this.moveBranchHighlight(-1);\n            e.preventDefault();\n            return;\n        }\n        if (e.key === \"Enter\") {\n        if (this.listState.menuVisible && this.listState.highlightIndex >= 0) {\n            const items = this.getBranchMenuItems();\n            const item = items[this.listState.highlightIndex];\n            if (item && item.dataset.selectable === \"1\") {\n                const value = item.getAttribute(\"data-value\") || \"\";\n                if (value) {\n                    const result = this.processBranchSelection(value, true);\n                    if (result === \"selected\") this.closeBranchMenu();\n                        else if (result === \"more\" || result === \"fetch\") {\n                            this.syncBranchHighlightAfterRender();\n                            this.openBranchMenu();\n                        }\n                    }\n                }\n            } else {\n                const result = this.processBranchSelection(\n                    this.ghBranchInput!.value,\n                    false\n                );\n                if (result === \"selected\") this.closeBranchMenu();\n                else if (result === \"more\" || result === \"fetch\")\n                    this.syncBranchHighlightAfterRender();\n            }\n            // Removed revalidateBranchesIfStale(true) here as per user request.\n            // Enter now only selects if something is valid, otherwise does nothing (or just closes menu if empty).\n            e.preventDefault();\n            return;\n        }\n        if (e.key === \"Escape\") {\n            if (this.listState.menuVisible) {\n                this.closeBranchMenu();\n                e.preventDefault();\n            }\n        }\n    }\n\n    private handleMenuClick(event: Event) {\n        const target = event.target as HTMLElement | null;\n        if (!target) return;\n        const item = target.closest(\"li\");\n        if (!item || !(item instanceof HTMLLIElement)) return;\n        if (item.getAttribute(\"aria-disabled\") === \"true\") return;\n        const value = item.getAttribute(\"data-value\") || \"\";\n        if (!value) return;\n        const result = this.processBranchSelection(value, true);\n        if (result === \"selected\") this.closeBranchMenu();\n        else if (result === \"more\" || result === \"fetch\") {\n            this.syncBranchHighlightAfterRender();\n            this.openBranchMenu();\n        }\n        if (this.ghBranchInput) this.ghBranchInput.focus();\n    }\n\n    private handleOutsideClick(event: Event) {\n        if (!this.listState.menuVisible) return;\n        const target = event.target as Node | null;\n        if (!target) {\n            this.closeBranchMenu();\n            return;\n        }\n        if (this.ghBranchMenu && this.ghBranchMenu.contains(target)) return;\n        if (this.ghBranchInput && target === this.ghBranchInput) return;\n        if (this.ghBranchToggleBtn && this.ghBranchToggleBtn.contains(target))\n            return;\n        this.closeBranchMenu();\n    }\n\n    private revalidateBranchesIfStale(forceLog = false): void {\n        if (!this.currentOwner || !this.currentRepo) return;\n\n        const stale = Date.now() - this.lastBranchesFetchedAtMs > BRANCH_TTL_MS;\n        if (!stale) {\n            if (forceLog)\n                this.deps.log(\"Branches are up to date (no refresh needed).\");\n            return;\n        }\n\n        this.desiredBranch = this.desiredBranch || null;\n        this.defaultBranchFromApi = undefined;\n        this.loadedPages = 0;\n        this.hasMorePages = false;\n        this.isFetchingBranches = true;\n        this.listState.all = [];\n        this.listState.filtered = [];\n        this.listState.renderCount = 0;\n\n        this.setBranchDisabled(true, \"Refreshing branches\u2026\");\n        this.updateBranchCount();\n        if (this.ghBranchInput) {\n            this.ghBranchInput.value = \"\";\n            this.listState.lastQuery = \"\";\n            this.listState.inputPristine = true;\n        }\n        this.deps.log(\"Refreshing branches\u2026\");\n\n        this.deps.postToPlugin({\n            type: \"GITHUB_FETCH_BRANCHES\",\n            payload: {\n                owner: this.currentOwner,\n                repo: this.currentRepo,\n                page: 1,\n            },\n        });\n    }\n\n    private updateClearButtonVisibility(): void {\n        if (this.ghBranchClearBtn) {\n            const hasText = !!(\n                this.ghBranchInput && this.ghBranchInput.value.trim()\n            );\n            this.ghBranchClearBtn.hidden = !hasText;\n        }\n    }\n\n    private showAllBranches(): void {\n        // Show all branches without filtering\n        this.listState.filtered = [...this.listState.all];\n        this.listState.renderCount = Math.min(\n            RENDER_STEP,\n            this.listState.filtered.length\n        );\n        this.renderOptions();\n        this.updateBranchCount();\n    }\n\n    private setBranchDisabled(disabled: boolean, placeholder?: string): void {\n        const nextPlaceholder =\n            placeholder !== undefined ? placeholder : BRANCH_INPUT_PLACEHOLDER;\n        if (this.ghBranchInput) {\n            this.ghBranchInput.disabled = disabled;\n            this.ghBranchInput.placeholder = nextPlaceholder;\n            if (disabled) {\n                this.ghBranchInput.value = \"\";\n                this.listState.lastQuery = \"\";\n                this.listState.inputPristine = true;\n            }\n        }\n        if (this.ghBranchToggleBtn) {\n            this.ghBranchToggleBtn.disabled = disabled;\n            this.ghBranchToggleBtn.setAttribute(\"aria-expanded\", \"false\");\n        }\n        if (disabled) this.closeBranchMenu();\n    }\n\n    private updateBranchCount(): void {\n        if (!this.ghBranchCountEl) return;\n        const total = this.listState.all.length;\n        const showing = this.listState.filtered.length;\n        this.ghBranchCountEl.textContent = `${showing} / ${total}${\n            this.hasMorePages ? \" +\" : \"\"\n        }`;\n    }\n\n    private getBranchMenuItems(): HTMLLIElement[] {\n        if (!this.ghBranchMenu) return [];\n        const items: HTMLLIElement[] = [];\n        let node = this.ghBranchMenu.firstElementChild;\n        while (node) {\n            if (node instanceof HTMLLIElement) items.push(node);\n            node = node.nextElementSibling;\n        }\n        return items;\n    }\n\n    private setBranchHighlight(index: number, scrollIntoView: boolean): void {\n        const items = this.getBranchMenuItems();\n        this.listState.highlightIndex = index;\n        for (let i = 0; i < items.length; i++) {\n            if (i === this.listState.highlightIndex)\n                items[i].setAttribute(\"data-active\", \"1\");\n            else items[i].removeAttribute(\"data-active\");\n        }\n        if (\n            scrollIntoView &&\n            this.listState.highlightIndex >= 0 &&\n            this.listState.highlightIndex < items.length\n        ) {\n            try {\n                items[this.listState.highlightIndex].scrollIntoView({\n                    block: \"nearest\",\n                });\n            } catch {\n                /* ignore */\n            }\n        }\n    }\n\n    private findNextSelectable(\n        startIndex: number,\n        delta: number,\n        items: HTMLLIElement[]\n    ): number {\n        if (!items.length) return -1;\n        let index = startIndex;\n        for (let i = 0; i < items.length; i++) {\n            index += delta;\n            if (index < 0) index = items.length - 1;\n            else if (index >= items.length) index = 0;\n            const item = items[index];\n            if (!item) continue;\n            if (\n                item.dataset.selectable === \"1\" &&\n                item.getAttribute(\"aria-disabled\") !== \"true\"\n            )\n                return index;\n        }\n        return -1;\n    }\n\n    private moveBranchHighlight(delta: number): void {\n        const items = this.getBranchMenuItems();\n        if (!items.length) {\n            this.setBranchHighlight(-1, false);\n            return;\n        }\n        const next = this.findNextSelectable(\n            this.listState.highlightIndex,\n            delta,\n            items\n        );\n        if (next >= 0) this.setBranchHighlight(next, true);\n    }\n\n    private syncBranchHighlightAfterRender(): void {\n        const items = this.getBranchMenuItems();\n        if (!this.listState.menuVisible) {\n            this.setBranchHighlight(-1, false);\n            return;\n        }\n        if (!items.length) {\n            this.setBranchHighlight(-1, false);\n            return;\n        }\n        if (\n            this.listState.highlightIndex >= 0 &&\n            this.listState.highlightIndex < items.length\n        ) {\n            const current = items[this.listState.highlightIndex];\n            if (\n                current &&\n                current.dataset.selectable === \"1\" &&\n                current.getAttribute(\"aria-disabled\") !== \"true\"\n            ) {\n                this.setBranchHighlight(this.listState.highlightIndex, false);\n                return;\n            }\n        }\n        const first = this.findNextSelectable(-1, 1, items);\n        this.setBranchHighlight(first, false);\n    }\n\n    private setBranchMenuVisible(show: boolean): void {\n        if (!this.ghBranchMenu) {\n            this.listState.menuVisible = false;\n            this.listState.highlightIndex = -1;\n            return;\n        }\n        if (show && this.ghBranchInput && this.ghBranchInput.disabled)\n            show = false;\n        this.listState.menuVisible = show;\n        if (this.listState.menuVisible) {\n            this.ghBranchMenu.hidden = false;\n            this.ghBranchMenu.setAttribute(\"data-open\", \"1\");\n            if (this.ghBranchToggleBtn)\n                this.ghBranchToggleBtn.setAttribute(\"aria-expanded\", \"true\");\n            if (this.ghBranchInput)\n                this.ghBranchInput.setAttribute(\"aria-expanded\", \"true\");\n        } else {\n            this.ghBranchMenu.hidden = true;\n            this.ghBranchMenu.removeAttribute(\"data-open\");\n            if (this.ghBranchToggleBtn)\n                this.ghBranchToggleBtn.setAttribute(\"aria-expanded\", \"false\");\n            if (this.ghBranchInput)\n                this.ghBranchInput.setAttribute(\"aria-expanded\", \"false\");\n            this.setBranchHighlight(-1, false);\n        }\n    }\n\n    private openBranchMenu(): void {\n        if (!this.ghBranchMenu) return;\n        if (!this.listState.menuVisible) {\n            if (!this.ghBranchMenu.childElementCount) this.renderOptions();\n            this.setBranchMenuVisible(true);\n        }\n        this.syncBranchHighlightAfterRender();\n    }\n\n    private closeBranchMenu(): void {\n        this.setBranchMenuVisible(false);\n    }\n\n    private renderOptions(): void {\n        if (!this.ghBranchMenu || !this.doc) return;\n\n        while (this.ghBranchMenu.firstChild)\n            this.ghBranchMenu.removeChild(this.ghBranchMenu.firstChild);\n\n        const slice = this.listState.filtered.slice(\n            0,\n            this.listState.renderCount\n        );\n        if (slice.length > 0) {\n            for (let i = 0; i < slice.length; i++) {\n                const name = slice[i];\n                const item = this.doc.createElement(\"li\");\n                item.className = \"gh-branch-item\";\n                item.dataset.value = name;\n                item.dataset.selectable = \"1\";\n                item.setAttribute(\"role\", \"option\");\n                item.textContent = name;\n                if (i === this.listState.highlightIndex)\n                    item.setAttribute(\"data-active\", \"1\");\n                this.ghBranchMenu.appendChild(item);\n            }\n        } else {\n            const empty = this.doc.createElement(\"li\");\n            empty.className = \"gh-branch-item gh-branch-item-empty\";\n            empty.setAttribute(\"aria-disabled\", \"true\");\n            empty.dataset.selectable = \"0\";\n            empty.textContent = this.listState.all.length\n                ? \"No matching branches\"\n                : \"No branches loaded yet\";\n            this.ghBranchMenu.appendChild(empty);\n        }\n\n        if (this.listState.filtered.length > this.listState.renderCount) {\n            const more = this.doc.createElement(\"li\");\n            more.className = \"gh-branch-item gh-branch-item-action\";\n            more.dataset.value = \"__more__\";\n            more.dataset.selectable = \"1\";\n            more.textContent = `Load more\u2026 (${\n                this.listState.filtered.length - this.listState.renderCount\n            } more)`;\n            this.ghBranchMenu.appendChild(more);\n        } else if (this.hasMorePages) {\n            const fetch = this.doc.createElement(\"li\");\n            fetch.className = \"gh-branch-item gh-branch-item-action\";\n            fetch.dataset.value = \"__fetch__\";\n            fetch.dataset.selectable = \"1\";\n            fetch.textContent = \"Load next page\u2026\";\n            this.ghBranchMenu.appendChild(fetch);\n        }\n\n        if (this.ghBranchInput) {\n            const want = this.desiredBranch || this.defaultBranchFromApi || \"\";\n            if (\n                !this.ghBranchInput.value &&\n                want &&\n                this.listState.inputPristine\n            ) {\n                this.ghBranchInput.value = want;\n                this.listState.lastQuery = want;\n                this.updateClearButtonVisibility();\n            }\n        }\n\n        if (this.listState.menuVisible) {\n            this.syncBranchHighlightAfterRender();\n        }\n    }\n\n    private applyBranchFilter(): void {\n        const rawInput = (this.ghBranchInput?.value || \"\").trim();\n        const raw =\n            rawInput === \"__more__\" || rawInput === \"__fetch__\"\n                ? this.listState.lastQuery.trim()\n                : rawInput;\n        const q = raw.toLowerCase();\n        // Always filter by the query, even if it matches the selection.\n        // This allows users to refine their search (e.g. \"main\" -> \"maintenance\").\n        const effectiveQuery = q;\n        this.listState.filtered = effectiveQuery\n            ? this.listState.all.filter((n) =>\n                  n.toLowerCase().includes(effectiveQuery)\n              )\n            : [...this.listState.all];\n\n        this.listState.renderCount = Math.min(\n            RENDER_STEP,\n            this.listState.filtered.length\n        );\n        this.renderOptions();\n        this.updateBranchCount();\n\n        if (\n            !this.listState.menuVisible &&\n            this.ghBranchInput &&\n            !this.ghBranchInput.disabled\n        ) {\n            const isFocused =\n                !!this.doc && this.doc.activeElement === this.ghBranchInput;\n            if (isFocused) {\n                this.setBranchMenuVisible(true);\n                this.syncBranchHighlightAfterRender();\n            }\n        }\n    }\n\n    private processBranchSelection(\n        rawValue: string,\n        fromMenu: boolean\n    ): BranchSelectionResult {\n        const value = (rawValue || \"\").trim();\n        if (!this.ghBranchInput) return \"noop\";\n\n        if (value === \"__more__\") {\n            this.listState.renderCount = Math.min(\n                this.listState.renderCount + RENDER_STEP,\n                this.listState.filtered.length\n            );\n            this.renderOptions();\n            this.updateBranchCount();\n            this.ghBranchInput.value = this.listState.lastQuery;\n            if (fromMenu && !this.listState.menuVisible)\n                this.setBranchMenuVisible(true);\n            return \"more\";\n        }\n\n        if (value === \"__fetch__\") {\n            this.ensureNextPageIfNeeded();\n            this.ghBranchInput.value = this.listState.lastQuery;\n            return \"fetch\";\n        }\n\n        if (!value) return \"noop\";\n\n        this.desiredBranch = value;\n        this.listState.lastQuery = value;\n        this.ghBranchInput.value = value;\n        this.listState.inputPristine = false;\n        this.updateClearButtonVisibility();\n        this.deps.postToPlugin({\n            type: \"GITHUB_SELECT_BRANCH\",\n            payload: {\n                owner: this.currentOwner,\n                repo: this.currentRepo,\n                branch: value,\n            },\n        });\n\n        this.applyBranchFilter();\n\n        if (this.onBranchChange) this.onBranchChange(value);\n\n        return \"selected\";\n    }\n\n    private ensureNextPageIfNeeded(): void {\n        if (!this.ghBranchInput) return;\n        if (!this.hasMorePages || this.isFetchingBranches) return;\n        if (!this.currentOwner || !this.currentRepo) return;\n\n        this.isFetchingBranches = true;\n        this.deps.postToPlugin({\n            type: \"GITHUB_FETCH_BRANCHES\",\n            payload: {\n                owner: this.currentOwner,\n                repo: this.currentRepo,\n                page: this.loadedPages + 1,\n            },\n        });\n    }\n\n    // New Branch Flow\n    private showNewBranchRow(show: boolean): void {\n        if (!this.ghNewBranchRow) return;\n        this.ghNewBranchRow.style.display = show ? \"flex\" : \"none\";\n        if (show && this.ghNewBranchName) {\n            if (!this.ghNewBranchName.value) {\n                this.ghNewBranchName.value = `tokens/update-${new Date()\n                    .toISOString()\n                    .replace(/[:.]/g, \"-\")\n                    .slice(0, 19)}`;\n            }\n            this.ghNewBranchName.focus();\n            this.ghNewBranchName.select();\n        }\n    }\n\n    private isNewBranchRowVisible(): boolean {\n        if (!this.ghNewBranchRow) return false;\n        return this.ghNewBranchRow.style.display !== \"none\";\n    }\n\n    private cancelNewBranchFlow(refocusBtn: boolean): void {\n        this.showNewBranchRow(false);\n        if (this.ghNewBranchName) this.ghNewBranchName.value = \"\";\n        if (refocusBtn && this.ghNewBranchBtn) this.ghNewBranchBtn.focus();\n    }\n\n    private requestNewBranchCreation(): void {\n        if (\n            !this.ghCreateBranchConfirmBtn ||\n            this.ghCreateBranchConfirmBtn.disabled\n        )\n            return;\n        if (!this.currentOwner || !this.currentRepo) {\n            this.deps.log(\"Pick a repository before creating a branch.\");\n            return;\n        }\n        const baseBranch = this.defaultBranchFromApi || \"\";\n        if (!baseBranch) {\n            this.deps.log(\n                \"GitHub: Unable to determine the repository default branch. Refresh branches first.\"\n            );\n            return;\n        }\n        const newBranch = (this.ghNewBranchName?.value || \"\").trim();\n        if (!newBranch) {\n            this.deps.log(\"Enter a branch name to create.\");\n            if (this.ghNewBranchName) this.ghNewBranchName.focus();\n            return;\n        }\n        if (newBranch === baseBranch) {\n            this.deps.log(\n                \"Enter a branch name that differs from the source branch.\"\n            );\n            if (this.ghNewBranchName) this.ghNewBranchName.focus();\n            return;\n        }\n\n        this.ghCreateBranchConfirmBtn.disabled = true;\n        this.deps.log(`GitHub: creating ${newBranch} from ${baseBranch}\u2026`);\n        this.deps.postToPlugin({\n            type: \"GITHUB_CREATE_BRANCH\",\n            payload: {\n                owner: this.currentOwner,\n                repo: this.currentRepo,\n                baseBranch,\n                newBranch,\n            },\n        });\n    }\n\n    private handleCreateBranchResult(payload: unknown) {\n        const pl = (payload || {}) as Record<string, unknown>;\n        if (this.ghCreateBranchConfirmBtn)\n            this.ghCreateBranchConfirmBtn.disabled = false;\n        if (typeof pl.ok !== \"boolean\") return;\n\n        if (pl.ok) {\n            const baseBranch = String(pl.baseBranch || \"\");\n            const newBranch = String(pl.newBranch || \"\");\n            const url = String(pl.html_url || \"\");\n\n            if (newBranch) {\n                const s = new Set(this.listState.all);\n                if (!s.has(newBranch)) {\n                    s.add(newBranch);\n                    this.listState.all = Array.from(s).sort((a, b) =>\n                        a.localeCompare(b)\n                    );\n                }\n                this.desiredBranch = newBranch;\n                if (this.ghBranchInput) {\n                    this.ghBranchInput.value = newBranch;\n                    this.listState.lastQuery = newBranch;\n                    this.listState.inputPristine = false;\n                }\n                this.applyBranchFilter();\n            }\n\n            this.showNewBranchRow(false);\n            if (this.ghNewBranchName) this.ghNewBranchName.value = \"\";\n\n            if (url) {\n                this.deps.log(\n                    `Branch created: ${newBranch} (from ${baseBranch})`\n                );\n                const logEl = this.deps.getLogElement();\n                if (logEl && this.doc) {\n                    const wrap = this.doc.createElement(\"div\");\n                    const a = this.doc.createElement(\"a\");\n                    a.href = url;\n                    a.target = \"_blank\";\n                    a.textContent = \"View on GitHub\";\n                    wrap.appendChild(a);\n                    logEl.appendChild(wrap);\n                    (logEl as HTMLElement).scrollTop = (\n                        logEl as HTMLElement\n                    ).scrollHeight;\n                }\n            } else {\n                this.deps.log(\n                    `Branch created: ${newBranch} (from ${baseBranch})`\n                );\n            }\n\n            if (this.onBranchChange && newBranch)\n                this.onBranchChange(newBranch);\n        } else {\n            const status = pl.status ?? 0;\n            const message = pl.message || \"unknown error\";\n            this.deps.log(\n                `Create branch failed (status ${status}): ${message}`\n            );\n            if (pl.samlRequired) {\n                this.deps.log(\n                    \"This org requires SSO. Open the repo in your browser and authorize SSO for your token.\"\n                );\n            } else if (status === 403) {\n                if (pl.noPushPermission) {\n                    this.deps.log(\n                        \"You do not have push permission to this repository. Ask a maintainer for write access.\"\n                    );\n                } else {\n                    this.deps.log(\"Likely a token permission issue:\");\n                    this.deps.log(\n                        '\u2022 Classic PAT: add the \"repo\" scope (or \"public_repo\" for public repos).'\n                    );\n                    this.deps.log(\n                        '\u2022 Fine-grained PAT: grant this repository and set \"Contents: Read and write\".'\n                    );\n                }\n            }\n        }\n    }\n}\n", "// src/app/github/ui/folder.ts\n// Folder picker UI for browsing and selecting repository paths.\nimport type { PluginToUi } from \"../../messages\";\nimport type {\n    GithubUiDependencies,\n    AttachContext,\n    FolderListEntry,\n} from \"./types\";\n\nconst GH_FOLDER_PLACEHOLDER = \"Path in repository\u2026\";\ntype FolderPickerState = {\n    isOpen: boolean;\n    currentPath: string;\n    lastFocus: HTMLElement | null;\n    refreshNonce: number;\n};\n\nexport class GithubFolderUi {\n    private deps: GithubUiDependencies;\n    private doc: Document | null = null;\n    private win: Window | null = null;\n\n    // Elements\n    private ghFolderInput: HTMLInputElement | null = null;\n    private ghFolderDisplay: HTMLElement | null = null;\n    private ghPickFolderBtn: HTMLButtonElement | null = null;\n\n    private folderPickerOverlay: HTMLElement | null = null;\n    private folderPickerTitleEl: HTMLElement | null = null;\n    private folderPickerPathInput: HTMLInputElement | null = null;\n    private folderPickerUseBtn: HTMLButtonElement | null = null;\n    private folderPickerListEl: HTMLElement | null = null;\n    private folderPickerCancelBtn: HTMLButtonElement | null = null;\n\n    // State\n    private currentOwner = \"\";\n    private currentRepo = \"\";\n    private currentBranch = \"\";\n\n    private pickerState: FolderPickerState = {\n        isOpen: false,\n        currentPath: \"\",\n        lastFocus: null,\n        refreshNonce: 0,\n    };\n\n    private folderListWaiters: Array<{\n        path: string;\n        resolve: (v: { ok: true; entries: FolderListEntry[] }) => void;\n        reject: (v: { ok: false; message: string; status?: number }) => void;\n    }> = [];\n\n    private folderCreateWaiters: Array<{\n        folderPath: string;\n        resolve: (v: { ok: true }) => void;\n        reject: (v: { ok: false; message: string; status?: number }) => void;\n    }> = [];\n\n    // Callbacks\n    public onFolderChange: ((folder: string) => void) | null = null;\n\n    constructor(deps: GithubUiDependencies) {\n        this.deps = deps;\n    }\n\n    public attach(context: AttachContext) {\n        this.doc = context.document;\n        this.win = context.window;\n\n        this.ghFolderInput = this.doc.getElementById(\n            \"ghFolderInput\"\n        ) as HTMLInputElement;\n        this.ghFolderDisplay = this.doc.getElementById(\"ghFolderDisplay\");\n        this.setGhFolderDisplay(this.ghFolderInput?.value || \"\");\n        this.ghPickFolderBtn = this.doc.getElementById(\n            \"ghPickFolderBtn\"\n        ) as HTMLButtonElement;\n\n        this.folderPickerOverlay = this.doc.getElementById(\n            \"folderPickerOverlay\"\n        );\n        this.folderPickerTitleEl = this.doc.getElementById(\"folderPickerTitle\");\n        this.folderPickerPathInput = this.doc.getElementById(\n            \"folderPickerPath\"\n        ) as HTMLInputElement;\n        this.folderPickerUseBtn = this.doc.getElementById(\n            \"folderPickerUseBtn\"\n        ) as HTMLButtonElement;\n        this.folderPickerListEl = this.doc.getElementById(\"folderPickerList\");\n        this.folderPickerCancelBtn = this.doc.getElementById(\n            \"folderPickerCancelBtn\"\n        ) as HTMLButtonElement;\n\n        this.setupEventListeners();\n    }\n\n    public setContext(owner: string, repo: string, branch: string) {\n        this.currentOwner = owner;\n        this.currentRepo = repo;\n        this.currentBranch = branch;\n        this.updateFolderControlsEnabled();\n    }\n\n    public reset() {\n        this.setGhFolderDisplay(\"\");\n        this.pickerState.isOpen = false;\n        this.pickerState.currentPath = \"\";\n        this.pickerState.refreshNonce++;\n        this.folderListWaiters = [];\n        this.folderCreateWaiters = [];\n        if (this.folderPickerOverlay) {\n            this.folderPickerOverlay.classList.remove(\"is-open\");\n            this.folderPickerOverlay.setAttribute(\"aria-hidden\", \"true\");\n            this.folderPickerOverlay.hidden = true;\n        }\n    }\n\n    public getFolder(): string {\n        const raw = this.ghFolderInput ? this.ghFolderInput.value.trim() : \"\";\n        return this.normalizeFolderInput(raw).payload;\n    }\n\n    public setFolder(path: string) {\n        const normalized = this.normalizeFolderInput(path);\n        this.setGhFolderDisplay(normalized.display);\n    }\n\n    public handleMessage(msg: PluginToUi): boolean {\n        if (msg.type === \"GITHUB_FOLDER_LIST_RESULT\") {\n            const pl = msg.payload;\n            const path = String(pl.path || \"\").replace(/^\\/+|\\/+$/g, \"\");\n            const ok = pl.ok;\n            let entries: FolderListEntry[] = [];\n            let message = \"\";\n            let status: number | undefined;\n\n            if (pl.ok) {\n                entries = pl.entries;\n            } else {\n                message = pl.message;\n                status = pl.status;\n            }\n\n            for (let i = 0; i < this.folderListWaiters.length; i++) {\n                if (this.folderListWaiters[i].path === path) {\n                    const waiter = this.folderListWaiters.splice(i, 1)[0];\n                    if (ok) waiter.resolve({ ok: true, entries });\n                    else\n                        waiter.reject({\n                            ok: false,\n                            message: message || `HTTP ${status || 0}`,\n                            status: status,\n                        });\n                    break;\n                }\n            }\n            return true;\n        }\n\n        if (msg.type === \"GITHUB_CREATE_FOLDER_RESULT\") {\n            const pl = msg.payload;\n            const fp = String(pl.folderPath || \"\").replace(/^\\/+|\\/+$/g, \"\");\n            const ok = pl.ok;\n            let message = \"\";\n            let status: number | undefined;\n\n            if (!pl.ok) {\n                message = pl.message;\n                status = pl.status;\n            }\n\n            for (let i = 0; i < this.folderCreateWaiters.length; i++) {\n                if (this.folderCreateWaiters[i].folderPath === fp) {\n                    const waiter = this.folderCreateWaiters.splice(i, 1)[0];\n                    if (ok) waiter.resolve({ ok: true });\n                    else\n                        waiter.reject({\n                            ok: false,\n                            message: message || `HTTP ${status || 0}`,\n                            status: status,\n                        });\n                    break;\n                }\n            }\n            return true;\n        }\n\n        if (msg.type === \"GITHUB_RESTORE_SELECTED\") {\n            const p = msg.payload || {};\n            if (typeof p.folder === \"string\") {\n                const normalized = this.normalizeFolderInput(p.folder);\n                this.setGhFolderDisplay(normalized.display);\n                if (this.onFolderChange)\n                    this.onFolderChange(normalized.payload);\n            }\n            return false;\n        }\n\n        return false;\n    }\n\n    private setupEventListeners() {\n        if (this.ghPickFolderBtn) {\n            this.ghPickFolderBtn.addEventListener(\"click\", () =>\n                this.openFolderPicker()\n            );\n        }\n\n        if (this.folderPickerOverlay) {\n            this.folderPickerOverlay.addEventListener(\"click\", (event) => {\n                if (event.target === this.folderPickerOverlay)\n                    this.closeFolderPicker();\n            });\n            // Prevent clicks inside the overlay content from bubbling to the overlay close handler if they originated there\n            // (Though the check above handles it, sometimes structure makes it tricky)\n        }\n\n        if (this.folderPickerCancelBtn) {\n            this.folderPickerCancelBtn.addEventListener(\"click\", () =>\n                this.closeFolderPicker()\n            );\n        }\n\n        let folderPickerPathDebounce: number | undefined;\n        if (this.folderPickerPathInput) {\n            this.folderPickerPathInput.addEventListener(\"input\", () => {\n                if (folderPickerPathDebounce)\n                    this.win?.clearTimeout(folderPickerPathDebounce);\n                const value = this.folderPickerPathInput!.value;\n                folderPickerPathDebounce = this.win?.setTimeout(() => {\n                    this.setFolderPickerPath(value, true, false);\n                }, 120) as number | undefined;\n            });\n            this.folderPickerPathInput.addEventListener(\"keydown\", (event) => {\n                if (event.key === \"Enter\") {\n                    event.preventDefault();\n                    this.setFolderPickerPath(this.folderPickerPathInput!.value);\n                }\n            });\n            // Removed blur listener to prevent race condition with list item clicks\n            // and to prevent closing/refreshing when selecting text.\n            this.folderPickerPathInput.addEventListener(\"click\", (e) =>\n                e.stopPropagation()\n            );\n            this.folderPickerPathInput.addEventListener(\"mousedown\", (e) =>\n                e.stopPropagation()\n            );\n        }\n\n        if (this.folderPickerUseBtn) {\n            this.folderPickerUseBtn.addEventListener(\"click\", () => {\n                if (this.folderPickerPathInput) {\n                    this.setFolderPickerPath(\n                        this.folderPickerPathInput.value,\n                        false\n                    );\n                }\n                const selectionRaw = this.pickerState.currentPath\n                    ? `${this.pickerState.currentPath}/`\n                    : \"/\";\n                const normalized = this.normalizeFolderInput(selectionRaw);\n                this.setGhFolderDisplay(normalized.display);\n\n                this.deps.postToPlugin({\n                    type: \"GITHUB_SET_FOLDER\",\n                    payload: {\n                        owner: this.currentOwner,\n                        repo: this.currentRepo,\n                        folder: normalized.payload,\n                    },\n                });\n\n                this.closeFolderPicker();\n                this.deps.log(\n                    `Folder selected: ${\n                        normalized.display === \"/\"\n                            ? \"(repo root)\"\n                            : normalized.display\n                    }`\n                );\n\n                if (this.onFolderChange)\n                    this.onFolderChange(normalized.payload);\n            });\n        }\n\n        if (this.doc) {\n            this.doc.addEventListener(\"keydown\", (e) =>\n                this.handleFolderPickerKeydown(e)\n            );\n        }\n    }\n\n    private normalizeFolderInput(raw: string): {\n        display: string;\n        payload: string;\n    } {\n        const trimmed = raw.trim();\n        if (!trimmed) return { display: \"\", payload: \"\" };\n\n        if (trimmed === \"/\" || trimmed === \"./\" || trimmed === \".\") {\n            return { display: \"/\", payload: \"/\" };\n        }\n\n        const collapsed = trimmed.replace(/\\\\/g, \"/\").replace(/\\/{2,}/g, \"/\");\n        const stripped = collapsed.replace(/^\\/+/, \"\").replace(/\\/+$/, \"\");\n        if (!stripped) return { display: \"/\", payload: \"/\" };\n        return { display: stripped + \"/\", payload: stripped };\n    }\n\n    private normalizeFolderPickerPath(raw: string): string {\n        const trimmed = (raw || \"\").trim();\n        if (!trimmed || trimmed === \"/\" || trimmed === \"./\" || trimmed === \".\")\n            return \"\";\n        const collapsed = trimmed.replace(/\\\\/g, \"/\").replace(/\\/{2,}/g, \"/\");\n        return collapsed.replace(/^\\/+/, \"\").replace(/\\/+$/, \"\");\n    }\n\n    private setGhFolderDisplay(display: string): void {\n        if (this.ghFolderInput) this.ghFolderInput.value = display || \"\";\n        if (!this.ghFolderDisplay) return;\n        if (display) {\n            this.ghFolderDisplay.textContent = display;\n            this.ghFolderDisplay.classList.remove(\"is-placeholder\");\n        } else {\n            this.ghFolderDisplay.textContent = GH_FOLDER_PLACEHOLDER;\n            this.ghFolderDisplay.classList.add(\"is-placeholder\");\n        }\n    }\n\n    private updateFolderControlsEnabled(): void {\n        const enable = !!(\n            this.currentOwner &&\n            this.currentRepo &&\n            this.currentBranch\n        );\n        if (this.ghPickFolderBtn) this.ghPickFolderBtn.disabled = !enable;\n    }\n\n    private listDir(\n        path: string\n    ): Promise<\n        | { ok: true; entries: FolderListEntry[] }\n        | { ok: false; message: string; status?: number }\n    > {\n        return new Promise((resolve) => {\n            const req = { path: path.replace(/^\\/+|\\/+$/g, \"\") };\n            this.folderListWaiters.push({\n                path: req.path,\n                resolve: (v) => resolve(v),\n                reject: (v) => resolve(v),\n            });\n            this.deps.postToPlugin({\n                type: \"GITHUB_FOLDER_LIST\",\n                payload: {\n                    owner: this.currentOwner,\n                    repo: this.currentRepo,\n                    branch: this.currentBranch,\n                    path: req.path,\n                },\n            });\n        });\n    }\n\n    private openFolderPicker(): void {\n        if (!this.currentOwner || !this.currentRepo) {\n            this.deps.log(\"Pick a repository first.\");\n            return;\n        }\n        if (!this.currentBranch) {\n            this.deps.log(\"Pick a branch first.\");\n            return;\n        }\n        if (\n            !(\n                this.folderPickerOverlay &&\n                this.folderPickerTitleEl &&\n                this.folderPickerPathInput &&\n                this.folderPickerListEl\n            )\n        ) {\n            this.deps.log(\"Folder picker UI is unavailable.\");\n            return;\n        }\n\n        this.pickerState.lastFocus =\n            this.doc && this.doc.activeElement instanceof HTMLElement\n                ? this.doc.activeElement\n                : null;\n\n        this.folderPickerOverlay.hidden = false;\n        this.folderPickerOverlay.classList.add(\"is-open\");\n        this.folderPickerOverlay.setAttribute(\"aria-hidden\", \"false\");\n        this.pickerState.isOpen = true;\n\n        this.updateFolderPickerTitle(this.currentBranch);\n\n        const startNormalized = this.normalizeFolderInput(\n            this.ghFolderInput?.value || \"\"\n        );\n        const startPath =\n            startNormalized.payload === \"/\" ? \"\" : startNormalized.payload;\n        this.setFolderPickerPath(startPath, true);\n\n        this.win?.setTimeout(() => {\n            this.folderPickerPathInput?.focus();\n            this.folderPickerPathInput?.select();\n        }, 0);\n    }\n\n    private closeFolderPicker(): void {\n        if (!this.folderPickerOverlay) return;\n        this.folderPickerOverlay.classList.remove(\"is-open\");\n        this.folderPickerOverlay.setAttribute(\"aria-hidden\", \"true\");\n        this.folderPickerOverlay.hidden = true;\n        this.pickerState.isOpen = false;\n        this.pickerState.currentPath = \"\";\n        this.pickerState.refreshNonce++;\n        if (this.folderPickerListEl) {\n            this.folderPickerListEl.replaceChildren(\n                this.createFolderPickerRow(\"Loading\u2026\", {\n                    muted: true,\n                    disabled: true,\n                })\n            );\n        }\n        if (\n            this.pickerState.lastFocus &&\n            this.doc?.contains(this.pickerState.lastFocus)\n        ) {\n            this.pickerState.lastFocus.focus();\n        }\n        this.pickerState.lastFocus = null;\n    }\n\n    private createFolderPickerRow(\n        label: string,\n        options?: { onClick?: () => void; muted?: boolean; disabled?: boolean }\n    ): HTMLButtonElement {\n        if (!this.doc) throw new Error(\"GitHub UI not attached\");\n        const btn = this.doc.createElement(\"button\");\n        btn.type = \"button\";\n        btn.className = \"folder-picker-row\";\n        btn.textContent = label;\n        if (options?.muted) btn.classList.add(\"is-muted\");\n        if (options?.disabled) btn.disabled = true;\n        if (options?.onClick) {\n            // Use mousedown to ensure it fires before blur events and to improve responsiveness\n            btn.addEventListener(\"mousedown\", (event: Event) => {\n                event.preventDefault();\n                // Stop propagation to prevent overlay closing if that was an issue\n                event.stopPropagation();\n                options.onClick?.();\n            });\n        }\n        return btn;\n    }\n\n    private updateFolderPickerTitle(branch: string): void {\n        if (!this.folderPickerTitleEl) return;\n        if (this.currentOwner && this.currentRepo) {\n            this.folderPickerTitleEl.textContent = `${this.currentOwner}/${this.currentRepo} @ ${branch}`;\n        } else {\n            this.folderPickerTitleEl.textContent = \"Select a repository first\";\n        }\n    }\n\n    private setFolderPickerPath(\n        raw: string,\n        refresh = true,\n        syncInput = true\n    ): void {\n        const normalized = this.normalizeFolderPickerPath(raw);\n        this.pickerState.currentPath = normalized;\n        if (syncInput && this.folderPickerPathInput)\n            this.folderPickerPathInput.value = normalized;\n        if (refresh && this.pickerState.isOpen) {\n            void this.refreshFolderPickerList();\n        }\n    }\n\n    private async refreshFolderPickerList(): Promise<void> {\n        if (!(this.folderPickerListEl && this.pickerState.isOpen)) return;\n        const listEl = this.folderPickerListEl;\n        const requestId = ++this.pickerState.refreshNonce;\n\n        listEl.replaceChildren(\n            this.createFolderPickerRow(\"Loading\u2026\", {\n                muted: true,\n                disabled: true,\n            })\n        );\n\n        const path = this.pickerState.currentPath;\n        const res = await this.listDir(path);\n        if (requestId !== this.pickerState.refreshNonce) return;\n\n        if (!res.ok) {\n            const status = typeof res.status === \"number\" ? res.status : 0;\n            if (status === 404) {\n                listEl.replaceChildren(\n                    this.createFolderPickerRow(\n                        \"Folder not found. It will be created during export.\",\n                        { muted: true, disabled: true }\n                    )\n                );\n                return;\n            }\n            if (status === 409) {\n                listEl.replaceChildren(\n                    this.createFolderPickerRow(\n                        \"Cannot open this path: an existing file blocks the folder.\",\n                        { muted: true, disabled: true }\n                    )\n                );\n                return;\n            }\n            const message = res.message ? res.message : \"failed to fetch\";\n            listEl.replaceChildren(\n                this.createFolderPickerRow(`Error: ${message}`, {\n                    muted: true,\n                    disabled: true,\n                })\n            );\n            return;\n        }\n\n        const nodes: HTMLElement[] = [];\n        if (path) {\n            nodes.push(\n                this.createFolderPickerRow(\".. (up one level)\", {\n                    muted: true,\n                    onClick: () => {\n                        const parentParts = this.pickerState.currentPath\n                            .split(\"/\")\n                            .filter(Boolean);\n                        parentParts.pop();\n                        this.setFolderPickerPath(parentParts.join(\"/\"));\n                    },\n                })\n            );\n        }\n\n        const entries = Array.isArray(res.entries) ? res.entries : [];\n\n        const dirs = entries\n            .filter((e) => e.type === \"dir\")\n            .sort((a, b) => (a.name || \"\").localeCompare(b.name || \"\"));\n        if (dirs.length === 0) {\n            nodes.push(\n                this.createFolderPickerRow(\"(no subfolders)\", {\n                    muted: true,\n                    disabled: true,\n                })\n            );\n        } else {\n            for (const d of dirs) {\n                const name = d.name || \"\";\n                nodes.push(\n                    this.createFolderPickerRow(`${name}/`, {\n                        onClick: () => {\n                            const next = this.pickerState.currentPath\n                                ? `${this.pickerState.currentPath}/${name}`\n                                : name;\n                            this.setFolderPickerPath(next);\n                        },\n                    })\n                );\n            }\n        }\n\n        listEl.replaceChildren(...nodes);\n    }\n\n    private handleFolderPickerKeydown(event: KeyboardEvent): void {\n        if (!this.pickerState.isOpen) return;\n        if (event.key === \"Escape\") {\n            event.preventDefault();\n            this.closeFolderPicker();\n        }\n    }\n}\n", "import type { PluginToUi } from \"../../messages\";\nimport type { GithubUiDependencies, AttachContext } from \"./types\";\n\nexport class GithubImportUi {\n    private deps: GithubUiDependencies;\n    private doc: Document | null = null;\n\n    // Elements\n    private ghFetchBtn: HTMLButtonElement | null = null;\n    private ghFetchPathInput: HTMLInputElement | null = null;\n\n    // State\n    private currentOwner = \"\";\n    private currentRepo = \"\";\n    private currentBranch = \"\";\n    private currentFolder = \"\";\n\n    // Callbacks\n    public onTokensFetched: ((tokens: unknown) => void) | null = null;\n\n    constructor(deps: GithubUiDependencies) {\n        this.deps = deps;\n    }\n\n    public attach(context: AttachContext) {\n        this.doc = context.document;\n        this.ghFetchBtn = this.doc.getElementById(\n            \"ghFetchTokensBtn\"\n        ) as HTMLButtonElement;\n        this.ghFetchPathInput = this.doc.getElementById(\n            \"ghFetchPathInput\"\n        ) as HTMLInputElement;\n\n        if (this.ghFetchBtn) {\n            this.ghFetchBtn.addEventListener(\"click\", () => this.fetchTokens());\n        }\n\n        if (this.ghFetchPathInput) {\n            this.ghFetchPathInput.addEventListener(\"input\", () =>\n                this.updateEnabled()\n            );\n        }\n    }\n\n    public setContext(\n        owner: string,\n        repo: string,\n        branch: string,\n        folder: string\n    ) {\n        this.currentOwner = owner;\n        this.currentRepo = repo;\n        this.currentBranch = branch;\n        this.currentFolder = folder;\n        this.updateEnabled();\n    }\n\n    public reset() {\n        this.updateEnabled();\n    }\n\n    public handleMessage(msg: PluginToUi): boolean {\n        if (msg.type === \"GITHUB_FETCH_TOKENS_RESULT\") {\n            this.handleFetchResult(msg.payload);\n            return true;\n        }\n        return false;\n    }\n\n    private updateEnabled() {\n        if (this.ghFetchBtn) {\n            const hasContext = !!(\n                this.currentOwner &&\n                this.currentRepo &&\n                this.currentBranch\n            );\n            const hasPath = !!(\n                this.ghFetchPathInput && this.ghFetchPathInput.value.trim()\n            );\n            this.ghFetchBtn.disabled = !(hasContext && hasPath);\n        }\n    }\n\n    private fetchTokens() {\n        if (!this.currentOwner || !this.currentRepo || !this.currentBranch) {\n            this.deps.log(\"Please select a repository and branch first.\");\n            return;\n        }\n\n        const pathInput = this.ghFetchPathInput?.value.trim() || \"\";\n        if (!pathInput) {\n            this.deps.log(\"Please enter a path to the tokens file.\");\n            return;\n        }\n\n        // Normalize the path - remove leading/trailing slashes\n        const path = pathInput.replace(/^\\/+|\\/+$/g, \"\");\n\n        this.deps.log(\n            `Fetching ${path} from ${this.currentOwner}/${this.currentRepo} (${this.currentBranch})\u2026`\n        );\n        if (this.ghFetchBtn) this.ghFetchBtn.disabled = true;\n\n        const allowHex = !!(\n            this.deps.getAllowHexCheckbox() &&\n            this.deps.getAllowHexCheckbox()!.checked\n        );\n        const contexts = this.deps.getImportContexts();\n\n        this.deps.postToPlugin({\n            type: \"GITHUB_FETCH_TOKENS\",\n            payload: {\n                owner: this.currentOwner,\n                repo: this.currentRepo,\n                branch: this.currentBranch,\n                path,\n                allowHexStrings: allowHex,\n                contexts,\n            },\n        });\n    }\n\n    private handleFetchResult(pl: unknown) {\n        if (this.ghFetchBtn) this.ghFetchBtn.disabled = false;\n\n        if (!pl || typeof pl !== \"object\") return;\n        const payload = pl as Record<string, unknown>;\n\n        const status = typeof payload.status === \"number\" ? payload.status : 0;\n        const message = payload.message || \"unknown error\";\n\n        if (payload.ok) {\n            const json = payload.json;\n            if (!json) {\n                this.deps.log(\"Fetched file is empty or invalid JSON.\");\n                return;\n            }\n            this.deps.log(\n                `Successfully fetched tokens file (${\n                    JSON.stringify(json).length\n                } bytes).`\n            );\n\n            if (this.onTokensFetched) {\n                this.onTokensFetched(json);\n            }\n        } else {\n            this.deps.log(`Fetch failed (status ${status}): ${message}`);\n            if (status === 404) {\n                this.deps.log(\"File not found. Check if the path is correct.\");\n            }\n        }\n    }\n}\n", "import type { PluginToUi, GithubScope, UiToPlugin } from \"../../messages\";\nimport type { GithubUiDependencies, AttachContext } from \"./types\";\n\nexport class GithubExportUi {\n    private deps: GithubUiDependencies;\n    private doc: Document | null = null;\n\n    // Elements\n    private ghExportAndCommitBtn: HTMLButtonElement | null = null;\n    private ghCommitMsgInput: HTMLInputElement | null = null;\n    private ghFilenameInput: HTMLInputElement | null = null;\n    private ghScopeAll: HTMLInputElement | null = null;\n    private ghScopeTypography: HTMLInputElement | null = null;\n    private ghScopeSelected: HTMLInputElement | null = null;\n    private ghCreatePrChk: HTMLInputElement | null = null;\n    private ghPrTitleInput: HTMLInputElement | null = null;\n    private ghPrBodyInput: HTMLTextAreaElement | null = null;\n\n    // State\n    private currentOwner = \"\";\n    private currentRepo = \"\";\n    private currentBranch = \"\";\n    private currentFolder = \"\";\n    private prBaseBranch = \"\";\n    private hasCollections = false;\n    private hasTextStyles = false;\n\n    constructor(deps: GithubUiDependencies) {\n        this.deps = deps;\n    }\n\n    public attach(context: AttachContext) {\n        this.doc = context.document;\n\n        this.ghExportAndCommitBtn = this.doc.getElementById(\n            \"ghExportAndCommitBtn\"\n        ) as HTMLButtonElement;\n        this.ghCommitMsgInput = this.doc.getElementById(\n            \"ghCommitMsgInput\"\n        ) as HTMLInputElement;\n        this.ghFilenameInput = this.doc.getElementById(\n            \"ghFilenameInput\"\n        ) as HTMLInputElement;\n        this.ghScopeAll = this.doc.getElementById(\n            \"ghScopeAll\"\n        ) as HTMLInputElement;\n        this.ghScopeTypography = this.doc.getElementById(\n            \"ghScopeTypography\"\n        ) as HTMLInputElement;\n        this.ghScopeSelected = this.doc.getElementById(\n            \"ghScopeSelected\"\n        ) as HTMLInputElement;\n        this.ghCreatePrChk = this.doc.getElementById(\n            \"ghCreatePrChk\"\n        ) as HTMLInputElement;\n        this.ghPrTitleInput = this.doc.getElementById(\n            \"ghPrTitleInput\"\n        ) as HTMLInputElement;\n        this.ghPrBodyInput = this.doc.getElementById(\n            \"ghPrBodyInput\"\n        ) as HTMLTextAreaElement;\n\n        if (this.ghExportAndCommitBtn) {\n            this.ghExportAndCommitBtn.addEventListener(\"click\", () =>\n                this.handleExportClick()\n            );\n        }\n\n        // Listen for scope changes to update button state\n        [this.ghScopeAll, this.ghScopeTypography, this.ghScopeSelected].forEach(\n            (el) => {\n                if (el)\n                    el.addEventListener(\"change\", () => this.updateEnabled());\n            }\n        );\n    }\n\n    public setContext(\n        owner: string,\n        repo: string,\n        branch: string,\n        folder: string,\n        prBaseBranch: string\n    ) {\n        this.currentOwner = owner;\n        this.currentRepo = repo;\n        this.currentBranch = branch;\n        this.currentFolder = folder;\n        this.prBaseBranch = prBaseBranch;\n        this.updateEnabled();\n    }\n\n    public reset() {\n        this.updateEnabled();\n    }\n\n    public handleMessage(msg: PluginToUi): boolean {\n        if (msg.type === \"GITHUB_COMMIT_RESULT\") {\n            this.handleCommitResult(msg.payload);\n            return true;\n        }\n        if (msg.type === \"GITHUB_PR_RESULT\") {\n            this.handlePrResult(msg.payload);\n            return true;\n        }\n        return false;\n    }\n\n    public updateEnabled() {\n        if (!this.ghExportAndCommitBtn) return;\n\n        // Basic requirements\n        const hasContext = !!(\n            this.currentOwner &&\n            this.currentRepo &&\n            this.currentBranch\n        );\n\n        // Scope validation\n        let scopeValid = true;\n        const scope = this.getSelectedScope();\n\n        if (scope === \"selected\") {\n            const collectionSelect = this.deps.getCollectionSelect();\n            const modeSelect = this.deps.getModeSelect();\n            const hasCollection = !!(\n                collectionSelect && collectionSelect.value\n            );\n            const hasMode = !!(modeSelect && modeSelect.value);\n            scopeValid = hasCollection && hasMode;\n        } else if (scope === \"all\") {\n            // For \"all\" scope, we need at least one collection with variables\n            scopeValid = this.hasCollections;\n        } else if (scope === \"typography\") {\n            // For \"typography\" scope, we need text styles\n            scopeValid = this.hasTextStyles;\n        }\n\n        // Filename validation (basic check, real validation happens on click or input)\n        // For enabling the button, we might be lenient or strict.\n        // The original code called `updateExportCommitEnabled` which checked `filenameValidation.ok`.\n        // Since we don't have the full validation logic here yet (it was in `ui.ts` using `validateFilename`),\n        // let's assume valid if not empty for now, or we can duplicate the validation logic.\n        // Ideally, validation logic should be shared or injected.\n        // For now, let's just check if filename input is present.\n        const hasFilename = !!(\n            this.ghFilenameInput && this.ghFilenameInput.value.trim()\n        );\n\n        this.ghExportAndCommitBtn.disabled = !(\n            hasContext &&\n            scopeValid &&\n            hasFilename\n        );\n    }\n\n    public setCollectionsAvailability(\n        hasCollections: boolean,\n        hasTextStyles: boolean\n    ) {\n        this.hasCollections = hasCollections;\n        this.hasTextStyles = hasTextStyles;\n        this.updateEnabled();\n    }\n\n    private getSelectedScope(): \"all\" | \"selected\" | \"typography\" {\n        if (this.ghScopeAll && this.ghScopeAll.checked) return \"all\";\n        if (this.ghScopeTypography && this.ghScopeTypography.checked)\n            return \"typography\";\n        return \"selected\";\n    }\n\n    private handleExportClick() {\n        if (!this.currentOwner || !this.currentRepo || !this.currentBranch) {\n            this.deps.log(\"Pick a repository and branch first.\");\n            return;\n        }\n\n        const collectionSelect = this.deps.getCollectionSelect();\n        const modeSelect = this.deps.getModeSelect();\n\n        const scope: GithubScope =\n            this.ghScopeAll && this.ghScopeAll.checked\n                ? \"all\"\n                : this.ghScopeTypography && this.ghScopeTypography.checked\n                ? \"typography\"\n                : \"selected\";\n\n        const selectedCollection = collectionSelect\n            ? collectionSelect.value || \"\"\n            : \"\";\n        const selectedMode = modeSelect ? modeSelect.value || \"\" : \"\";\n        const commitMessage = (\n            this.ghCommitMsgInput?.value || \"Update tokens from Figma\"\n        ).trim();\n\n        // Folder is passed via setContext, but we should probably read it from input if it's editable there?\n        // In `ui.ts`, it read `ghFolderInput.value`.\n        // `GithubFolderUi` manages that input.\n        // We should probably rely on `this.currentFolder` being up to date via `setContext` called by orchestrator when folder changes.\n        // But `ghFolderInput` is the source of truth for the user's intent if they typed manually?\n        // `GithubFolderUi` updates `ghFolderInput`.\n        // Let's assume `this.currentFolder` is correct (updated by orchestrator observing `GithubFolderUi`).\n\n        const folder = this.currentFolder;\n        if (!folder || folder === \"/\") {\n            // Original code checked `!normalizedFolder.display`.\n            // If `currentFolder` is empty, it might mean root or not set.\n            // Let's assume orchestrator ensures it's a valid path string.\n            // If it's empty string, it means root?\n            // Original code: `if (!normalizedFolder.display) ... \"Pick a destination folder\"`\n        }\n\n        // Filename validation\n        const filenameRaw = this.ghFilenameInput?.value || \"\";\n        if (!filenameRaw.trim()) {\n            this.deps.log(\"Enter a filename (e.g. tokens.json).\");\n            this.ghFilenameInput?.focus();\n            return;\n        }\n        // Basic validation (simplified from ui.ts)\n        if (!filenameRaw.endsWith(\".json\")) {\n            this.deps.log(\"Filename must end with .json\");\n            this.ghFilenameInput?.focus();\n            return;\n        }\n\n        if (scope === \"selected\") {\n            if (!selectedCollection || !selectedMode) {\n                this.deps.log(\"Pick a collection and a mode before exporting.\");\n                return;\n            }\n        }\n\n        const createPr = !!(this.ghCreatePrChk && this.ghCreatePrChk.checked);\n\n        const payload: UiToPlugin = {\n            type: \"GITHUB_EXPORT_AND_COMMIT\",\n            payload: {\n                owner: this.currentOwner,\n                repo: this.currentRepo,\n                branch: this.currentBranch,\n                folder: folder,\n                filename: filenameRaw,\n                commitMessage,\n                scope,\n                styleDictionary:\n                    !!this.deps.getStyleDictionaryCheckbox()?.checked,\n                flatTokens: !!this.deps.getFlatTokensCheckbox()?.checked,\n                createPr,\n            },\n        };\n\n        if (selectedCollection) payload.payload.collection = selectedCollection;\n        if (selectedMode) payload.payload.mode = selectedMode;\n\n        if (createPr) {\n            payload.payload.prBase = this.prBaseBranch;\n            payload.payload.prTitle = (this.ghPrTitleInput?.value || \"\").trim();\n            payload.payload.prBody = this.ghPrBodyInput?.value || \"\";\n        }\n\n        const scopeLabel =\n            scope === \"all\"\n                ? \"all collections\"\n                : scope === \"typography\"\n                ? \"typography\"\n                : \"selected mode\";\n\n        const fullPath = folder ? `${folder}${filenameRaw}` : filenameRaw; // Simplified path join\n\n        this.deps.log(`GitHub: Export summary \u2192 ${fullPath} (${scopeLabel})`);\n        this.deps.log(\n            createPr\n                ? \"Export, Commit & PR requested\u2026\"\n                : \"Export & Commit requested\u2026\"\n        );\n\n        this.deps.postToPlugin(payload);\n    }\n\n    private handleCommitResult(pl: unknown) {\n        if (!pl || typeof pl !== \"object\") return;\n        const payload = pl as Record<string, unknown>;\n\n        if (payload.ok) {\n            const url = String(payload.commitUrl || \"\");\n            const branch = payload.branch || \"\";\n            const fullPath = payload.fullPath || \"file\";\n\n            this.deps.log(`Commit succeeded (${branch}): ${url || \"(no URL)\"}`);\n            this.deps.log(`Committed ${fullPath}`);\n\n            if (url) {\n                this.addLogLink(url, \"View commit\");\n            }\n\n            if (payload.createdPr) {\n                const pr = payload.createdPr as Record<string, unknown>;\n                this.deps.log(\n                    `PR prepared (#${pr.number}) from ${pr.head} \u2192 ${pr.base}`\n                );\n            }\n        } else {\n            const status =\n                typeof payload.status === \"number\" ? payload.status : 0;\n            const message = payload.message || \"unknown error\";\n            const fullPath = payload.fullPath || \"file\";\n\n            if (status === 304) {\n                this.deps.log(`Commit skipped: ${message} (${fullPath})`);\n            } else {\n                this.deps.log(\n                    `Commit failed (${status}): ${message} (${fullPath})`\n                );\n            }\n        }\n    }\n\n    private handlePrResult(pl: unknown) {\n        if (!pl || typeof pl !== \"object\") return;\n        const payload = pl as Record<string, unknown>;\n\n        if (payload.ok) {\n            this.deps.log(\n                `PR created: #${payload.number} (${payload.head} \u2192 ${payload.base})`\n            );\n            const url = payload.url;\n            if (url && typeof url === \"string\") {\n                this.addLogLink(url, \"View PR\");\n            }\n        } else {\n            this.deps.log(\n                `PR creation failed (${payload.status || 0}): ${\n                    payload.message || \"unknown error\"\n                }`\n            );\n        }\n    }\n\n    private addLogLink(url: string, text: string) {\n        const logEl = this.deps.getLogElement();\n        if (logEl && this.doc) {\n            const wrap = this.doc.createElement(\"div\");\n            const a = this.doc.createElement(\"a\");\n            a.href = url;\n            a.target = \"_blank\";\n            a.textContent = text;\n            wrap.appendChild(a);\n            logEl.appendChild(wrap);\n            (logEl as HTMLElement).scrollTop = (\n                logEl as HTMLElement\n            ).scrollHeight;\n        }\n    }\n}\n", "// src/app/github/ui.ts\n// Orchestrates the GitHub tab UI modules and routes plugin messages.\nimport type { PluginToUi } from \"../messages\";\nimport {\n    GithubUiDependencies,\n    AttachContext,\n    GithubUiApi,\n} from \"./ui/types\";\nimport { GithubAuthUi } from \"./ui/auth\";\nimport { GithubRepoUi } from \"./ui/repo\";\nimport { GithubBranchUi } from \"./ui/branch\";\nimport { GithubFolderUi } from \"./ui/folder\";\nimport { GithubImportUi } from \"./ui/import\";\nimport { GithubExportUi } from \"./ui/export\";\n\nexport function createGithubUi(deps: GithubUiDependencies): GithubUiApi {\n    const authUi = new GithubAuthUi(deps);\n    const repoUi = new GithubRepoUi(deps);\n    const branchUi = new GithubBranchUi(deps);\n    const folderUi = new GithubFolderUi(deps);\n    const importUi = new GithubImportUi(deps);\n    const exportUi = new GithubExportUi(deps);\n\n    wireDependencies();\n\n    function wireDependencies(): void {\n        repoUi.onRepoChange = () => {\n            const { owner, repo } = repoUi.getSelected();\n            branchUi.setRepo(owner, repo);\n            folderUi.reset();\n            importUi.reset();\n            exportUi.reset();\n        };\n\n        branchUi.onBranchChange = (branch) => {\n            const { owner, repo } = repoUi.getSelected();\n            folderUi.setContext(owner, repo, branch);\n\n            const folder = folderUi.getFolder();\n            const prBase = branchUi.getPrBaseBranch();\n\n            importUi.setContext(owner, repo, branch, folder);\n            exportUi.setContext(owner, repo, branch, folder, prBase);\n        };\n\n        folderUi.onFolderChange = (folder) => {\n            const { owner, repo } = repoUi.getSelected();\n            const branch = branchUi.getCurrentBranch();\n            const prBase = branchUi.getPrBaseBranch();\n\n            importUi.setContext(owner, repo, branch, folder);\n            exportUi.setContext(owner, repo, branch, folder, prBase);\n        };\n\n        importUi.onTokensFetched = (tokens) => {\n            const contexts = deps.getImportContexts();\n            if (!contexts.length) {\n                deps.log(\n                    \"No import configuration found. Please set up import settings.\"\n                );\n                return;\n            }\n            deps.log(\"Importing tokens into Figma\u2026\");\n            deps.postToPlugin({\n                type: \"IMPORT_DTCG\",\n                payload: { json: tokens, contexts },\n            });\n        };\n    }\n\n    function attach(context: AttachContext): void {\n        authUi.attach(context);\n        repoUi.attach(context);\n        branchUi.attach(context);\n        folderUi.attach(context);\n        importUi.attach(context);\n        exportUi.attach(context);\n    }\n\n    function handleMessage(msg: PluginToUi): boolean {\n        let handled = false;\n        handled = authUi.handleMessage(msg) || handled;\n        handled = repoUi.handleMessage(msg) || handled;\n        handled = branchUi.handleMessage(msg) || handled;\n        handled = folderUi.handleMessage(msg) || handled;\n        handled = importUi.handleMessage(msg) || handled;\n        handled = exportUi.handleMessage(msg) || handled;\n        return handled;\n    }\n\n    function onSelectionChange(): void {\n        exportUi.updateEnabled();\n    }\n\n    function onCollectionsData(data?: {\n        collections?: Array<{\n            id: string;\n            name: string;\n            modes: Array<{ id: string; name: string }>;\n            variables: Array<{ id: string; name: string; type: string }>;\n        }>;\n        textStyles?: Array<{ id: string; name: string }>;\n    }): void {\n        const hasCollections =\n            !!data?.collections &&\n            data.collections.length > 0 &&\n            data.collections.some((c) => c.variables && c.variables.length > 0);\n        const hasTextStyles = !!(data?.textStyles && data.textStyles.length);\n        exportUi.setCollectionsAvailability(hasCollections, hasTextStyles);\n        exportUi.updateEnabled();\n    }\n\n    return {\n        attach,\n        handleMessage,\n        onSelectionChange,\n        onCollectionsData,\n    };\n}\n", "/**\n * Centralized DOM element references.\n * Populated during DOMContentLoaded.\n */\nexport const uiElements = {\n    logEl: null as HTMLElement | null,\n    rawEl: null as HTMLElement | null,\n\n    exportAllChk: null as HTMLInputElement | null,\n    collectionSelect: null as HTMLSelectElement | null,\n    modeSelect: null as HTMLSelectElement | null,\n\n    fileInput: null as HTMLInputElement | null,\n    importBtn: null as HTMLButtonElement | null,\n    exportBtn: null as HTMLButtonElement | null,\n    exportTypographyBtn: null as HTMLButtonElement | null,\n    exportPickers: null as HTMLElement | null,\n\n    refreshBtn: null as HTMLButtonElement | null,\n\n    shellEl: null as HTMLElement | null,\n    drawerToggleBtn: null as HTMLButtonElement | null,\n    resizeHandleEl: null as HTMLElement | null,\n\n    w3cPreviewEl: null as HTMLElement | null,\n\n    copyRawBtn: null as HTMLButtonElement | null,\n    copyW3cBtn: null as HTMLButtonElement | null,\n    copyLogBtn: null as HTMLButtonElement | null,\n\n    allowHexChk: null as HTMLInputElement | null,\n    styleDictionaryChk: null as HTMLInputElement | null,\n    flatTokensChk: null as HTMLInputElement | null,\n    githubRememberChk: null as HTMLInputElement | null,\n\n    importScopeOverlay: null as HTMLElement | null,\n    importScopeBody: null as HTMLElement | null,\n    importScopeConfirmBtn: null as HTMLButtonElement | null,\n    importScopeCancelBtn: null as HTMLButtonElement | null,\n    importScopeRememberChk: null as HTMLInputElement | null,\n    importScopeMissingEl: null as HTMLElement | null,\n\n    importScopeSummaryEl: null as HTMLElement | null,\n    importScopeSummaryTextEl: null as HTMLElement | null,\n    importScopeClearBtn: null as HTMLButtonElement | null,\n\n    importSkipLogListEl: null as HTMLElement | null,\n    importSkipLogEmptyEl: null as HTMLElement | null,\n};\n\nexport function initDomElements() {\n    if (typeof document === \"undefined\") return;\n\n    uiElements.logEl = document.getElementById(\"log\");\n    uiElements.rawEl = document.getElementById(\"raw\");\n\n    uiElements.exportAllChk = document.getElementById(\n        \"exportAllChk\"\n    ) as HTMLInputElement | null;\n    uiElements.collectionSelect = document.getElementById(\n        \"collectionSelect\"\n    ) as HTMLSelectElement | null;\n    uiElements.modeSelect = document.getElementById(\n        \"modeSelect\"\n    ) as HTMLSelectElement | null;\n\n    uiElements.fileInput = document.getElementById(\n        \"file\"\n    ) as HTMLInputElement | null;\n    uiElements.importBtn = document.getElementById(\n        \"importBtn\"\n    ) as HTMLButtonElement | null;\n    uiElements.exportBtn = document.getElementById(\n        \"exportBtn\"\n    ) as HTMLButtonElement | null;\n    uiElements.exportTypographyBtn = document.getElementById(\n        \"exportTypographyBtn\"\n    ) as HTMLButtonElement | null;\n    uiElements.exportPickers = document.getElementById(\"exportPickers\");\n\n    uiElements.refreshBtn = document.getElementById(\n        \"refreshBtn\"\n    ) as HTMLButtonElement | null;\n\n    uiElements.shellEl = document.querySelector(\".shell\") as HTMLElement | null;\n    uiElements.drawerToggleBtn = document.getElementById(\n        \"drawerToggleBtn\"\n    ) as HTMLButtonElement | null;\n    uiElements.resizeHandleEl = document.getElementById(\"resizeHandle\");\n\n    uiElements.w3cPreviewEl = document.getElementById(\n        \"w3cPreview\"\n    ) as HTMLElement | null;\n\n    uiElements.copyRawBtn = document.getElementById(\n        \"copyRawBtn\"\n    ) as HTMLButtonElement | null;\n    uiElements.copyW3cBtn = document.getElementById(\n        \"copyW3cBtn\"\n    ) as HTMLButtonElement | null;\n    uiElements.copyLogBtn = document.getElementById(\n        \"copyLogBtn\"\n    ) as HTMLButtonElement | null;\n\n    uiElements.allowHexChk = document.getElementById(\n        \"allowHexChk\"\n    ) as HTMLInputElement | null;\n    uiElements.styleDictionaryChk = document.getElementById(\n        \"styleDictionaryChk\"\n    ) as HTMLInputElement | null;\n    uiElements.flatTokensChk = document.getElementById(\n        \"flatTokensChk\"\n    ) as HTMLInputElement | null;\n    uiElements.githubRememberChk = document.getElementById(\n        \"githubRememberChk\"\n    ) as HTMLInputElement | null;\n\n    uiElements.importScopeOverlay =\n        document.getElementById(\"importScopeOverlay\");\n    uiElements.importScopeBody = document.getElementById(\"importScopeBody\");\n    uiElements.importScopeConfirmBtn = document.getElementById(\n        \"importScopeConfirmBtn\"\n    ) as HTMLButtonElement | null;\n    uiElements.importScopeCancelBtn = document.getElementById(\n        \"importScopeCancelBtn\"\n    ) as HTMLButtonElement | null;\n    uiElements.importScopeRememberChk = document.getElementById(\n        \"importScopeRememberChk\"\n    ) as HTMLInputElement | null;\n    uiElements.importScopeMissingEl = document.getElementById(\n        \"importScopeMissingNotice\"\n    );\n\n    uiElements.importScopeSummaryEl =\n        document.getElementById(\"importScopeSummary\");\n    uiElements.importScopeSummaryTextEl = document.getElementById(\n        \"importScopeSummaryText\"\n    );\n    uiElements.importScopeClearBtn = document.getElementById(\n        \"importScopeClearBtn\"\n    ) as HTMLButtonElement | null;\n\n    uiElements.importSkipLogListEl =\n        document.getElementById(\"importSkipLogList\");\n    uiElements.importSkipLogEmptyEl =\n        document.getElementById(\"importSkipLogEmpty\");\n}\n", "import { UiToPlugin } from \"../messages\";\nimport { uiElements } from \"./dom\";\n\n/** Append a message to the log panel and console. */\nexport function log(msg: string): void {\n    const t = new Date().toLocaleTimeString();\n    const line = document.createElement(\"div\");\n    line.textContent = \"[\" + t + \"] \" + msg;\n    if (uiElements.logEl) {\n        uiElements.logEl.appendChild(line);\n        (uiElements.logEl as HTMLElement).scrollTop = (\n            uiElements.logEl as HTMLElement\n        ).scrollHeight;\n    }\n}\n\n/** Send a typed message to the plugin controller. */\nexport function postToPlugin(message: UiToPlugin): void {\n    (\n        parent as unknown as { postMessage: (m: unknown, t: string) => void }\n    ).postMessage({ pluginMessage: message }, \"*\");\n}\n\n/** Format JSON with indentation while collapsing undefined/null gracefully. */\nexport function prettyJson(obj: unknown): string {\n    try {\n        return JSON.stringify(obj, null, 2);\n    } catch {\n        return String(obj);\n    }\n}\n\nexport function copyElText(el: HTMLElement | null, label: string): void {\n    if (!el) return;\n    try {\n        const text = el.textContent ?? \"\";\n        if (\n            navigator.clipboard &&\n            typeof navigator.clipboard.writeText === \"function\"\n        ) {\n            navigator.clipboard\n                .writeText(text)\n                .then(() => {\n                    log(`Copied ${label} to clipboard.`);\n                })\n                .catch(() => {\n                    throw new Error(\"clipboard write failed\");\n                });\n            return;\n        }\n\n        const ta = document.createElement(\"textarea\");\n        ta.value = text;\n        ta.style.position = \"fixed\";\n        ta.style.opacity = \"0\";\n        document.body.appendChild(ta);\n        ta.select();\n        ta.setSelectionRange(0, ta.value.length);\n\n        const ok = document.execCommand(\"copy\");\n        document.body.removeChild(ta);\n\n        if (ok) log(`Copied ${label} to clipboard (${text.length} chars).`);\n        else throw new Error(\"execCommand(copy) returned false\");\n    } catch {\n        log(`Could not copy ${label}.`);\n    }\n}\n", "import {\n    ImportContextOption,\n    ImportLogEntry,\n    ImportPreference,\n} from \"./storage\";\n\nexport type ImportScopeModalState = {\n    options: ImportContextOption[];\n    collections: string[];\n    inputs: HTMLInputElement[];\n    inputsByCollection: Map<string, HTMLInputElement[]>;\n    onConfirm: (selected: string[], remember: boolean) => void;\n};\n\nexport const appState = {\n    importPreference: null as ImportPreference | null,\n    importLogEntries: [] as ImportLogEntry[],\n    importScopeModalState: null as ImportScopeModalState | null,\n    lastImportSelection: [] as string[],\n    systemDarkMode: false,\n\n    // Export state\n    pendingSave: null as {\n        writable: FileSystemWritableFileStream;\n        name: string;\n    } | null,\n\n    // Resize state\n    resizeTracking: null as {\n        pointerId: number;\n        startX: number;\n        startY: number;\n        startWidth: number;\n        startHeight: number;\n    } | null,\n    resizeQueued: null as { width: number; height: number } | null,\n    resizeRaf: 0,\n\n    // Collections state\n    currentCollections: [] as Array<{\n        id: string;\n        name: string;\n        modes: Array<{ id: string; name: string }>;\n        variables: Array<{ id: string; name: string; type: string }>;\n    }>,\n};\n", "import { ImportSummary } from \"../messages\";\n\nexport const IMPORT_PREF_KEY = \"dtcg.importPreference.v1\";\nexport const IMPORT_LOG_KEY = \"dtcg.importLog.v1\";\n\nexport type ImportContextOption = {\n    context: string;\n    collection: string;\n    mode: string;\n};\n\nexport type ImportPreference = { contexts: string[]; updatedAt: number };\n\nexport type ImportLogEntry = {\n    timestamp: number;\n    source?: \"local\" | \"github\";\n    summary: ImportSummary;\n};\n\nexport function normalizeContextList(list: string[]): string[] {\n    const seen = new Set<string>();\n    const out: string[] = [];\n    for (let i = 0; i < list.length; i++) {\n        const raw = String(list[i] ?? \"\").trim();\n        if (!raw) continue;\n        if (seen.has(raw)) continue;\n        seen.add(raw);\n        out.push(raw);\n    }\n    out.sort((a, b) => (a < b ? -1 : a > b ? 1 : 0));\n    return out;\n}\n\nexport function contextsEqual(a: string[], b: string[]): boolean {\n    if (a.length !== b.length) return false;\n    for (let i = 0; i < a.length; i++) if (a[i] !== b[i]) return false;\n    return true;\n}\n\nexport function readImportPreference(): ImportPreference | null {\n    try {\n        const raw = window.localStorage?.getItem(IMPORT_PREF_KEY);\n        if (!raw) return null;\n        const parsed = JSON.parse(raw);\n        if (!parsed || typeof parsed !== \"object\") return null;\n        const ctxs = Array.isArray((parsed as any).contexts)\n            ? normalizeContextList((parsed as any).contexts as string[])\n            : [];\n        const ts =\n            typeof (parsed as any).updatedAt === \"number\"\n                ? Number((parsed as any).updatedAt)\n                : Date.now();\n        if (ctxs.length > 0) return { contexts: ctxs, updatedAt: ts };\n    } catch {\n        /* ignore */\n    }\n    return null;\n}\n\nexport function writeImportPreference(pref: ImportPreference): void {\n    try {\n        window.localStorage?.setItem(IMPORT_PREF_KEY, JSON.stringify(pref));\n    } catch {\n        /* ignore */\n    }\n}\n\nexport function removeImportPreference(): void {\n    try {\n        window.localStorage?.removeItem(IMPORT_PREF_KEY);\n    } catch {\n        /* ignore */\n    }\n}\n\nexport function readImportLog(): ImportLogEntry[] {\n    try {\n        const raw = window.localStorage?.getItem(IMPORT_LOG_KEY);\n        if (!raw) return [];\n        const parsed = JSON.parse(raw);\n        if (!Array.isArray(parsed)) return [];\n        const entries: ImportLogEntry[] = [];\n        for (let i = 0; i < parsed.length; i++) {\n            const entry = parsed[i];\n            if (!entry || typeof entry !== \"object\") continue;\n            const timestamp =\n                typeof (entry as any).timestamp === \"number\"\n                    ? Number((entry as any).timestamp)\n                    : null;\n            const summary = (entry as any).summary as ImportSummary | undefined;\n            const source =\n                (entry as any).source === \"github\"\n                    ? \"github\"\n                    : (entry as any).source === \"local\"\n                    ? \"local\"\n                    : undefined;\n            if (!timestamp || !summary || typeof summary !== \"object\") continue;\n            if (\n                !Array.isArray(summary.appliedContexts) ||\n                !Array.isArray(summary.availableContexts)\n            )\n                continue;\n            if (!Array.isArray(summary.tokensWithRemovedContexts)) {\n                (summary as any).tokensWithRemovedContexts = [];\n            }\n            if (!Array.isArray(summary.skippedContexts)) {\n                (summary as any).skippedContexts = [];\n            }\n            if (!Array.isArray(summary.missingRequestedContexts)) {\n                (summary as any).missingRequestedContexts = [];\n            }\n            if (\n                typeof summary.createdStyles !== \"number\" ||\n                !isFinite(summary.createdStyles)\n            ) {\n                (summary as any).createdStyles = 0;\n            }\n            entries.push({ timestamp, summary, source });\n        }\n        entries.sort((a, b) => a.timestamp - b.timestamp);\n        return entries;\n    } catch {\n        return [];\n    }\n}\n\nexport function writeImportLog(entries: ImportLogEntry[]): void {\n    try {\n        window.localStorage?.setItem(IMPORT_LOG_KEY, JSON.stringify(entries));\n    } catch {\n        /* ignore */\n    }\n}\n", "import { UiToPlugin } from \"../../messages\";\nimport { uiElements } from \"../dom\";\nimport { appState } from \"../state\";\nimport {\n    ImportContextOption,\n    ImportLogEntry,\n    writeImportPreference,\n    removeImportPreference,\n    writeImportLog,\n    normalizeContextList,\n    contextsEqual,\n} from \"../storage\";\nimport { log, postToPlugin } from \"../utils\";\n\nexport function formatContextList(contexts: string[]): string {\n    const normalized = normalizeContextList(contexts);\n    if (normalized.length === 0) return \"All contexts\";\n    const grouped = new Map<string, string[]>();\n    for (let i = 0; i < normalized.length; i++) {\n        const ctx = normalized[i];\n        const slash = ctx.indexOf(\"/\");\n        const collection = slash >= 0 ? ctx.slice(0, slash) : ctx;\n        const mode = slash >= 0 ? ctx.slice(slash + 1) : \"Mode 1\";\n        const coll = collection ? collection : \"Tokens\";\n        const modes = grouped.get(coll) || [];\n        if (!grouped.has(coll)) grouped.set(coll, modes);\n        if (!modes.includes(mode)) modes.push(mode);\n    }\n    const parts: string[] = [];\n    const collections = Array.from(grouped.keys()).sort((a, b) =>\n        a < b ? -1 : a > b ? 1 : 0\n    );\n    for (let i = 0; i < collections.length; i++) {\n        const coll = collections[i];\n        const modes = grouped.get(coll) || [];\n        modes.sort((a, b) => (a < b ? -1 : a > b ? 1 : 0));\n        parts.push(`${coll} (${modes.join(\", \")})`);\n    }\n    return parts.join(\"; \");\n}\n\nexport function renderImportPreferenceSummary(): void {\n    if (\n        !uiElements.importScopeSummaryEl ||\n        !uiElements.importScopeSummaryTextEl\n    )\n        return;\n    const hasPref =\n        !!appState.importPreference &&\n        appState.importPreference.contexts.length > 0;\n    if (uiElements.importScopeClearBtn)\n        uiElements.importScopeClearBtn.disabled = !hasPref;\n    if (!hasPref) {\n        uiElements.importScopeSummaryEl.hidden = true;\n        return;\n    }\n    uiElements.importScopeSummaryEl.hidden = false;\n    const when = new Date(\n        appState.importPreference!.updatedAt\n    ).toLocaleString();\n    uiElements.importScopeSummaryTextEl.textContent = `Remembered import scope (${when}): ${formatContextList(\n        appState.importPreference!.contexts\n    )}.`;\n}\n\nexport function renderImportLog(): void {\n    if (!(uiElements.importSkipLogListEl && uiElements.importSkipLogEmptyEl))\n        return;\n    uiElements.importSkipLogListEl.innerHTML = \"\";\n    if (!appState.importLogEntries || appState.importLogEntries.length === 0) {\n        uiElements.importSkipLogEmptyEl.hidden = false;\n        return;\n    }\n    uiElements.importSkipLogEmptyEl.hidden = true;\n\n    for (let idx = appState.importLogEntries.length - 1; idx >= 0; idx--) {\n        const entry = appState.importLogEntries[idx];\n        const container = document.createElement(\"div\");\n        container.className = \"import-skip-log-entry\";\n\n        const header = document.createElement(\"div\");\n        header.className = \"import-skip-log-entry-header\";\n        const label =\n            entry.source === \"github\" ? \"GitHub import\" : \"Manual import\";\n        header.textContent = `${label} \u2022 ${new Date(\n            entry.timestamp\n        ).toLocaleString()}`;\n        container.appendChild(header);\n\n        const stats = document.createElement(\"div\");\n        stats.className = \"import-skip-log-entry-stats\";\n        const tokensText = `Imported ${entry.summary.importedTokens} of ${entry.summary.totalTokens} tokens.`;\n        const stylesCreated =\n            typeof entry.summary.createdStyles === \"number\"\n                ? entry.summary.createdStyles\n                : undefined;\n        if (typeof stylesCreated === \"number\") {\n            const stylesLabel = stylesCreated === 1 ? \"style\" : \"styles\";\n            stats.textContent = `${tokensText} ${stylesCreated} ${stylesLabel} created.`;\n        } else {\n            stats.textContent = tokensText;\n        }\n        container.appendChild(stats);\n\n        const contextsLine = document.createElement(\"div\");\n        contextsLine.className = \"import-skip-log-entry-contexts\";\n        contextsLine.textContent =\n            \"Applied: \" + formatContextList(entry.summary.appliedContexts);\n        container.appendChild(contextsLine);\n\n        if (entry.summary.skippedContexts.length > 0) {\n            const skippedLine = document.createElement(\"div\");\n            skippedLine.className = \"import-skip-log-entry-contexts\";\n            skippedLine.textContent =\n                \"Skipped modes: \" +\n                formatContextList(\n                    entry.summary.skippedContexts.map((s) => s.context)\n                );\n            container.appendChild(skippedLine);\n        }\n\n        if (entry.summary.missingRequestedContexts.length > 0) {\n            const missingLine = document.createElement(\"div\");\n            missingLine.className = \"import-skip-log-entry-note\";\n            missingLine.textContent =\n                \"Not found in file: \" +\n                formatContextList(entry.summary.missingRequestedContexts);\n            container.appendChild(missingLine);\n        }\n\n        if (entry.summary.selectionFallbackToAll) {\n            const fallbackLine = document.createElement(\"div\");\n            fallbackLine.className = \"import-skip-log-entry-note\";\n            fallbackLine.textContent =\n                \"Requested modes were missing; imported all contexts instead.\";\n            container.appendChild(fallbackLine);\n        }\n\n        if (entry.summary.tokensWithRemovedContexts.length > 0) {\n            const tokenList = document.createElement(\"ul\");\n            tokenList.className = \"import-skip-log-token-list\";\n            const maxTokens = Math.min(\n                entry.summary.tokensWithRemovedContexts.length,\n                10\n            );\n            for (let t = 0; t < maxTokens; t++) {\n                const tok = entry.summary.tokensWithRemovedContexts[t];\n                const li = document.createElement(\"li\");\n                const removedLabel =\n                    tok.removedContexts.length > 0\n                        ? formatContextList(tok.removedContexts)\n                        : \"none\";\n                const keptLabel =\n                    tok.keptContexts.length > 0\n                        ? formatContextList(tok.keptContexts)\n                        : \"\";\n                li.textContent = `${tok.path} \u2014 skipped ${removedLabel}${\n                    keptLabel ? \"; kept \" + keptLabel : \"\"\n                }`;\n                tokenList.appendChild(li);\n            }\n            if (entry.summary.tokensWithRemovedContexts.length > maxTokens) {\n                const more = document.createElement(\"li\");\n                more.textContent = `\u2026and ${\n                    entry.summary.tokensWithRemovedContexts.length - maxTokens\n                } more token(s).`;\n                tokenList.appendChild(more);\n            }\n            container.appendChild(tokenList);\n        }\n\n        if (\n            entry.summary.skippedContexts.length > 0 &&\n            appState.importPreference &&\n            appState.importPreference.contexts.length > 0\n        ) {\n            const tip = document.createElement(\"div\");\n            tip.className = \"import-skip-log-entry-note\";\n            tip.textContent =\n                \"Tip: Clear the remembered import selection to restore skipped modes.\";\n            container.appendChild(tip);\n        }\n\n        uiElements.importSkipLogListEl.appendChild(container);\n    }\n}\n\nexport function addImportLogEntry(entry: ImportLogEntry): void {\n    appState.importLogEntries.push(entry);\n    if (appState.importLogEntries.length > 10) {\n        appState.importLogEntries = appState.importLogEntries.slice(\n            appState.importLogEntries.length - 10\n        );\n    }\n    writeImportLog(appState.importLogEntries);\n    renderImportLog();\n}\n\nexport function setImportPreference(contexts: string[]): void {\n    const normalized = normalizeContextList(contexts);\n    if (normalized.length === 0) {\n        clearImportPreference(false);\n        return;\n    }\n    const same =\n        appState.importPreference &&\n        contextsEqual(appState.importPreference.contexts, normalized);\n    appState.importPreference = { contexts: normalized, updatedAt: Date.now() };\n    writeImportPreference(appState.importPreference);\n    renderImportPreferenceSummary();\n    if (!same) log(\"Remembered import selection for future imports.\");\n}\n\nexport function clearImportPreference(logChange: boolean): void {\n    if (!appState.importPreference) return;\n    appState.importPreference = null;\n    removeImportPreference();\n    renderImportPreferenceSummary();\n    if (logChange)\n        log(\n            \"Cleared remembered import selection. Next import will prompt for modes.\"\n        );\n}\n\nfunction collectContextsFromJson(root: unknown): ImportContextOption[] {\n    const grouped = new Map<string, Set<string>>();\n\n    function visit(node: unknown, path: string[]): void {\n        if (Array.isArray(node)) {\n            for (let i = 0; i < node.length; i++) visit(node[i], path);\n            return;\n        }\n        if (!node || typeof node !== \"object\") return;\n\n        const obj = node as Record<string, unknown>;\n        if (Object.prototype.hasOwnProperty.call(obj, \"$value\")) {\n            const rawCollection = path[0] ? String(path[0]).trim() : \"Tokens\";\n            let mode = \"Mode 1\";\n            try {\n                const ext = obj[\"$extensions\"];\n                if (ext && typeof ext === \"object\") {\n                    const cf = (ext as any)[\"com.figma\"];\n                    if (\n                        cf &&\n                        typeof cf === \"object\" &&\n                        typeof (cf as any).modeName === \"string\"\n                    ) {\n                        const candidate = String((cf as any).modeName).trim();\n                        if (candidate) mode = candidate;\n                    }\n                }\n            } catch {\n                /* ignore */\n            }\n            const collection = rawCollection ? rawCollection : \"Tokens\";\n            const set = grouped.get(collection) || new Set<string>();\n            if (!grouped.has(collection)) grouped.set(collection, set);\n            set.add(mode);\n            return;\n        }\n\n        for (const key in obj) {\n            if (!Object.prototype.hasOwnProperty.call(obj, key)) continue;\n            if (key.startsWith(\"$\")) continue;\n            visit((obj as any)[key], path.concat(String(key)));\n        }\n    }\n\n    visit(root, []);\n\n    const options: ImportContextOption[] = [];\n    const collections = Array.from(grouped.keys()).sort((a, b) =>\n        a < b ? -1 : a > b ? 1 : 0\n    );\n    for (let i = 0; i < collections.length; i++) {\n        const collection = collections[i];\n        const modes = Array.from(grouped.get(collection) || []).sort((a, b) =>\n            a < b ? -1 : a > b ? 1 : 0\n        );\n        for (let j = 0; j < modes.length; j++) {\n            const mode = modes[j];\n            options.push({\n                context: `${collection}/${mode}`,\n                collection,\n                mode,\n            });\n        }\n    }\n    return options;\n}\n\nexport function updateImportScopeConfirmState(): void {\n    if (!appState.importScopeModalState) return;\n    const state = appState.importScopeModalState;\n    let allCollectionsSelected = true;\n    for (let i = 0; i < state.collections.length; i++) {\n        const collection = state.collections[i];\n        const inputs = state.inputsByCollection.get(collection) || [];\n        if (!inputs.some((input) => input.checked)) {\n            allCollectionsSelected = false;\n            break;\n        }\n    }\n    if (uiElements.importScopeConfirmBtn) {\n        uiElements.importScopeConfirmBtn.disabled = !allCollectionsSelected;\n        const label =\n            state.collections.length > 1\n                ? \"Import selected modes\"\n                : \"Import selected mode\";\n        uiElements.importScopeConfirmBtn.textContent = label;\n    }\n}\n\nlet importScopeKeyListenerAttached = false;\n\nexport function handleImportScopeKeydown(ev: KeyboardEvent): void {\n    if (ev.key === \"Escape\") {\n        ev.preventDefault();\n        closeImportScopeModal();\n    }\n}\n\nexport function openImportScopeModal(opts: {\n    options: ImportContextOption[];\n    initialSelection: string[];\n    rememberInitially: boolean;\n    missingPreferred: string[];\n    onConfirm: (selected: string[], remember: boolean) => void;\n}): void {\n    if (\n        !uiElements.importScopeOverlay ||\n        !uiElements.importScopeBody ||\n        !uiElements.importScopeConfirmBtn ||\n        !uiElements.importScopeCancelBtn\n    ) {\n        opts.onConfirm(opts.initialSelection, opts.rememberInitially);\n        return;\n    }\n\n    uiElements.importScopeBody.innerHTML = \"\";\n\n    const grouped = new Map<string, ImportContextOption[]>();\n    for (let i = 0; i < opts.options.length; i++) {\n        const option = opts.options[i];\n        const list = grouped.get(option.collection) || [];\n        if (!grouped.has(option.collection))\n            grouped.set(option.collection, list);\n        list.push(option);\n    }\n\n    const collections = Array.from(grouped.keys()).sort((a, b) =>\n        a < b ? -1 : a > b ? 1 : 0\n    );\n    appState.importScopeModalState = {\n        options: opts.options,\n        collections,\n        inputs: [],\n        inputsByCollection: new Map(),\n        onConfirm: opts.onConfirm,\n    };\n\n    const initialSelectionsByCollection = new Map<string, string>();\n    for (let i = 0; i < opts.initialSelection.length; i++) {\n        const ctx = opts.initialSelection[i];\n        const match = opts.options.find((opt) => opt.context === ctx);\n        if (match)\n            initialSelectionsByCollection.set(match.collection, match.context);\n    }\n\n    for (let i = 0; i < collections.length; i++) {\n        const collection = collections[i];\n        const groupEl = document.createElement(\"div\");\n        groupEl.className = \"import-scope-group\";\n        const heading = document.createElement(\"h3\");\n        heading.textContent = collection;\n        groupEl.appendChild(heading);\n\n        const modes = (grouped.get(collection) || []).sort((a, b) =>\n            a.mode < b.mode ? -1 : a.mode > b.mode ? 1 : 0\n        );\n        const defaultContext =\n            initialSelectionsByCollection.get(collection) ||\n            modes[0]?.context ||\n            null;\n        const radioName = `importScopeMode_${i}`;\n        for (let j = 0; j < modes.length; j++) {\n            const opt = modes[j];\n            const label = document.createElement(\"label\");\n            label.className = \"import-scope-mode\";\n            const radio = document.createElement(\"input\");\n            radio.type = \"radio\";\n            radio.name = radioName;\n            radio.value = opt.context;\n            radio.checked = defaultContext === opt.context;\n            radio.addEventListener(\"change\", updateImportScopeConfirmState);\n            appState.importScopeModalState.inputs.push(radio);\n            const list =\n                appState.importScopeModalState.inputsByCollection.get(\n                    collection\n                ) || [];\n            if (\n                !appState.importScopeModalState.inputsByCollection.has(\n                    collection\n                )\n            ) {\n                appState.importScopeModalState.inputsByCollection.set(\n                    collection,\n                    list\n                );\n            }\n            list.push(radio);\n\n            const span = document.createElement(\"span\");\n            span.textContent = opt.mode;\n\n            label.appendChild(radio);\n            label.appendChild(span);\n            groupEl.appendChild(label);\n        }\n\n        uiElements.importScopeBody.appendChild(groupEl);\n    }\n\n    if (uiElements.importScopeRememberChk)\n        uiElements.importScopeRememberChk.checked = opts.rememberInitially;\n    if (uiElements.importScopeMissingEl) {\n        if (opts.missingPreferred.length > 0) {\n            uiElements.importScopeMissingEl.hidden = false;\n            uiElements.importScopeMissingEl.textContent =\n                \"Previously remembered modes not present in this file: \" +\n                formatContextList(opts.missingPreferred);\n        } else {\n            uiElements.importScopeMissingEl.hidden = true;\n            uiElements.importScopeMissingEl.textContent = \"\";\n        }\n    }\n\n    updateImportScopeConfirmState();\n\n    uiElements.importScopeOverlay.hidden = false;\n    uiElements.importScopeOverlay.classList.add(\"is-open\");\n    uiElements.importScopeOverlay.setAttribute(\"aria-hidden\", \"false\");\n    if (!importScopeKeyListenerAttached) {\n        window.addEventListener(\"keydown\", handleImportScopeKeydown, true);\n        importScopeKeyListenerAttached = true;\n    }\n    if (uiElements.importScopeConfirmBtn)\n        uiElements.importScopeConfirmBtn.focus();\n}\n\nexport function closeImportScopeModal(): void {\n    if (!uiElements.importScopeOverlay) return;\n    uiElements.importScopeOverlay.classList.remove(\"is-open\");\n    uiElements.importScopeOverlay.hidden = true;\n    uiElements.importScopeOverlay.setAttribute(\"aria-hidden\", \"true\");\n    if (importScopeKeyListenerAttached) {\n        window.removeEventListener(\"keydown\", handleImportScopeKeydown, true);\n        importScopeKeyListenerAttached = false;\n    }\n    appState.importScopeModalState = null;\n}\n\nexport function performImport(\n    json: unknown,\n    allowHex: boolean,\n    contexts: string[]\n): void {\n    const normalized = normalizeContextList(contexts);\n    const payload: UiToPlugin =\n        normalized.length > 0\n            ? {\n                  type: \"IMPORT_DTCG\",\n                  payload: {\n                      json,\n                      allowHexStrings: allowHex,\n                      contexts: normalized,\n                  },\n              }\n            : {\n                  type: \"IMPORT_DTCG\",\n                  payload: { json, allowHexStrings: allowHex },\n              };\n    postToPlugin(payload);\n    appState.lastImportSelection = normalized.slice();\n    const label =\n        normalized.length > 0 ? formatContextList(normalized) : \"all contexts\";\n    log(`Import requested (${label}).`);\n}\n\nexport function startImportFlow(json: unknown, allowHex: boolean): void {\n    const options = collectContextsFromJson(json);\n    if (options.length === 0) {\n        performImport(json, allowHex, []);\n        return;\n    }\n\n    const grouped = new Map<string, ImportContextOption[]>();\n    for (let i = 0; i < options.length; i++) {\n        const option = options[i];\n        const list = grouped.get(option.collection) || [];\n        if (!grouped.has(option.collection))\n            grouped.set(option.collection, list);\n        list.push(option);\n    }\n\n    const availableSet = new Set(options.map((opt) => opt.context));\n    const missingPreferred: string[] = [];\n    let rememberInitially = false;\n    const initialSelectionsByCollection = new Map<string, string>();\n\n    if (\n        appState.importPreference &&\n        appState.importPreference.contexts.length > 0\n    ) {\n        for (let i = 0; i < appState.importPreference.contexts.length; i++) {\n            const ctx = appState.importPreference.contexts[i];\n            if (availableSet.has(ctx)) {\n                const match = options.find((opt) => opt.context === ctx);\n                if (match) {\n                    initialSelectionsByCollection.set(\n                        match.collection,\n                        match.context\n                    );\n                    rememberInitially = true;\n                }\n            } else {\n                missingPreferred.push(ctx);\n            }\n        }\n    }\n\n    const collections = Array.from(grouped.keys()).sort((a, b) =>\n        a < b ? -1 : a > b ? 1 : 0\n    );\n    for (let i = 0; i < collections.length; i++) {\n        const collection = collections[i];\n        if (!initialSelectionsByCollection.has(collection)) {\n            const modes = (grouped.get(collection) || []).sort((a, b) =>\n                a.mode < b.mode ? -1 : a.mode > b.mode ? 1 : 0\n            );\n            if (modes.length > 0)\n                initialSelectionsByCollection.set(collection, modes[0].context);\n        }\n    }\n\n    const initialSelection = collections\n        .map((collection) => initialSelectionsByCollection.get(collection))\n        .filter((ctx): ctx is string => typeof ctx === \"string\");\n\n    const requiresChoice = collections.some((collection) => {\n        const list = grouped.get(collection) || [];\n        return list.length > 1;\n    });\n\n    if (!requiresChoice) {\n        performImport(json, allowHex, initialSelection);\n        return;\n    }\n\n    openImportScopeModal({\n        options,\n        initialSelection,\n        rememberInitially,\n        missingPreferred,\n        onConfirm: (selected, remember) => {\n            if (remember) setImportPreference(selected);\n            else if (appState.importPreference) clearImportPreference(true);\n            performImport(json, allowHex, selected);\n        },\n    });\n}\n\nexport function getPreferredImportContexts(): string[] {\n    if (\n        appState.importPreference &&\n        appState.importPreference.contexts.length > 0\n    )\n        return appState.importPreference.contexts.slice();\n    if (appState.lastImportSelection.length > 0)\n        return appState.lastImportSelection.slice();\n    return [];\n}\n", "import { appState } from \"../state\";\n\nexport function prettyExportName(original: string | undefined | null): string {\n    const name =\n        original && typeof original === \"string\" ? original : \"tokens.json\";\n    const m = name.match(/^(.*)_mode=(.*)\\.tokens\\.json$/);\n    if (m) {\n        const collection = m[1].trim();\n        const mode = m[2].trim();\n        return `${collection} - ${mode}.json`;\n    }\n    return name.endsWith(\".json\") ? name : name + \".json\";\n}\n\nexport function supportsFilePicker(): boolean {\n    return typeof (window as any).showSaveFilePicker === \"function\";\n}\n\nexport async function beginPendingSave(\n    suggestedName: string\n): Promise<boolean> {\n    try {\n        if (!supportsFilePicker()) return false;\n        const handle = await (window as any).showSaveFilePicker({\n            suggestedName,\n            types: [\n                {\n                    description: \"JSON\",\n                    accept: { \"application/json\": [\".json\"] },\n                },\n            ],\n        });\n        const writable: FileSystemWritableFileStream =\n            await handle.createWritable();\n        appState.pendingSave = { writable, name: suggestedName };\n        return true;\n    } catch {\n        appState.pendingSave = null;\n        return false;\n    }\n}\n\nexport async function finishPendingSave(text: string): Promise<boolean> {\n    if (!appState.pendingSave) return false;\n    try {\n        await appState.pendingSave.writable.write(\n            new Blob([text], { type: \"application/json\" })\n        );\n        await appState.pendingSave.writable.close();\n        return true;\n    } catch {\n        try {\n            await appState.pendingSave.writable.close();\n        } catch {\n            /* ignore */\n        }\n        return false;\n    } finally {\n        appState.pendingSave = null;\n    }\n}\n\nexport function triggerJsonDownload(filename: string, text: string): void {\n    try {\n        const blob = new Blob([text], { type: \"application/json\" });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement(\"a\");\n        a.href = url;\n        a.download = filename;\n        a.style.position = \"absolute\";\n        a.style.left = \"-9999px\";\n        document.body.appendChild(a);\n        a.click();\n        setTimeout(() => {\n            URL.revokeObjectURL(url);\n            a.remove();\n        }, 0);\n    } catch {\n        /* ignore */\n    }\n}\n", "import { appState } from \"../state\";\nimport { uiElements } from \"../dom\";\nimport { postToPlugin } from \"../utils\";\n\nexport function postResize(width: number, height: number): void {\n    const w = Math.max(720, Math.min(1600, Math.floor(width)));\n    const h = Math.max(420, Math.min(1200, Math.floor(height)));\n    postToPlugin({ type: \"UI_RESIZE\", payload: { width: w, height: h } });\n}\n\nexport function queueResize(width: number, height: number): void {\n    appState.resizeQueued = { width, height };\n    if (appState.resizeRaf !== 0) return;\n    appState.resizeRaf = window.requestAnimationFrame(() => {\n        appState.resizeRaf = 0;\n        if (!appState.resizeQueued) return;\n        postResize(appState.resizeQueued.width, appState.resizeQueued.height);\n        appState.resizeQueued = null;\n    });\n}\n\nfunction applyResizeDelta(ev: PointerEvent): void {\n    if (\n        !appState.resizeTracking ||\n        ev.pointerId !== appState.resizeTracking.pointerId\n    )\n        return;\n    const dx = ev.clientX - appState.resizeTracking.startX;\n    const dy = ev.clientY - appState.resizeTracking.startY;\n    const nextW = appState.resizeTracking.startWidth + dx;\n    const nextH = appState.resizeTracking.startHeight + dy;\n    queueResize(nextW, nextH);\n    ev.preventDefault();\n}\n\nexport function endResize(ev: PointerEvent): void {\n    if (\n        !appState.resizeTracking ||\n        ev.pointerId !== appState.resizeTracking.pointerId\n    )\n        return;\n    applyResizeDelta(ev);\n    window.removeEventListener(\"pointermove\", handleResizeMove, true);\n    window.removeEventListener(\"pointerup\", endResize, true);\n    window.removeEventListener(\"pointercancel\", cancelResize, true);\n    if (uiElements.resizeHandleEl) {\n        try {\n            uiElements.resizeHandleEl.releasePointerCapture(\n                appState.resizeTracking.pointerId\n            );\n        } catch {\n            /* ignore */\n        }\n    }\n    appState.resizeTracking = null;\n}\n\nexport function cancelResize(ev: PointerEvent): void {\n    if (\n        !appState.resizeTracking ||\n        ev.pointerId !== appState.resizeTracking.pointerId\n    )\n        return;\n    window.removeEventListener(\"pointermove\", handleResizeMove, true);\n    window.removeEventListener(\"pointerup\", endResize, true);\n    window.removeEventListener(\"pointercancel\", cancelResize, true);\n    if (uiElements.resizeHandleEl) {\n        try {\n            uiElements.resizeHandleEl.releasePointerCapture(\n                appState.resizeTracking.pointerId\n            );\n        } catch {\n            /* ignore */\n        }\n    }\n    appState.resizeTracking = null;\n}\n\nexport function handleResizeMove(ev: PointerEvent): void {\n    applyResizeDelta(ev);\n}\n\nexport function autoFitOnce(): void {\n    if (typeof document === \"undefined\") return;\n    const contentW = Math.max(\n        document.documentElement.scrollWidth,\n        document.body ? document.body.scrollWidth : 0\n    );\n    const contentH = Math.max(\n        document.documentElement.scrollHeight,\n        document.body ? document.body.scrollHeight : 0\n    );\n    const vw = window.innerWidth;\n    const vh = window.innerHeight;\n    const needsW = contentW > vw ? contentW : vw;\n    const needsH = contentH > vh ? contentH : vh;\n    if (needsW > vw || needsH > vh) postResize(needsW, needsH);\n}\n", "// src/app/ui.ts\n// In-panel UI logic for the plugin: dom wiring, GitHub workflows, and export helpers.\n// - Mirrors plugin state via postMessage so the UI can function offline\n// - Provides guarded DOM helpers to survive partial renders or optional features\n\nimport type { PluginToUi } from \"./messages\";\nimport \"./ui.css\";\nimport { createGithubUi } from \"./github/ui\";\n\n/* -------------------------------------------------------\n * Globals (assigned after DOMContentLoaded)\n * ----------------------------------------------------- */\nimport { uiElements, initDomElements } from \"./ui/dom\";\nimport { log, postToPlugin, prettyJson, copyElText } from \"./ui/utils\";\nimport { appState } from \"./ui/state\";\nimport { readImportPreference, readImportLog } from \"./ui/storage\";\nimport {\n    renderImportPreferenceSummary,\n    renderImportLog,\n    addImportLogEntry,\n    clearImportPreference,\n    closeImportScopeModal,\n    startImportFlow,\n    getPreferredImportContexts,\n} from \"./ui/features/import\";\nimport {\n    prettyExportName,\n    beginPendingSave,\n    finishPendingSave,\n    triggerJsonDownload,\n} from \"./ui/features/export\";\nimport {\n    endResize,\n    cancelResize,\n    handleResizeMove,\n    autoFitOnce,\n} from \"./ui/features/resize\";\n\n/* -------------------------------------------------------\n * Shared helpers\n * ----------------------------------------------------- */\nconst prefersDarkQuery =\n    typeof window !== \"undefined\" &&\n    typeof window.matchMedia === \"function\"\n        ? window.matchMedia(\"(prefers-color-scheme: dark)\")\n        : null;\n\nfunction applyTheme(): void {\n    if (typeof document === \"undefined\") return;\n    const effective = appState.systemDarkMode ? \"dark\" : \"light\";\n    const root = document.documentElement;\n    if (effective === \"light\") {\n        root.setAttribute(\"data-theme\", \"light\");\n    } else {\n        root.removeAttribute(\"data-theme\");\n    }\n    root.style.colorScheme = effective;\n}\n\nfunction primeTheme(): void {\n    if (!prefersDarkQuery) {\n        applyTheme();\n        return;\n    }\n\n    appState.systemDarkMode = prefersDarkQuery.matches;\n    applyTheme();\n    prefersDarkQuery.addEventListener(\"change\", (e) => {\n        appState.systemDarkMode = e.matches;\n        applyTheme();\n    });\n}\n\nprimeTheme();\n\n/* -------------------------------------------------------\n * Collections / logging\n * ----------------------------------------------------- */\n\nconst githubUi = createGithubUi({\n    postToPlugin: (message) => postToPlugin(message),\n    log: (message) => log(message),\n    getLogElement: () => uiElements.logEl,\n    getCollectionSelect: () => uiElements.collectionSelect,\n    getModeSelect: () => uiElements.modeSelect,\n    getAllowHexCheckbox: () => uiElements.allowHexChk,\n    getStyleDictionaryCheckbox: () => uiElements.styleDictionaryChk,\n    getFlatTokensCheckbox: () => uiElements.flatTokensChk,\n    getImportContexts: () => getPreferredImportContexts(),\n});\n\n/** Remove every option from a select without replacing the node. */\nfunction clearSelect(sel: HTMLSelectElement): void {\n    while (sel.options.length > 0) sel.remove(0);\n}\n\n/** Update button/checkbox disabled states based on current selections. */\nfunction setDisabledStates(): void {\n    if (uiElements.importBtn && uiElements.fileInput) {\n        const hasFile = !!(\n            uiElements.fileInput.files && uiElements.fileInput.files.length > 0\n        );\n        uiElements.importBtn.disabled = !hasFile;\n    }\n\n    if (\n        uiElements.exportBtn &&\n        uiElements.exportAllChk &&\n        uiElements.collectionSelect &&\n        uiElements.modeSelect &&\n        uiElements.exportPickers\n    ) {\n        const exportAll = !!uiElements.exportAllChk.checked;\n        if (exportAll) {\n            uiElements.exportBtn.disabled = false;\n            (uiElements.exportPickers as HTMLElement).style.opacity = \"0.5\";\n        } else {\n            (uiElements.exportPickers as HTMLElement).style.opacity = \"1\";\n            const hasSelection =\n                !!uiElements.collectionSelect.value &&\n                !!uiElements.modeSelect.value;\n            uiElements.exportBtn.disabled = !hasSelection;\n        }\n    }\n\n    if (uiElements.exportTypographyBtn) {\n        uiElements.exportTypographyBtn.disabled = false;\n    }\n}\n\n/** Render the collections/modes dropdowns from plugin-provided data. */\nfunction populateCollections(data: {\n    collections: Array<{\n        id: string;\n        name: string;\n        modes: Array<{ id: string; name: string }>;\n        variables: Array<{ id: string; name: string; type: string }>;\n    }>;\n}): void {\n    appState.currentCollections = data.collections;\n    if (!(uiElements.collectionSelect && uiElements.modeSelect)) return;\n\n    clearSelect(uiElements.collectionSelect);\n    for (let i = 0; i < data.collections.length; i++) {\n        const c = data.collections[i];\n        const opt = document.createElement(\"option\");\n        opt.value = c.name;\n        opt.textContent = c.name;\n        uiElements.collectionSelect.appendChild(opt);\n    }\n    onCollectionChange();\n}\n\n/** Update mode selection and preview when the collection dropdown changes. */\nfunction onCollectionChange(): void {\n    if (!(uiElements.collectionSelect && uiElements.modeSelect)) return;\n\n    const selected = uiElements.collectionSelect.value;\n    clearSelect(uiElements.modeSelect);\n\n    let firstModeSet = false;\n    for (let i = 0; i < appState.currentCollections.length; i++) {\n        const c = appState.currentCollections[i];\n        if (c.name === selected) {\n            for (let j = 0; j < c.modes.length; j++) {\n                const m = c.modes[j];\n                const opt = document.createElement(\"option\");\n                opt.value = m.name;\n                opt.textContent = m.name;\n                uiElements.modeSelect.appendChild(opt);\n            }\n            // ensure a default mode is selected for enablement logic\n            if (\n                uiElements.modeSelect.options.length > 0 &&\n                uiElements.modeSelect.selectedIndex === -1\n            ) {\n                uiElements.modeSelect.selectedIndex = 0;\n                firstModeSet = true;\n            }\n            break;\n        }\n    }\n\n    setDisabledStates();\n    githubUi.onSelectionChange();\n\n    // If we auto-set a mode (firstModeSet), update the preview as well\n    if (firstModeSet) requestPreviewForCurrent();\n}\n\n/** Restore the most recently used collection/mode pair. */\nfunction applyLastSelection(\n    last: { collection: string; mode: string } | null\n): void {\n    if (!last || !(uiElements.collectionSelect && uiElements.modeSelect))\n        return;\n\n    let found = false;\n    for (let i = 0; i < uiElements.collectionSelect.options.length; i++) {\n        if (uiElements.collectionSelect.options[i].value === last.collection) {\n            uiElements.collectionSelect.selectedIndex = i;\n            found = true;\n            break;\n        }\n    }\n\n    onCollectionChange();\n\n    if (found) {\n        for (let j = 0; j < uiElements.modeSelect.options.length; j++) {\n            if (uiElements.modeSelect.options[j].value === last.mode) {\n                uiElements.modeSelect.selectedIndex = j;\n                break;\n            }\n        }\n    }\n\n    setDisabledStates();\n}\n\n/** Ask the plugin for a preview of the currently selected token scope. */\nfunction requestPreviewForCurrent(): void {\n    if (!(uiElements.collectionSelect && uiElements.modeSelect)) return;\n    const collection = uiElements.collectionSelect.value || \"\";\n    const mode = uiElements.modeSelect.value || \"\";\n    if (!collection || !mode) {\n        if (uiElements.w3cPreviewEl)\n            uiElements.w3cPreviewEl.textContent =\n                \"{ /* select a collection & mode to preview */ }\";\n        return;\n    }\n    const styleDictionary = !!(\n        uiElements.styleDictionaryChk && uiElements.styleDictionaryChk.checked\n    );\n    const flatTokens = !!(\n        uiElements.flatTokensChk && uiElements.flatTokensChk.checked\n    );\n    postToPlugin({\n        type: \"PREVIEW_REQUEST\",\n        payload: { collection, mode, styleDictionary, flatTokens },\n    });\n}\n\n/* -------------------------------------------------------\n * GitHub: Branch helpers (Variant 4)\n * ----------------------------------------------------- */\n/** Toggle the branch select and associated placeholders. */\n\n/* -------------------------------------------------------\n * Message pump\n * ----------------------------------------------------- */\nwindow.addEventListener(\"message\", async (event: MessageEvent) => {\n    const data: unknown = (event as unknown as { data?: unknown }).data;\n    if (!data || typeof data !== \"object\") return;\n\n    let msg: PluginToUi | any | null = null;\n    if (\n        (data as any).pluginMessage &&\n        typeof (data as any).pluginMessage === \"object\"\n    ) {\n        const maybe = (data as any).pluginMessage;\n        if (maybe && typeof maybe.type === \"string\") msg = maybe;\n    }\n    if (!msg) return;\n\n    // Keep generic INFO/ERROR logs visible\n    if (msg.type === \"ERROR\") {\n        log(\"ERROR: \" + (msg.payload?.message ?? \"\"));\n        return;\n    }\n    if (msg.type === \"INFO\") {\n        log(msg.payload?.message ?? \"\");\n        return;\n    }\n\n    if (msg.type === \"IMPORT_SUMMARY\") {\n        const summary = msg.payload.summary;\n        if (summary && Array.isArray(summary.appliedContexts)) {\n            appState.lastImportSelection = summary.appliedContexts.slice();\n        } else {\n            appState.lastImportSelection = [];\n        }\n        addImportLogEntry({\n            timestamp: msg.payload.timestamp,\n            source: msg.payload.source,\n            summary,\n        });\n        renderImportPreferenceSummary();\n        return;\n    }\n\n    if (githubUi.handleMessage(msg)) return;\n\n    if (msg.type === \"EXPORT_RESULT\") {\n        const files = Array.isArray(msg.payload?.files)\n            ? msg.payload.files\n            : [];\n        if (files.length === 0) {\n            log(\"Nothing to export.\");\n            return;\n        }\n\n        if (appState.pendingSave && files.length === 1) {\n            const only = files[0];\n            const fname = prettyExportName(only?.name);\n            const text = prettyJson(only?.json);\n\n            const ok = await finishPendingSave(text);\n            if (ok) {\n                log(\"Saved \" + fname + \" via file picker.\");\n                const div = document.createElement(\"div\");\n                const link = document.createElement(\"a\");\n                link.href = \"#\";\n                link.textContent = \"Download \" + fname + \" again\";\n                link.addEventListener(\"click\", (e) => {\n                    e.preventDefault();\n                    triggerJsonDownload(fname, text);\n                });\n                if (uiElements.logEl) {\n                    div.appendChild(link);\n                    uiElements.logEl.appendChild(div);\n                    (uiElements.logEl as HTMLElement).scrollTop = (\n                        uiElements.logEl as HTMLElement\n                    ).scrollHeight;\n                }\n                log(\"Export ready.\");\n                return;\n            }\n            log(\n                \"Could not write via file picker; falling back to download links.\"\n            );\n        }\n\n        setDrawerOpen(true);\n        for (let k = 0; k < files.length; k++) {\n            const f = files[k];\n            const fname = prettyExportName(f?.name);\n            const text = prettyJson(f?.json);\n            triggerJsonDownload(fname, text);\n\n            const div = document.createElement(\"div\");\n            const link = document.createElement(\"a\");\n            link.href = \"#\";\n            link.textContent = \"Download \" + fname;\n            link.addEventListener(\"click\", (e) => {\n                e.preventDefault();\n                triggerJsonDownload(fname, text);\n            });\n            if (uiElements.logEl) {\n                div.appendChild(link);\n                uiElements.logEl.appendChild(div);\n                (uiElements.logEl as HTMLElement).scrollTop = (\n                    uiElements.logEl as HTMLElement\n                ).scrollHeight;\n            }\n        }\n        log(\"Export ready.\");\n        return;\n    }\n\n    if (msg.type === \"W3C_PREVIEW\") {\n        const displayName = prettyExportName(msg.payload.name);\n        const header = `/* ${displayName} */\\n`;\n        if (uiElements.w3cPreviewEl)\n            uiElements.w3cPreviewEl.textContent =\n                header + prettyJson(msg.payload.json);\n        return;\n    }\n\n    if (msg.type === \"COLLECTIONS_DATA\") {\n        githubUi.onCollectionsData({\n            collections: msg.payload.collections,\n            textStyles: msg.payload.textStylesCount\n                ? new Array(msg.payload.textStylesCount).fill({\n                      id: \"\",\n                      name: \"\",\n                  })\n                : [],\n        });\n        populateCollections({ collections: msg.payload.collections });\n        if (uiElements.exportAllChk)\n            uiElements.exportAllChk.checked = !!msg.payload.exportAllPref;\n        if (\n            uiElements.styleDictionaryChk &&\n            typeof msg.payload.styleDictionaryPref === \"boolean\"\n        ) {\n            uiElements.styleDictionaryChk.checked =\n                !!msg.payload.styleDictionaryPref;\n        }\n        if (\n            uiElements.flatTokensChk &&\n            typeof msg.payload.flatTokensPref === \"boolean\"\n        ) {\n            uiElements.flatTokensChk.checked = !!msg.payload.flatTokensPref;\n        }\n        if (\n            uiElements.allowHexChk &&\n            typeof msg.payload.allowHexPref === \"boolean\"\n        ) {\n            uiElements.allowHexChk.checked = !!msg.payload.allowHexPref;\n        }\n        if (typeof msg.payload.githubRememberPref === \"boolean\") {\n            if (uiElements.githubRememberChk)\n                uiElements.githubRememberChk.checked =\n                    msg.payload.githubRememberPref;\n        }\n        const last = (msg.payload as any).last as {\n            collection: string;\n            mode: string;\n        } | null;\n        applyLastSelection(last);\n        setDisabledStates();\n        requestPreviewForCurrent();\n        return;\n    }\n\n    if (msg.type === \"RAW_COLLECTIONS_TEXT\") {\n        if (uiElements.rawEl) uiElements.rawEl.textContent = msg.payload.text;\n        return;\n    }\n});\n\n/* -------------------------------------------------------\n * DOM wiring (runs when document exists)\n * ----------------------------------------------------- */\n\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n    if (typeof document === \"undefined\") return;\n\n    initDomElements();\n\n    // Fallback apply if matchMedia is unavailable in the host environment.\n    if (!prefersDarkQuery) applyTheme();\n\n    appState.importPreference = readImportPreference();\n    appState.importLogEntries = readImportLog();\n    renderImportPreferenceSummary();\n    renderImportLog();\n\n    if (uiElements.importScopeClearBtn) {\n        uiElements.importScopeClearBtn.addEventListener(\"click\", () =>\n            clearImportPreference(true)\n        );\n    }\n\n    if (uiElements.importScopeConfirmBtn) {\n        uiElements.importScopeConfirmBtn.addEventListener(\"click\", () => {\n            if (!appState.importScopeModalState) {\n                closeImportScopeModal();\n                return;\n            }\n            const state = appState.importScopeModalState;\n            const selections: string[] = [];\n            for (let i = 0; i < state.collections.length; i++) {\n                const collection = state.collections[i];\n                const inputs = state.inputsByCollection.get(collection) || [];\n                const selected = inputs.find((input) => input.checked);\n                if (!selected) return;\n                selections.push(selected.value);\n            }\n            const remember = uiElements.importScopeRememberChk\n                ? !!uiElements.importScopeRememberChk.checked\n                : false;\n            closeImportScopeModal();\n            state.onConfirm(selections, remember);\n        });\n    }\n\n    if (uiElements.importScopeCancelBtn) {\n        uiElements.importScopeCancelBtn.addEventListener(\"click\", () =>\n            closeImportScopeModal()\n        );\n    }\n\n    if (uiElements.importScopeOverlay) {\n        uiElements.importScopeOverlay.addEventListener(\"click\", (ev) => {\n            if (ev.target === uiElements.importScopeOverlay)\n                closeImportScopeModal();\n        });\n    }\n\n    if (uiElements.resizeHandleEl) {\n        uiElements.resizeHandleEl.addEventListener(\n            \"pointerdown\",\n            (event: PointerEvent) => {\n                if (event.button !== 0 && event.pointerType === \"mouse\") return;\n                if (appState.resizeTracking) return;\n                event.preventDefault();\n                appState.resizeTracking = {\n                    pointerId: event.pointerId,\n                    startX: event.clientX,\n                    startY: event.clientY,\n                    startWidth: window.innerWidth,\n                    startHeight: window.innerHeight,\n                };\n                try {\n                    uiElements.resizeHandleEl!.setPointerCapture(\n                        event.pointerId\n                    );\n                } catch {\n                    /* ignore */\n                }\n                window.addEventListener(\"pointermove\", handleResizeMove, true);\n                window.addEventListener(\"pointerup\", endResize, true);\n                window.addEventListener(\"pointercancel\", cancelResize, true);\n            }\n        );\n    }\n\n    githubUi.attach({ document, window });\n\n    if (uiElements.fileInput)\n        uiElements.fileInput.addEventListener(\"change\", setDisabledStates);\n\n    if (uiElements.exportAllChk) {\n        uiElements.exportAllChk.addEventListener(\"change\", () => {\n            setDisabledStates();\n            postToPlugin({\n                type: \"SAVE_PREFS\",\n                payload: { exportAll: !!uiElements.exportAllChk!.checked },\n            });\n            githubUi.onSelectionChange();\n        });\n    }\n\n    if (uiElements.styleDictionaryChk) {\n        uiElements.styleDictionaryChk.addEventListener(\"change\", () => {\n            postToPlugin({\n                type: \"SAVE_PREFS\",\n                payload: {\n                    styleDictionary: !!uiElements.styleDictionaryChk!.checked,\n                },\n            });\n            requestPreviewForCurrent();\n            githubUi.onSelectionChange();\n        });\n    }\n\n    if (uiElements.flatTokensChk) {\n        uiElements.flatTokensChk.addEventListener(\"change\", () => {\n            postToPlugin({\n                type: \"SAVE_PREFS\",\n                payload: { flatTokens: !!uiElements.flatTokensChk!.checked },\n            });\n            requestPreviewForCurrent();\n            githubUi.onSelectionChange();\n        });\n    }\n\n    if (uiElements.githubRememberChk) {\n        uiElements.githubRememberChk.addEventListener(\"change\", () => {\n            postToPlugin({\n                type: \"SAVE_PREFS\",\n                payload: {\n                    githubRememberToken:\n                        !!uiElements.githubRememberChk!.checked,\n                },\n            });\n        });\n    }\n\n    if (uiElements.refreshBtn) {\n        uiElements.refreshBtn.addEventListener(\"click\", () => {\n            postToPlugin({ type: \"FETCH_COLLECTIONS\" });\n        });\n    }\n\n    if (uiElements.importBtn && uiElements.fileInput) {\n        uiElements.importBtn.addEventListener(\"click\", () => {\n            if (\n                !uiElements.fileInput!.files ||\n                uiElements.fileInput!.files.length === 0\n            ) {\n                log(\"Select a JSON file first.\");\n                return;\n            }\n            const reader = new FileReader();\n            reader.onload = function () {\n                try {\n                    const text = String(reader.result);\n                    const json = JSON.parse(text);\n                    if (\n                        !json ||\n                        typeof json !== \"object\" ||\n                        json instanceof Array\n                    ) {\n                        log(\n                            \"Invalid JSON structure for tokens (expected an object).\"\n                        );\n                        return;\n                    }\n                    const allowHex = !!(\n                        uiElements.allowHexChk && uiElements.allowHexChk.checked\n                    );\n                    startImportFlow(json, allowHex);\n                } catch (e) {\n                    const msg = e instanceof Error ? e.message : String(e);\n                    log(\"Failed to parse JSON: \" + msg);\n                }\n            };\n            reader.readAsText(uiElements.fileInput!.files[0]);\n        });\n    }\n\n    if (uiElements.exportBtn) {\n        uiElements.exportBtn.addEventListener(\"click\", async () => {\n            let exportAll = false;\n            if (uiElements.exportAllChk)\n                exportAll = !!uiElements.exportAllChk.checked;\n\n            const styleDictionary = !!(\n                uiElements.styleDictionaryChk &&\n                uiElements.styleDictionaryChk.checked\n            );\n            const flatTokens = !!(\n                uiElements.flatTokensChk && uiElements.flatTokensChk.checked\n            );\n\n            const payload: {\n                exportAll: boolean;\n                collection?: string;\n                mode?: string;\n                styleDictionary?: boolean;\n                flatTokens?: boolean;\n            } = { exportAll, styleDictionary, flatTokens };\n            if (\n                !exportAll &&\n                uiElements.collectionSelect &&\n                uiElements.modeSelect\n            ) {\n                payload.collection = uiElements.collectionSelect.value;\n                payload.mode = uiElements.modeSelect.value;\n                if (!(payload.collection && payload.mode)) {\n                    log('Pick collection and mode or use \"Export all\".');\n                    return;\n                }\n            }\n\n            const suggestedName = exportAll\n                ? \"tokens.json\"\n                : prettyExportName(\n                      `${payload.collection ?? \"Tokens\"}_mode=${\n                          payload.mode ?? \"Mode 1\"\n                      }.tokens.json`\n                  );\n\n            await beginPendingSave(suggestedName);\n\n            postToPlugin({ type: \"EXPORT_DTCG\", payload });\n            if (exportAll) log(\"Export all requested.\");\n            else\n                log(\n                    `Export requested for \"${payload.collection || \"\"}\" / \"${\n                        payload.mode || \"\"\n                    }\".`\n                );\n        });\n    }\n\n    if (uiElements.exportTypographyBtn) {\n        uiElements.exportTypographyBtn.addEventListener(\"click\", async () => {\n            await beginPendingSave(\"typography.json\");\n            postToPlugin({ type: \"EXPORT_TYPOGRAPHY\" });\n            log(\"Typography export requested.\");\n        });\n    }\n\n    if (uiElements.drawerToggleBtn) {\n        uiElements.drawerToggleBtn.addEventListener(\"click\", () => {\n            const current =\n                uiElements.drawerToggleBtn!.getAttribute(\"aria-expanded\") ===\n                \"true\";\n            setDrawerOpen(!current);\n        });\n    }\n\n    if (uiElements.collectionSelect) {\n        uiElements.collectionSelect.addEventListener(\"change\", () => {\n            onCollectionChange();\n            if (uiElements.collectionSelect && uiElements.modeSelect) {\n                postToPlugin({\n                    type: \"SAVE_LAST\",\n                    payload: {\n                        collection: uiElements.collectionSelect.value,\n                        mode: uiElements.modeSelect.value,\n                    },\n                });\n                requestPreviewForCurrent();\n            }\n            githubUi.onSelectionChange();\n        });\n    }\n\n    if (uiElements.modeSelect) {\n        uiElements.modeSelect.addEventListener(\"change\", () => {\n            if (uiElements.collectionSelect && uiElements.modeSelect) {\n                postToPlugin({\n                    type: \"SAVE_LAST\",\n                    payload: {\n                        collection: uiElements.collectionSelect.value,\n                        mode: uiElements.modeSelect.value,\n                    },\n                });\n            }\n            setDisabledStates();\n            requestPreviewForCurrent();\n            githubUi.onSelectionChange();\n        });\n    }\n\n    if (uiElements.copyRawBtn)\n        uiElements.copyRawBtn.addEventListener(\"click\", () =>\n            copyElText(uiElements.rawEl, \"Raw Figma Collections\")\n        );\n    if (uiElements.copyW3cBtn)\n        uiElements.copyW3cBtn.addEventListener(\"click\", () =>\n            copyElText(uiElements.w3cPreviewEl, \"W3C Preview\")\n        );\n    if (uiElements.copyLogBtn)\n        uiElements.copyLogBtn.addEventListener(\"click\", () =>\n            copyElText(uiElements.logEl, \"Log\")\n        );\n\n    githubUi.onSelectionChange();\n    autoFitOnce();\n\n    if (uiElements.rawEl)\n        uiElements.rawEl.textContent = \"Loading variable collections\u2026\";\n    setDisabledStates();\n    setDrawerOpen(getSavedDrawerOpen());\n    postToPlugin({ type: \"UI_READY\" });\n\n    // Poll for updates (heartbeat)\n    setInterval(() => {\n        postToPlugin({ type: \"PING\" });\n    }, 500);\n});\n\n/* -------------------------------------------------------\n * Drawer helpers\n * ----------------------------------------------------- */\n/** Persist drawer state and adjust CSS hooks so the UI animates correctly. */\nfunction setDrawerOpen(open: boolean): void {\n    if (uiElements.shellEl) {\n        if (open) uiElements.shellEl.classList.remove(\"drawer-collapsed\");\n        else uiElements.shellEl.classList.add(\"drawer-collapsed\");\n    }\n    if (uiElements.drawerToggleBtn) {\n        uiElements.drawerToggleBtn.setAttribute(\n            \"aria-expanded\",\n            open ? \"true\" : \"false\"\n        );\n        uiElements.drawerToggleBtn.textContent = open ? \"Hide\" : \"Show\";\n        uiElements.drawerToggleBtn.title = open ? \"Hide log\" : \"Show log\";\n    }\n    try {\n        window.localStorage.setItem(\"drawerOpen\", open ? \"1\" : \"0\");\n    } catch {\n        /* ignore */\n    }\n}\n\n/** Load the saved drawer state flag from local storage. */\nfunction getSavedDrawerOpen(): boolean {\n    try {\n        const v = window.localStorage.getItem(\"drawerOpen\");\n        if (v === \"0\") return false;\n        if (v === \"1\") return true;\n    } catch {\n        /* ignore */\n    }\n    return true;\n}\n"],
  "mappings": "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",
  "names": ["_a", "_b", "e"]
}
