{
  "version": 3,
  "sources": ["../src/app/github/filenames.ts", "../src/app/github/ui.ts", "../src/app/ui/dom.ts", "../src/app/ui/utils.ts", "../src/app/ui/state.ts", "../src/app/ui/storage.ts", "../src/app/ui/features/import.ts", "../src/app/ui/features/export.ts", "../src/app/ui/features/resize.ts", "../src/app/ui.ts"],
  "sourcesContent": ["// src/app/github/filenames.ts\n// Shared helpers for validating GitHub export filenames so UI and plugin stay in sync.\n\nexport const DEFAULT_GITHUB_FILENAME = \"tokens.json\";\n/**\n * Regex to detect invalid characters in GitHub filenames.\n * Includes ASCII control characters (\\u0000-\\u001F) which are not allowed in\n * filenames and could cause filesystem or security issues.\n */\n// eslint-disable-next-line no-control-regex -- Intentionally filtering control characters for filename safety\nconst INVALID_FILENAME_CHARS = /[<>:\"/\\\\|?*\\u0000-\\u001F]/;\nconst MAX_FILENAME_LENGTH = 128;\n\nexport type GithubFilenameValidation =\n    | { ok: true; filename: string }\n    | { ok: false; message: string };\n\nexport function validateGithubFilename(\n    raw: string | null | undefined\n): GithubFilenameValidation {\n    const initial = typeof raw === \"string\" ? raw : DEFAULT_GITHUB_FILENAME;\n    const trimmed = initial.trim();\n    if (!trimmed) {\n        return {\n            ok: false,\n            message: \"GitHub: Enter a filename (e.g., tokens.json).\",\n        };\n    }\n    if (trimmed === \".\" || trimmed === \"..\") {\n        return {\n            ok: false,\n            message: 'GitHub: Filename cannot be \".\" or \"..\".',\n        };\n    }\n    if (trimmed.length > MAX_FILENAME_LENGTH) {\n        return {\n            ok: false,\n            message: `GitHub: Filename must be ${MAX_FILENAME_LENGTH} characters or fewer.`,\n        };\n    }\n    if (INVALID_FILENAME_CHARS.test(trimmed)) {\n        return {\n            ok: false,\n            message:\n                'GitHub: Filename contains unsupported characters like / \\\\ : * ? \" < > |.',\n        };\n    }\n    if (!/\\.json$/i.test(trimmed)) {\n        return { ok: false, message: \"GitHub: Filename must end with .json.\" };\n    }\n    return { ok: true, filename: trimmed };\n}\n", "// src/app/github/ui.ts\n// GitHub panel orchestration: token auth, repo/branch pickers, folder browser, and commit flows.\n// - Bridges GitHub interactions with plugin storage and export preferences\n// - Keeps DOM event wiring resilient across optional UI states\n\nimport type { PluginToUi, UiToPlugin, GithubScope } from \"../messages\";\nimport type { GithubFilenameValidation } from \"./filenames\";\nimport { DEFAULT_GITHUB_FILENAME, validateGithubFilename } from \"./filenames\";\n\ntype FolderListEntry = { type: \"dir\" | \"file\"; name: string; path?: string };\n\ntype GithubUiDependencies = {\n    postToPlugin(message: UiToPlugin): void;\n    log(message: string): void;\n    getLogElement(): HTMLElement | null;\n    getCollectionSelect(): HTMLSelectElement | null;\n    getModeSelect(): HTMLSelectElement | null;\n    getAllowHexCheckbox(): HTMLInputElement | null;\n    getStyleDictionaryCheckbox(): HTMLInputElement | null;\n    getFlatTokensCheckbox(): HTMLInputElement | null;\n    getImportContexts(): string[];\n};\n\ntype AttachContext = {\n    document: Document;\n    window: Window;\n};\n\ntype GithubUiApi = {\n    attach(context: AttachContext): void;\n    handleMessage(message: PluginToUi): boolean;\n    onSelectionChange(): void;\n    setRememberPref(pref: boolean): void;\n    onCollectionsData(): void;\n};\n\nconst GH_MASK = \"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022\";\nconst BRANCH_TTL_MS = 60_000;\n\nexport function createGithubUi(deps: GithubUiDependencies): GithubUiApi {\n    let doc: Document | null = null;\n    let win: Window | null = null;\n\n    let ghTokenInput: HTMLInputElement | null = null;\n    let ghRememberChk: HTMLInputElement | null = null;\n    let ghConnectBtn: HTMLButtonElement | null = null;\n    let ghVerifyBtn: HTMLButtonElement | null = null;\n    let ghRepoSelect: HTMLSelectElement | null = null;\n    let ghLogoutBtn: HTMLButtonElement | null = null;\n\n    let ghBranchInput: HTMLInputElement | null = null;\n    let ghBranchToggleBtn: HTMLButtonElement | null = null;\n    let ghBranchMenu: HTMLUListElement | null = null;\n    let ghBranchCountEl: HTMLElement | null = null;\n    let ghBranchRefreshBtn: HTMLButtonElement | null = null;\n\n    let ghNewBranchBtn: HTMLButtonElement | null = null;\n    let ghNewBranchRow: HTMLElement | null = null;\n    let ghNewBranchName: HTMLInputElement | null = null;\n    let ghCreateBranchConfirmBtn: HTMLButtonElement | null = null;\n    let ghCancelBranchBtn: HTMLButtonElement | null = null;\n\n    let ghFolderInput: HTMLInputElement | null = null;\n    let ghFolderDisplay: HTMLElement | null = null;\n    let ghPickFolderBtn: HTMLButtonElement | null = null;\n    let ghFilenameInput: HTMLInputElement | null = null;\n    let ghFilenameErrorEl: HTMLElement | null = null;\n    let ghCollectionsRefreshing = false;\n    let ghCommitMsgInput: HTMLInputElement | null = null;\n    let ghExportAndCommitBtn: HTMLButtonElement | null = null;\n    let ghCreatePrChk: HTMLInputElement | null = null;\n    let ghPrOptionsEl: HTMLElement | null = null;\n    let ghPrTitleInput: HTMLInputElement | null = null;\n    let ghPrBodyInput: HTMLTextAreaElement | null = null;\n    let ghFetchPathInput: HTMLInputElement | null = null;\n    let ghFetchTokensBtn: HTMLButtonElement | null = null;\n    let ghScopeSelected: HTMLInputElement | null = null;\n    let ghScopeAll: HTMLInputElement | null = null;\n    let ghScopeTypography: HTMLInputElement | null = null;\n    let styleDictionaryCheckbox: HTMLInputElement | null = null;\n    let flatTokensCheckbox: HTMLInputElement | null = null;\n    let ghImportStatusEl: HTMLElement | null = null;\n\n    let ghAuthStatusEl: HTMLElement | null = null;\n    let ghTokenMetaEl: HTMLElement | null = null;\n\n    let folderPickerOverlay: HTMLElement | null = null;\n    let folderPickerTitleEl: HTMLElement | null = null;\n    let folderPickerPathInput: HTMLInputElement | null = null;\n    let folderPickerUseBtn: HTMLButtonElement | null = null;\n    let folderPickerListEl: HTMLElement | null = null;\n    let folderPickerCancelBtn: HTMLButtonElement | null = null;\n\n    let folderPickerIsOpen = false;\n    let folderPickerCurrentPath = \"\";\n    let folderPickerLastFocus: HTMLElement | null = null;\n    let folderPickerRefreshNonce = 0;\n\n    const folderListWaiters: Array<{\n        path: string;\n        resolve: (v: { ok: true; entries: FolderListEntry[] }) => void;\n        reject: (v: { ok: false; message: string; status?: number }) => void;\n    }> = [];\n\n    const folderCreateWaiters: Array<{\n        folderPath: string;\n        resolve: (v: { ok: true }) => void;\n        reject: (v: { ok: false; message: string; status?: number }) => void;\n    }> = [];\n\n    let ghIsAuthed = false;\n    let ghTokenExpiresAt: string | number | null = null;\n    let ghRememberPref = true;\n    let filenameValidation: GithubFilenameValidation = validateGithubFilename(\n        DEFAULT_GITHUB_FILENAME\n    );\n\n    let currentOwner = \"\";\n    let currentRepo = \"\";\n    let desiredBranch: string | null = null;\n    let defaultBranchFromApi: string | undefined = undefined;\n    let loadedPages = 0;\n    let hasMorePages = false;\n    let isFetchingBranches = false;\n    let lastBranchesFetchedAtMs = 0;\n\n    let allBranches: string[] = [];\n    let filteredBranches: string[] = [];\n    let renderCount = 0;\n    let branchMenuVisible = false;\n    let branchHighlightIndex = -1;\n    const RENDER_STEP = 200;\n    const BRANCH_INPUT_PLACEHOLDER =\n        \"Search branches\u2026 (press Enter to refresh)\";\n    const GH_FOLDER_PLACEHOLDER = \"Path in repository\u2026\";\n    let branchLastQuery = \"\";\n    let branchInputPristine = true;\n    type BranchSelectionResult = \"selected\" | \"more\" | \"fetch\" | \"noop\";\n    let ghImportInFlight = false;\n    let lastImportTarget: { branch: string; path: string } | null = null;\n\n    const IMPORT_PROMPT_SELECT =\n        \"Select a repository and branch to enable imports.\";\n    const IMPORT_PROMPT_BRANCH = \"Pick a branch to import from.\";\n    const IMPORT_PROMPT_PATH =\n        \"Enter the path to a DTCG token file, then press Import.\";\n\n    type ImportStatusKind = \"idle\" | \"ready\" | \"progress\" | \"success\" | \"error\";\n    let currentImportStatus: ImportStatusKind = \"idle\";\n\n    function setImportStatus(kind: ImportStatusKind, message: string): void {\n        if (!ghImportStatusEl) return;\n        currentImportStatus = kind;\n        ghImportStatusEl.textContent = message;\n        ghImportStatusEl.classList.remove(\n            \"gh-import-status--ready\",\n            \"gh-import-status--progress\",\n            \"gh-import-status--success\",\n            \"gh-import-status--error\"\n        );\n        if (kind === \"ready\")\n            ghImportStatusEl.classList.add(\"gh-import-status--ready\");\n        else if (kind === \"progress\")\n            ghImportStatusEl.classList.add(\"gh-import-status--progress\");\n        else if (kind === \"success\")\n            ghImportStatusEl.classList.add(\"gh-import-status--success\");\n        else if (kind === \"error\")\n            ghImportStatusEl.classList.add(\"gh-import-status--error\");\n    }\n\n    function pickCollectionSelect(): HTMLSelectElement | null {\n        return deps.getCollectionSelect();\n    }\n\n    function pickModeSelect(): HTMLSelectElement | null {\n        return deps.getModeSelect();\n    }\n\n    function pickAllowHexCheckbox(): HTMLInputElement | null {\n        return deps.getAllowHexCheckbox();\n    }\n\n    function pickStyleDictionaryCheckbox(): HTMLInputElement | null {\n        if (!styleDictionaryCheckbox)\n            styleDictionaryCheckbox = deps.getStyleDictionaryCheckbox();\n        return styleDictionaryCheckbox;\n    }\n\n    function pickFlatTokensCheckbox(): HTMLInputElement | null {\n        if (!flatTokensCheckbox)\n            flatTokensCheckbox = deps.getFlatTokensCheckbox();\n        return flatTokensCheckbox;\n    }\n\n    function findTokenInput(): HTMLInputElement | null {\n        if (!doc) return null;\n        return (\n            (doc.getElementById(\n                \"githubTokenInput\"\n            ) as HTMLInputElement | null) ||\n            (doc.getElementById(\"ghTokenInput\") as HTMLInputElement | null) ||\n            (doc.getElementById(\"githubPatInput\") as HTMLInputElement | null) ||\n            (doc.querySelector(\n                'input[name=\"githubToken\"]'\n            ) as HTMLInputElement | null) ||\n            (doc.querySelector(\n                'input[type=\"password\"]'\n            ) as HTMLInputElement | null)\n        );\n    }\n\n    function readPatFromUi(): string {\n        if (!ghTokenInput) ghTokenInput = findTokenInput();\n        if (!ghTokenInput) return \"\";\n        if (ghTokenInput.getAttribute(\"data-filled\") === \"1\") return GH_MASK;\n        return (ghTokenInput.value || \"\").trim();\n    }\n\n    function updateRememberPref(pref: boolean, persist = false): void {\n        const next = !!pref;\n        ghRememberPref = next;\n        if (ghRememberChk) {\n            ghRememberChk.checked = ghRememberPref;\n        }\n        updateGhStatusUi();\n        if (persist) {\n            deps.postToPlugin({\n                type: \"SAVE_PREFS\",\n                payload: { githubRememberToken: ghRememberPref },\n            });\n        }\n    }\n\n    function ensureGhStatusElements(): void {\n        if (!doc) return;\n        if (!ghAuthStatusEl)\n            ghAuthStatusEl = doc.getElementById(\"ghAuthStatus\");\n        if (!ghTokenMetaEl) ghTokenMetaEl = doc.getElementById(\"ghTokenMeta\");\n        if (!ghLogoutBtn)\n            ghLogoutBtn = doc.getElementById(\n                \"ghLogoutBtn\"\n            ) as HTMLButtonElement | null;\n    }\n\n    function formatTimeLeft(expInput: string | number): string {\n        const exp =\n            typeof expInput === \"number\" ? expInput : Date.parse(expInput);\n        if (!isFinite(exp)) return \"expiration: unknown\";\n        const now = Date.now();\n        const ms = exp - now;\n        if (ms <= 0) return \"expired\";\n        const days = Math.floor(ms / (24 * 60 * 60 * 1000));\n        const hours = Math.floor(\n            (ms % (24 * 60 * 60 * 1000)) / (60 * 60 * 1000)\n        );\n        if (days > 0) return `${days}d ${hours}h left`;\n        const mins = Math.floor((ms % (60 * 60 * 1000)) / (60 * 1000));\n        if (hours > 0) return `${hours}h ${mins}m left`;\n        const secs = Math.floor((ms % (60 * 1000)) / 1000);\n        if (mins > 0) return `${mins}m ${secs}s left`;\n        return `${secs}s left`;\n    }\n\n    function setPatFieldObfuscated(filled: boolean): void {\n        if (!ghTokenInput) ghTokenInput = findTokenInput();\n        if (!ghTokenInput) return;\n        ghTokenInput.type = \"password\";\n        if (filled) {\n            ghTokenInput.value = GH_MASK;\n            ghTokenInput.setAttribute(\"data-filled\", \"1\");\n        } else {\n            ghTokenInput.value = \"\";\n            ghTokenInput.removeAttribute(\"data-filled\");\n        }\n    }\n\n    function updateGhStatusUi(): void {\n        ensureGhStatusElements();\n\n        if (ghAuthStatusEl) {\n            ghAuthStatusEl.textContent = ghIsAuthed\n                ? \"GitHub: authenticated.\"\n                : \"GitHub: not authenticated.\";\n        }\n\n        if (ghTokenMetaEl) {\n            const rememberTxt = ghRememberPref\n                ? \"Remember me: on\"\n                : \"Remember me: off\";\n            const expTxt = ghTokenExpiresAt\n                ? `Token ${formatTimeLeft(ghTokenExpiresAt)}`\n                : \"Token expiration: unknown\";\n            ghTokenMetaEl.textContent = `${expTxt} \u2022 ${rememberTxt}`;\n        }\n\n        if (ghTokenInput) {\n            ghTokenInput.oninput = () => {\n                if (\n                    ghTokenInput &&\n                    ghTokenInput.getAttribute(\"data-filled\") === \"1\"\n                ) {\n                    ghTokenInput.removeAttribute(\"data-filled\");\n                }\n                if (ghConnectBtn) ghConnectBtn.disabled = false;\n            };\n        }\n\n        if (ghConnectBtn && ghTokenInput) {\n            const isMasked = ghTokenInput.getAttribute(\"data-filled\") === \"1\";\n            ghConnectBtn.disabled = ghIsAuthed && isMasked;\n        }\n\n        if (ghLogoutBtn) {\n            ghLogoutBtn.disabled = !ghIsAuthed;\n        }\n\n        if (ghRememberChk) {\n            ghRememberChk.checked = ghRememberPref;\n        }\n    }\n\n    function showNewBranchRow(show: boolean): void {\n        if (!ghNewBranchRow) return;\n        ghNewBranchRow.style.display = show ? \"flex\" : \"none\";\n        if (show && ghNewBranchName) {\n            if (!ghNewBranchName.value) {\n                ghNewBranchName.value = `tokens/update-${new Date()\n                    .toISOString()\n                    .replace(/[:.]/g, \"-\")\n                    .slice(0, 19)}`;\n            }\n            ghNewBranchName.focus();\n            ghNewBranchName.select();\n        }\n    }\n\n    function isNewBranchRowVisible(): boolean {\n        if (!ghNewBranchRow) return false;\n        return ghNewBranchRow.style.display !== \"none\";\n    }\n\n    function cancelNewBranchFlow(refocusBtn: boolean): void {\n        showNewBranchRow(false);\n        if (ghNewBranchName) ghNewBranchName.value = \"\";\n        if (refocusBtn && ghNewBranchBtn) ghNewBranchBtn.focus();\n    }\n\n    function requestNewBranchCreation(): void {\n        if (!ghCreateBranchConfirmBtn || ghCreateBranchConfirmBtn.disabled)\n            return;\n        if (!currentOwner || !currentRepo) {\n            deps.log(\"Pick a repository before creating a branch.\");\n            return;\n        }\n        const baseBranch = defaultBranchFromApi || \"\";\n        if (!baseBranch) {\n            deps.log(\n                \"GitHub: Unable to determine the repository default branch. Refresh branches first.\"\n            );\n            return;\n        }\n        const newBranch = (ghNewBranchName?.value || \"\").trim();\n        if (!newBranch) {\n            deps.log(\"Enter a branch name to create.\");\n            if (ghNewBranchName) ghNewBranchName.focus();\n            return;\n        }\n        if (newBranch === baseBranch) {\n            deps.log(\n                \"Enter a branch name that differs from the source branch.\"\n            );\n            if (ghNewBranchName) ghNewBranchName.focus();\n            return;\n        }\n\n        ghCreateBranchConfirmBtn.disabled = true;\n        deps.log(`GitHub: creating ${newBranch} from ${baseBranch}\u2026`);\n        deps.postToPlugin({\n            type: \"GITHUB_CREATE_BRANCH\",\n            payload: {\n                owner: currentOwner,\n                repo: currentRepo,\n                baseBranch,\n                newBranch,\n            },\n        });\n    }\n\n    function revalidateBranchesIfStale(forceLog = false): void {\n        if (!ghRepoSelect || !ghBranchInput) return;\n        if (!currentOwner || !currentRepo) return;\n\n        const stale = Date.now() - lastBranchesFetchedAtMs > BRANCH_TTL_MS;\n        if (!stale) {\n            if (forceLog)\n                deps.log(\"Branches are up to date (no refresh needed).\");\n            return;\n        }\n\n        desiredBranch = desiredBranch || null;\n        defaultBranchFromApi = undefined;\n        loadedPages = 0;\n        hasMorePages = false;\n        isFetchingBranches = true;\n        allBranches = [];\n        filteredBranches = [];\n        renderCount = 0;\n\n        setBranchDisabled(true, \"Refreshing branches\u2026\");\n        updateBranchCount();\n        if (ghBranchInput) {\n            ghBranchInput.value = \"\";\n            branchLastQuery = \"\";\n            branchInputPristine = true;\n        }\n        deps.log(\"Refreshing branches\u2026\");\n\n        deps.postToPlugin({\n            type: \"GITHUB_FETCH_BRANCHES\",\n            payload: { owner: currentOwner, repo: currentRepo, page: 1 },\n        });\n    }\n\n    function setBranchDisabled(disabled: boolean, placeholder?: string): void {\n        const nextPlaceholder =\n            placeholder !== undefined ? placeholder : BRANCH_INPUT_PLACEHOLDER;\n        if (ghBranchInput) {\n            ghBranchInput.disabled = disabled;\n            ghBranchInput.placeholder = nextPlaceholder;\n            if (disabled) {\n                ghBranchInput.value = \"\";\n                branchLastQuery = \"\";\n                branchInputPristine = true;\n            }\n        }\n        if (ghBranchToggleBtn) {\n            ghBranchToggleBtn.disabled = disabled;\n            ghBranchToggleBtn.setAttribute(\"aria-expanded\", \"false\");\n        }\n        if (disabled) closeBranchMenu();\n    }\n\n    function updateBranchCount(): void {\n        if (!ghBranchCountEl) return;\n        const total = allBranches.length;\n        const showing = filteredBranches.length;\n        ghBranchCountEl.textContent = `${showing} / ${total}${\n            hasMorePages ? \" +\" : \"\"\n        }`;\n    }\n\n    function getBranchMenuItems(): HTMLLIElement[] {\n        if (!ghBranchMenu) return [];\n        const items: HTMLLIElement[] = [];\n        let node = ghBranchMenu.firstElementChild;\n        while (node) {\n            if (node instanceof HTMLLIElement) items.push(node);\n            node = node.nextElementSibling;\n        }\n        return items;\n    }\n\n    function setBranchHighlight(index: number, scrollIntoView: boolean): void {\n        const items = getBranchMenuItems();\n        branchHighlightIndex = index;\n        for (let i = 0; i < items.length; i++) {\n            if (i === branchHighlightIndex)\n                items[i].setAttribute(\"data-active\", \"1\");\n            else items[i].removeAttribute(\"data-active\");\n        }\n        if (\n            scrollIntoView &&\n            branchHighlightIndex >= 0 &&\n            branchHighlightIndex < items.length\n        ) {\n            try {\n                items[branchHighlightIndex].scrollIntoView({\n                    block: \"nearest\",\n                });\n            } catch {\n                /* ignore */\n            }\n        }\n    }\n\n    function findNextSelectable(\n        startIndex: number,\n        delta: number,\n        items: HTMLLIElement[]\n    ): number {\n        if (!items.length) return -1;\n        let index = startIndex;\n        for (let i = 0; i < items.length; i++) {\n            index += delta;\n            if (index < 0) index = items.length - 1;\n            else if (index >= items.length) index = 0;\n            const item = items[index];\n            if (!item) continue;\n            if (\n                item.dataset.selectable === \"1\" &&\n                item.getAttribute(\"aria-disabled\") !== \"true\"\n            )\n                return index;\n        }\n        return -1;\n    }\n\n    function moveBranchHighlight(delta: number): void {\n        const items = getBranchMenuItems();\n        if (!items.length) {\n            setBranchHighlight(-1, false);\n            return;\n        }\n        const next = findNextSelectable(branchHighlightIndex, delta, items);\n        if (next >= 0) setBranchHighlight(next, true);\n    }\n\n    function syncBranchHighlightAfterRender(): void {\n        const items = getBranchMenuItems();\n        if (!branchMenuVisible) {\n            setBranchHighlight(-1, false);\n            return;\n        }\n        if (!items.length) {\n            setBranchHighlight(-1, false);\n            return;\n        }\n        if (branchHighlightIndex >= 0 && branchHighlightIndex < items.length) {\n            const current = items[branchHighlightIndex];\n            if (\n                current &&\n                current.dataset.selectable === \"1\" &&\n                current.getAttribute(\"aria-disabled\") !== \"true\"\n            ) {\n                setBranchHighlight(branchHighlightIndex, false);\n                return;\n            }\n        }\n        const first = findNextSelectable(-1, 1, items);\n        setBranchHighlight(first, false);\n    }\n\n    function setBranchMenuVisible(show: boolean): void {\n        if (!ghBranchMenu) {\n            branchMenuVisible = false;\n            branchHighlightIndex = -1;\n            return;\n        }\n        if (show && ghBranchInput && ghBranchInput.disabled) show = false;\n        branchMenuVisible = show;\n        if (branchMenuVisible) {\n            ghBranchMenu.hidden = false;\n            ghBranchMenu.setAttribute(\"data-open\", \"1\");\n            if (ghBranchToggleBtn)\n                ghBranchToggleBtn.setAttribute(\"aria-expanded\", \"true\");\n            if (ghBranchInput)\n                ghBranchInput.setAttribute(\"aria-expanded\", \"true\");\n        } else {\n            ghBranchMenu.hidden = true;\n            ghBranchMenu.removeAttribute(\"data-open\");\n            if (ghBranchToggleBtn)\n                ghBranchToggleBtn.setAttribute(\"aria-expanded\", \"false\");\n            if (ghBranchInput)\n                ghBranchInput.setAttribute(\"aria-expanded\", \"false\");\n            setBranchHighlight(-1, false);\n        }\n    }\n\n    function openBranchMenu(): void {\n        if (!ghBranchMenu) return;\n        if (!branchMenuVisible) {\n            if (!ghBranchMenu.childElementCount) renderOptions();\n            setBranchMenuVisible(true);\n        }\n        syncBranchHighlightAfterRender();\n    }\n\n    function closeBranchMenu(): void {\n        setBranchMenuVisible(false);\n    }\n\n    function renderOptions(): void {\n        if (!ghBranchMenu) return;\n\n        while (ghBranchMenu.firstChild)\n            ghBranchMenu.removeChild(ghBranchMenu.firstChild);\n\n        const slice = filteredBranches.slice(0, renderCount);\n        if (slice.length > 0) {\n            for (let i = 0; i < slice.length; i++) {\n                const name = slice[i];\n                const item = doc!.createElement(\"li\");\n                item.className = \"gh-branch-item\";\n                item.dataset.value = name;\n                item.dataset.selectable = \"1\";\n                item.setAttribute(\"role\", \"option\");\n                item.textContent = name;\n                if (i === branchHighlightIndex)\n                    item.setAttribute(\"data-active\", \"1\");\n                ghBranchMenu.appendChild(item);\n            }\n        } else {\n            const empty = doc!.createElement(\"li\");\n            empty.className = \"gh-branch-item gh-branch-item-empty\";\n            empty.setAttribute(\"aria-disabled\", \"true\");\n            empty.dataset.selectable = \"0\";\n            empty.textContent = allBranches.length\n                ? \"No matching branches\"\n                : \"No branches loaded yet\";\n            ghBranchMenu.appendChild(empty);\n        }\n\n        if (filteredBranches.length > renderCount) {\n            const more = doc!.createElement(\"li\");\n            more.className = \"gh-branch-item gh-branch-item-action\";\n            more.dataset.value = \"__more__\";\n            more.dataset.selectable = \"1\";\n            more.textContent = `Load more\u2026 (${\n                filteredBranches.length - renderCount\n            } more)`;\n            ghBranchMenu.appendChild(more);\n        } else if (hasMorePages) {\n            const fetch = doc!.createElement(\"li\");\n            fetch.className = \"gh-branch-item gh-branch-item-action\";\n            fetch.dataset.value = \"__fetch__\";\n            fetch.dataset.selectable = \"1\";\n            fetch.textContent = \"Load next page\u2026\";\n            ghBranchMenu.appendChild(fetch);\n        }\n\n        if (ghBranchInput) {\n            const want = desiredBranch || defaultBranchFromApi || \"\";\n            if (!ghBranchInput.value && want && branchInputPristine) {\n                ghBranchInput.value = want;\n                branchLastQuery = want;\n            }\n        }\n\n        if (branchMenuVisible) {\n            syncBranchHighlightAfterRender();\n        }\n    }\n\n    function applyBranchFilter(): void {\n        const rawInput = (ghBranchInput?.value || \"\").trim();\n        const raw =\n            rawInput === \"__more__\" || rawInput === \"__fetch__\"\n                ? branchLastQuery.trim()\n                : rawInput;\n        const q = raw.toLowerCase();\n        const isSelected = !!desiredBranch && raw === desiredBranch;\n        const isDefaultShown =\n            !desiredBranch &&\n            !!defaultBranchFromApi &&\n            raw === defaultBranchFromApi;\n        const effectiveQuery = isSelected || isDefaultShown ? \"\" : q;\n        filteredBranches = effectiveQuery\n            ? allBranches.filter((n) =>\n                  n.toLowerCase().includes(effectiveQuery)\n              )\n            : [...allBranches];\n\n        renderCount = Math.min(RENDER_STEP, filteredBranches.length);\n        renderOptions();\n        updateBranchCount();\n\n        if (!branchMenuVisible && ghBranchInput && !ghBranchInput.disabled) {\n            const isFocused = !!doc && doc.activeElement === ghBranchInput;\n            if (isFocused) {\n                setBranchMenuVisible(true);\n                syncBranchHighlightAfterRender();\n            }\n        }\n    }\n\n    function processBranchSelection(\n        rawValue: string,\n        fromMenu: boolean\n    ): BranchSelectionResult {\n        const value = (rawValue || \"\").trim();\n        if (!ghBranchInput) return \"noop\";\n\n        if (value === \"__more__\") {\n            renderCount = Math.min(\n                renderCount + RENDER_STEP,\n                filteredBranches.length\n            );\n            renderOptions();\n            updateBranchCount();\n            ghBranchInput.value = branchLastQuery;\n            if (fromMenu && !branchMenuVisible) setBranchMenuVisible(true);\n            return \"more\";\n        }\n\n        if (value === \"__fetch__\") {\n            ensureNextPageIfNeeded();\n            ghBranchInput.value = branchLastQuery;\n            return \"fetch\";\n        }\n\n        if (!value) return \"noop\";\n\n        desiredBranch = value;\n        branchLastQuery = value;\n        ghBranchInput.value = value;\n        branchInputPristine = false;\n        deps.postToPlugin({\n            type: \"GITHUB_SELECT_BRANCH\",\n            payload: { owner: currentOwner, repo: currentRepo, branch: value },\n        });\n\n        applyBranchFilter();\n        updateFolderControlsEnabled();\n        updateExportCommitEnabled();\n        updateFetchButtonEnabled();\n        return \"selected\";\n    }\n\n    function ensureNextPageIfNeeded(): void {\n        if (!ghBranchInput || !ghRepoSelect) return;\n        if (!hasMorePages || isFetchingBranches) return;\n        if (!currentOwner || !currentRepo) return;\n\n        isFetchingBranches = true;\n        deps.postToPlugin({\n            type: \"GITHUB_FETCH_BRANCHES\",\n            payload: {\n                owner: currentOwner,\n                repo: currentRepo,\n                page: loadedPages + 1,\n            },\n        });\n    }\n\n    function normalizeFolderInput(raw: string): {\n        display: string;\n        payload: string;\n    } {\n        const trimmed = raw.trim();\n        if (!trimmed) return { display: \"\", payload: \"\" };\n\n        if (trimmed === \"/\" || trimmed === \"./\" || trimmed === \".\") {\n            return { display: \"/\", payload: \"/\" };\n        }\n\n        const collapsed = trimmed.replace(/\\\\/g, \"/\").replace(/\\/{2,}/g, \"/\");\n        const stripped = collapsed.replace(/^\\/+/, \"\").replace(/\\/+$/, \"\");\n        if (!stripped) return { display: \"/\", payload: \"/\" };\n        return { display: stripped + \"/\", payload: stripped };\n    }\n\n    function normalizeFolderPickerPath(raw: string): string {\n        const trimmed = (raw || \"\").trim();\n        if (!trimmed || trimmed === \"/\" || trimmed === \"./\" || trimmed === \".\")\n            return \"\";\n        const collapsed = trimmed.replace(/\\\\/g, \"/\").replace(/\\/{2,}/g, \"/\");\n        return collapsed.replace(/^\\/+/, \"\").replace(/\\/+$/, \"\");\n    }\n\n    function setGhFolderDisplay(display: string): void {\n        if (ghFolderInput) ghFolderInput.value = display || \"\";\n        if (!ghFolderDisplay) return;\n        if (display) {\n            ghFolderDisplay.textContent = display;\n            ghFolderDisplay.classList.remove(\"is-placeholder\");\n        } else {\n            ghFolderDisplay.textContent = GH_FOLDER_PLACEHOLDER;\n            ghFolderDisplay.classList.add(\"is-placeholder\");\n        }\n    }\n\n    function setFilenameError(message: string | null): void {\n        if (!ghFilenameErrorEl) return;\n        if (message) {\n            ghFilenameErrorEl.textContent = message;\n            ghFilenameErrorEl.hidden = false;\n        } else {\n            ghFilenameErrorEl.textContent = \"\";\n            ghFilenameErrorEl.hidden = true;\n        }\n    }\n\n    function refreshFilenameValidation(): void {\n        const raw = ghFilenameInput ? ghFilenameInput.value : \"\";\n        const result = validateGithubFilename(raw || DEFAULT_GITHUB_FILENAME);\n        filenameValidation = result;\n        if (result.ok) setFilenameError(null);\n        else setFilenameError(result.message);\n    }\n\n    function formatDestinationForLog(\n        folderRaw: string | undefined,\n        filename: string | undefined\n    ): string {\n        const normalized = normalizeFolderInput(folderRaw || \"\");\n        const folderDisplay = normalized.display || \"/\";\n        const base = folderDisplay || \"/\";\n        const name = filename && filename.trim() ? filename.trim() : \"(file)\";\n        const joiner = base.endsWith(\"/\") ? \"\" : \"/\";\n        return `${base}${joiner}${name}`;\n    }\n\n    function listDir(\n        path: string\n    ): Promise<\n        | { ok: true; entries: FolderListEntry[] }\n        | { ok: false; message: string; status?: number }\n    > {\n        return new Promise((resolve) => {\n            const req = { path: path.replace(/^\\/+|\\/+$/g, \"\") };\n            folderListWaiters.push({\n                path: req.path,\n                resolve: (v) => resolve(v),\n                reject: (v) => resolve(v),\n            });\n            deps.postToPlugin({\n                type: \"GITHUB_FOLDER_LIST\",\n                payload: {\n                    owner: currentOwner,\n                    repo: currentRepo,\n                    branch: getCurrentBranch(),\n                    path: req.path,\n                },\n            });\n        });\n    }\n\n    function openFolderPicker(): void {\n        if (!currentOwner || !currentRepo) {\n            deps.log(\"Pick a repository first.\");\n            return;\n        }\n        const ref = getCurrentBranch();\n        if (!ref) {\n            deps.log(\"Pick a branch first.\");\n            return;\n        }\n        if (\n            !(\n                folderPickerOverlay &&\n                folderPickerTitleEl &&\n                folderPickerPathInput &&\n                folderPickerListEl\n            )\n        ) {\n            deps.log(\"Folder picker UI is unavailable.\");\n            return;\n        }\n\n        folderPickerLastFocus =\n            doc && doc.activeElement instanceof HTMLElement\n                ? doc.activeElement\n                : null;\n\n        folderPickerOverlay.hidden = false;\n        folderPickerOverlay.classList.add(\"is-open\");\n        folderPickerOverlay.setAttribute(\"aria-hidden\", \"false\");\n        folderPickerIsOpen = true;\n\n        updateFolderPickerTitle(ref);\n\n        const startNormalized = normalizeFolderInput(\n            ghFolderInput?.value || \"\"\n        );\n        const startPath =\n            startNormalized.payload === \"/\" ? \"\" : startNormalized.payload;\n        setFolderPickerPath(startPath, true);\n\n        win?.setTimeout(() => {\n            folderPickerPathInput?.focus();\n            folderPickerPathInput?.select();\n        }, 0);\n    }\n\n    function closeFolderPicker(): void {\n        if (!folderPickerOverlay) return;\n        folderPickerOverlay.classList.remove(\"is-open\");\n        folderPickerOverlay.setAttribute(\"aria-hidden\", \"true\");\n        folderPickerOverlay.hidden = true;\n        folderPickerIsOpen = false;\n        folderPickerCurrentPath = \"\";\n        folderPickerRefreshNonce++;\n        if (folderPickerListEl) {\n            folderPickerListEl.replaceChildren(\n                createFolderPickerRow(\"Loading\u2026\", {\n                    muted: true,\n                    disabled: true,\n                })\n            );\n        }\n        if (folderPickerLastFocus && doc?.contains(folderPickerLastFocus)) {\n            folderPickerLastFocus.focus();\n        }\n        folderPickerLastFocus = null;\n    }\n\n    function createFolderPickerRow(\n        label: string,\n        options?: {\n            onClick?: () => void;\n            muted?: boolean;\n            disabled?: boolean;\n        }\n    ): HTMLButtonElement {\n        if (!doc) throw new Error(\"GitHub UI not attached\");\n        const btn = doc.createElement(\"button\");\n        btn.type = \"button\";\n        btn.className = \"folder-picker-row\";\n        btn.textContent = label;\n        if (options?.muted) btn.classList.add(\"is-muted\");\n        if (options?.disabled) btn.disabled = true;\n        if (options?.onClick) {\n            btn.addEventListener(\"click\", (event) => {\n                event.preventDefault();\n                options.onClick?.();\n            });\n        }\n        return btn;\n    }\n\n    function updateFolderPickerTitle(branch: string): void {\n        if (!folderPickerTitleEl) return;\n        if (currentOwner && currentRepo) {\n            folderPickerTitleEl.textContent = `${currentOwner}/${currentRepo} @ ${branch}`;\n        } else {\n            folderPickerTitleEl.textContent = \"Select a repository first\";\n        }\n    }\n\n    function setFolderPickerPath(\n        raw: string,\n        refresh = true,\n        syncInput = true\n    ): void {\n        const normalized = normalizeFolderPickerPath(raw);\n        folderPickerCurrentPath = normalized;\n        if (syncInput && folderPickerPathInput)\n            folderPickerPathInput.value = normalized;\n        if (refresh && folderPickerIsOpen) {\n            void refreshFolderPickerList();\n        }\n    }\n\n    async function refreshFolderPickerList(): Promise<void> {\n        if (!(folderPickerListEl && folderPickerIsOpen)) return;\n        const listEl = folderPickerListEl;\n        const requestId = ++folderPickerRefreshNonce;\n\n        listEl.replaceChildren(\n            createFolderPickerRow(\"Loading\u2026\", { muted: true, disabled: true })\n        );\n\n        const path = folderPickerCurrentPath;\n        const res = await listDir(path);\n        if (requestId !== folderPickerRefreshNonce) return;\n\n        if (!res.ok) {\n            const status = typeof res.status === \"number\" ? res.status : 0;\n            if (status === 404) {\n                listEl.replaceChildren(\n                    createFolderPickerRow(\n                        \"Folder not found. It will be created during export.\",\n                        { muted: true, disabled: true }\n                    )\n                );\n                return;\n            }\n            if (status === 409) {\n                listEl.replaceChildren(\n                    createFolderPickerRow(\n                        \"Cannot open this path: an existing file blocks the folder.\",\n                        { muted: true, disabled: true }\n                    )\n                );\n                return;\n            }\n            const message = res.message ? res.message : \"failed to fetch\";\n            listEl.replaceChildren(\n                createFolderPickerRow(`Error: ${message}`, {\n                    muted: true,\n                    disabled: true,\n                })\n            );\n            return;\n        }\n\n        const nodes: HTMLElement[] = [];\n        if (path) {\n            nodes.push(\n                createFolderPickerRow(\".. (up one level)\", {\n                    muted: true,\n                    onClick: () => {\n                        const parentParts = folderPickerCurrentPath\n                            .split(\"/\")\n                            .filter(Boolean);\n                        parentParts.pop();\n                        setFolderPickerPath(parentParts.join(\"/\"));\n                    },\n                })\n            );\n        }\n\n        const entries = Array.isArray(res.entries) ? res.entries : [];\n        const dirs = entries\n            .filter((e) => e.type === \"dir\")\n            .sort((a, b) => (a.name || \"\").localeCompare(b.name || \"\"));\n        if (dirs.length === 0) {\n            nodes.push(\n                createFolderPickerRow(\"(no subfolders)\", {\n                    muted: true,\n                    disabled: true,\n                })\n            );\n        } else {\n            for (const d of dirs) {\n                const name = d.name || \"\";\n                nodes.push(\n                    createFolderPickerRow(`${name}/`, {\n                        onClick: () => {\n                            const next = folderPickerCurrentPath\n                                ? `${folderPickerCurrentPath}/${name}`\n                                : name;\n                            setFolderPickerPath(next);\n                        },\n                    })\n                );\n            }\n        }\n\n        listEl.replaceChildren(...nodes);\n    }\n\n    function handleFolderPickerKeydown(event: KeyboardEvent): void {\n        if (!folderPickerIsOpen) return;\n        if (event.key === \"Escape\") {\n            event.preventDefault();\n            closeFolderPicker();\n        }\n    }\n\n    function populateGhRepos(\n        list: Array<{\n            full_name: string;\n            default_branch: string;\n            private: boolean;\n        }>\n    ): void {\n        if (!ghRepoSelect) return;\n        while (ghRepoSelect.options.length) ghRepoSelect.remove(0);\n        for (const r of list) {\n            const opt = doc!.createElement(\"option\");\n            opt.value = r.full_name;\n            opt.textContent = r.full_name;\n            ghRepoSelect.appendChild(opt);\n        }\n        ghRepoSelect.disabled = list.length === 0;\n\n        if (list.length > 0) {\n            if (currentOwner && currentRepo) {\n                const want = `${currentOwner}/${currentRepo}`;\n                let matched = false;\n                for (let i = 0; i < ghRepoSelect.options.length; i++) {\n                    if (ghRepoSelect.options[i].value === want) {\n                        ghRepoSelect.selectedIndex = i;\n                        matched = true;\n                        break;\n                    }\n                }\n                if (matched) {\n                    ghRepoSelect.dispatchEvent(\n                        new Event(\"change\", { bubbles: true })\n                    );\n                }\n            } else {\n                ghRepoSelect.selectedIndex = 0;\n                ghRepoSelect.dispatchEvent(\n                    new Event(\"change\", { bubbles: true })\n                );\n            }\n        }\n    }\n\n    function getCurrentBranch(): string {\n        if (desiredBranch) return desiredBranch;\n        if (ghBranchInput && !ghBranchInput.disabled) {\n            const raw = ghBranchInput.value.trim();\n            if (raw && raw !== \"__more__\" && raw !== \"__fetch__\") {\n                if (allBranches.includes(raw) || raw === defaultBranchFromApi)\n                    return raw;\n            }\n        }\n        return defaultBranchFromApi || \"\";\n    }\n\n    function getPrBaseBranch(): string {\n        return defaultBranchFromApi || \"\";\n    }\n\n    function persistGhState(\n        partial: Partial<{\n            owner: string;\n            repo: string;\n            branch: string;\n            folder: string;\n            filename: string;\n            commitMessage: string;\n            scope: GithubScope;\n            collection: string;\n            mode: string;\n            styleDictionary: boolean;\n            flatTokens: boolean;\n            createPr: boolean;\n            prBase: string;\n            prTitle: string;\n            prBody: string;\n        }>\n    ): void {\n        deps.postToPlugin({ type: \"GITHUB_SAVE_STATE\", payload: partial });\n    }\n\n    function requestCollectionsRefresh(): void {\n        if (ghCollectionsRefreshing) return;\n        ghCollectionsRefreshing = true;\n        deps.log(\"Refreshing Figma document state\u2026\");\n        deps.postToPlugin({ type: \"FETCH_COLLECTIONS\" });\n        updateExportCommitEnabled();\n    }\n\n    function updateExportCommitEnabled(): void {\n        const collectionSelect = pickCollectionSelect();\n        const modeSelect = pickModeSelect();\n\n        const hasRepo = !!(currentOwner && currentRepo);\n        const br = getCurrentBranch();\n        const commitMsg = (ghCommitMsgInput?.value || \"\").trim();\n        const scopeAll = !!(ghScopeAll && ghScopeAll.checked);\n        const scopeTypography = !!(\n            ghScopeTypography && ghScopeTypography.checked\n        );\n        const folderRaw = ghFolderInput ? ghFolderInput.value.trim() : \"\";\n        const hasFolder = normalizeFolderInput(folderRaw).display.length > 0;\n        const hasFilename = filenameValidation.ok;\n\n        const hasSelection =\n            scopeAll || scopeTypography\n                ? true\n                : !!(\n                      collectionSelect &&\n                      collectionSelect.value &&\n                      modeSelect &&\n                      modeSelect.value\n                  );\n\n        let ready = !!(\n            ghIsAuthed &&\n            hasRepo &&\n            br &&\n            commitMsg &&\n            hasSelection &&\n            hasFolder &&\n            hasFilename\n        );\n\n        if (ghCollectionsRefreshing) {\n            ready = false;\n        }\n\n        if (ghCreatePrChk && ghCreatePrChk.checked) {\n            const prBase = getPrBaseBranch();\n            if (!prBase || prBase === br) {\n                ready = false;\n            }\n        }\n\n        if (ghExportAndCommitBtn) ghExportAndCommitBtn.disabled = !ready;\n    }\n\n    function updateFolderControlsEnabled(): void {\n        const br = getCurrentBranch();\n        const enable = !!(currentOwner && currentRepo && br);\n        if (ghPickFolderBtn) ghPickFolderBtn.disabled = !enable;\n        updateExportCommitEnabled();\n        updateFetchButtonEnabled();\n    }\n\n    function updateFetchButtonEnabled(): void {\n        const hasRepo = !!(ghIsAuthed && currentOwner && currentRepo);\n        const branch = getCurrentBranch();\n        const path = (ghFetchPathInput?.value || \"\").trim();\n        if (ghFetchPathInput)\n            ghFetchPathInput.disabled =\n                !(hasRepo && branch) || ghImportInFlight;\n        if (ghFetchTokensBtn)\n            ghFetchTokensBtn.disabled =\n                ghImportInFlight || !(hasRepo && branch && path);\n\n        if (ghImportInFlight) return;\n\n        if (!hasRepo) {\n            lastImportTarget = null;\n            setImportStatus(\"idle\", IMPORT_PROMPT_SELECT);\n            return;\n        }\n        if (!branch) {\n            lastImportTarget = null;\n            setImportStatus(\"idle\", IMPORT_PROMPT_BRANCH);\n            return;\n        }\n        if (!path) {\n            lastImportTarget = null;\n            setImportStatus(\"idle\", IMPORT_PROMPT_PATH);\n            return;\n        }\n\n        if (\n            currentImportStatus === \"success\" ||\n            currentImportStatus === \"error\"\n        ) {\n            if (\n                !lastImportTarget ||\n                lastImportTarget.branch !== branch ||\n                lastImportTarget.path !== path\n            ) {\n                currentImportStatus = \"idle\";\n            }\n        }\n\n        if (\n            currentImportStatus !== \"success\" &&\n            currentImportStatus !== \"error\"\n        ) {\n            setImportStatus(\"ready\", `Ready to import from ${branch}.`);\n        }\n    }\n\n    function attach(context: AttachContext): void {\n        doc = context.document;\n        win = context.window;\n\n        ghTokenInput = findTokenInput();\n        ghRememberChk =\n            (doc.getElementById(\n                \"githubRememberChk\"\n            ) as HTMLInputElement | null) ||\n            (doc.getElementById(\"ghRememberChk\") as HTMLInputElement | null);\n        ghConnectBtn =\n            (doc.getElementById(\n                \"githubConnectBtn\"\n            ) as HTMLButtonElement | null) ||\n            (doc.getElementById(\"ghConnectBtn\") as HTMLButtonElement | null);\n        ghVerifyBtn =\n            (doc.getElementById(\n                \"githubVerifyBtn\"\n            ) as HTMLButtonElement | null) ||\n            (doc.getElementById(\"ghVerifyBtn\") as HTMLButtonElement | null);\n        ghLogoutBtn = doc.getElementById(\n            \"ghLogoutBtn\"\n        ) as HTMLButtonElement | null;\n        ghRepoSelect = doc.getElementById(\n            \"ghRepoSelect\"\n        ) as HTMLSelectElement | null;\n\n        ghBranchInput = doc.getElementById(\n            \"ghBranchInput\"\n        ) as HTMLInputElement | null;\n        ghBranchToggleBtn = doc.getElementById(\n            \"ghBranchToggleBtn\"\n        ) as HTMLButtonElement | null;\n        ghBranchMenu = doc.getElementById(\n            \"ghBranchMenu\"\n        ) as HTMLUListElement | null;\n        ghBranchCountEl = doc.getElementById(\"ghBranchCount\");\n        ghBranchRefreshBtn = doc.getElementById(\n            \"ghBranchRefreshBtn\"\n        ) as HTMLButtonElement | null;\n\n        ghNewBranchBtn = doc.getElementById(\n            \"ghNewBranchBtn\"\n        ) as HTMLButtonElement | null;\n        ghNewBranchRow = doc.getElementById(\"ghNewBranchRow\");\n        ghNewBranchName = doc.getElementById(\n            \"ghNewBranchName\"\n        ) as HTMLInputElement | null;\n        ghCreateBranchConfirmBtn = doc.getElementById(\n            \"ghCreateBranchConfirmBtn\"\n        ) as HTMLButtonElement | null;\n        ghCancelBranchBtn = doc.getElementById(\n            \"ghCancelBranchBtn\"\n        ) as HTMLButtonElement | null;\n\n        ghFolderInput = doc.getElementById(\n            \"ghFolderInput\"\n        ) as HTMLInputElement | null;\n        ghFolderDisplay = doc.getElementById(\"ghFolderDisplay\");\n        setGhFolderDisplay(ghFolderInput?.value || \"\");\n        ghPickFolderBtn = doc.getElementById(\n            \"ghPickFolderBtn\"\n        ) as HTMLButtonElement | null;\n        ghFilenameInput = doc.getElementById(\n            \"ghFilenameInput\"\n        ) as HTMLInputElement | null;\n        ghFilenameErrorEl = doc.getElementById(\"ghFilenameError\");\n        if (ghFilenameInput && !ghFilenameInput.value) {\n            ghFilenameInput.value = DEFAULT_GITHUB_FILENAME;\n        }\n        refreshFilenameValidation();\n        ghCommitMsgInput = doc.getElementById(\n            \"ghCommitMsgInput\"\n        ) as HTMLInputElement | null;\n        ghExportAndCommitBtn = doc.getElementById(\n            \"ghExportAndCommitBtn\"\n        ) as HTMLButtonElement | null;\n        ghCreatePrChk = doc.getElementById(\n            \"ghCreatePrChk\"\n        ) as HTMLInputElement | null;\n        ghPrOptionsEl = doc.getElementById(\"ghPrOptions\");\n        ghPrTitleInput = doc.getElementById(\n            \"ghPrTitleInput\"\n        ) as HTMLInputElement | null;\n        ghPrBodyInput = doc.getElementById(\n            \"ghPrBodyInput\"\n        ) as HTMLTextAreaElement | null;\n        ghFetchPathInput = doc.getElementById(\n            \"ghFetchPathInput\"\n        ) as HTMLInputElement | null;\n        ghFetchTokensBtn = doc.getElementById(\n            \"ghFetchTokensBtn\"\n        ) as HTMLButtonElement | null;\n        ghScopeSelected = doc.getElementById(\n            \"ghScopeSelected\"\n        ) as HTMLInputElement | null;\n        ghScopeAll = doc.getElementById(\n            \"ghScopeAll\"\n        ) as HTMLInputElement | null;\n        ghScopeTypography = doc.getElementById(\n            \"ghScopeTypography\"\n        ) as HTMLInputElement | null;\n        ghImportStatusEl = doc.getElementById(\"ghImportStatus\");\n\n        if (ghBranchInput) {\n            ghBranchInput.setAttribute(\"role\", \"combobox\");\n            ghBranchInput.setAttribute(\"aria-autocomplete\", \"list\");\n            ghBranchInput.setAttribute(\"aria-expanded\", \"false\");\n            ghBranchInput.setAttribute(\"aria-controls\", \"ghBranchMenu\");\n        }\n        if (ghBranchToggleBtn)\n            ghBranchToggleBtn.setAttribute(\"aria-expanded\", \"false\");\n\n        folderPickerOverlay = doc.getElementById(\"folderPickerOverlay\");\n        folderPickerTitleEl = doc.getElementById(\"folderPickerTitle\");\n        folderPickerPathInput = doc.getElementById(\n            \"folderPickerPath\"\n        ) as HTMLInputElement | null;\n        folderPickerUseBtn = doc.getElementById(\n            \"folderPickerUseBtn\"\n        ) as HTMLButtonElement | null;\n        folderPickerListEl = doc.getElementById(\"folderPickerList\");\n        folderPickerCancelBtn = doc.getElementById(\n            \"folderPickerCancelBtn\"\n        ) as HTMLButtonElement | null;\n\n        if (ghRememberChk) {\n            ghRememberChk.checked = ghRememberPref;\n            ghRememberChk.addEventListener(\"change\", () => {\n                updateRememberPref(!!ghRememberChk!.checked, true);\n            });\n        }\n\n        ensureGhStatusElements();\n\n        if (ghConnectBtn)\n            ghConnectBtn.addEventListener(\"click\", onGitHubConnectClick);\n        if (ghVerifyBtn)\n            ghVerifyBtn.addEventListener(\"click\", onGitHubVerifyClick);\n        if (ghLogoutBtn)\n            ghLogoutBtn.addEventListener(\"click\", onGitHubLogoutClick);\n\n        if (ghRepoSelect && ghBranchInput) {\n            let lastRepoKey = \"\";\n            ghRepoSelect.addEventListener(\"change\", () => {\n                const value = ghRepoSelect!.value;\n                if (!value) return;\n                if (value === lastRepoKey) return;\n                lastRepoKey = value;\n\n                const parts = value.split(\"/\");\n                currentOwner = parts[0] || \"\";\n                currentRepo = parts[1] || \"\";\n\n                updateExportCommitEnabled();\n                updateFetchButtonEnabled();\n\n                lastBranchesFetchedAtMs = 0;\n\n                deps.postToPlugin({\n                    type: \"GITHUB_SELECT_REPO\",\n                    payload: { owner: currentOwner, repo: currentRepo },\n                });\n\n                desiredBranch = null;\n                defaultBranchFromApi = undefined;\n                loadedPages = 0;\n                hasMorePages = false;\n                isFetchingBranches = false;\n                allBranches = [];\n                filteredBranches = [];\n                renderCount = 0;\n                if (ghBranchInput) {\n                    ghBranchInput.value = \"\";\n                    branchLastQuery = \"\";\n                    branchInputPristine = true;\n                }\n                if (ghBranchMenu)\n                    while (ghBranchMenu.firstChild)\n                        ghBranchMenu.removeChild(ghBranchMenu.firstChild);\n                closeBranchMenu();\n\n                setBranchDisabled(true, \"Loading branches\u2026\");\n                updateBranchCount();\n                updateFolderControlsEnabled();\n\n                setGhFolderDisplay(\"\");\n                cancelNewBranchFlow(false);\n\n                if (currentOwner && currentRepo) {\n                    deps.log(\n                        `GitHub: loading branches for ${currentOwner}/${currentRepo}\u2026`\n                    );\n                    isFetchingBranches = true;\n                    deps.postToPlugin({\n                        type: \"GITHUB_FETCH_BRANCHES\",\n                        payload: {\n                            owner: currentOwner,\n                            repo: currentRepo,\n                            page: 1,\n                        },\n                    });\n                }\n\n                updateExportCommitEnabled();\n            });\n        }\n\n        if (ghBranchInput) {\n            let timeout: number | undefined;\n            ghBranchInput.addEventListener(\"focus\", () => {\n                if (ghBranchInput!.disabled) return;\n                applyBranchFilter();\n                openBranchMenu();\n            });\n            ghBranchInput.addEventListener(\"input\", () => {\n                if (timeout) win?.clearTimeout(timeout);\n                const value = ghBranchInput!.value;\n                if (value !== \"__more__\" && value !== \"__fetch__\") {\n                    branchLastQuery = value;\n                }\n                branchInputPristine = false;\n                if (!branchMenuVisible) openBranchMenu();\n                timeout = win?.setTimeout(() => {\n                    applyBranchFilter();\n                }, 120) as number | undefined;\n            });\n            ghBranchInput.addEventListener(\"keydown\", (e: KeyboardEvent) => {\n                if (e.key === \"ArrowDown\") {\n                    openBranchMenu();\n                    moveBranchHighlight(1);\n                    e.preventDefault();\n                    return;\n                }\n                if (e.key === \"ArrowUp\") {\n                    openBranchMenu();\n                    moveBranchHighlight(-1);\n                    e.preventDefault();\n                    return;\n                }\n                if (e.key === \"Enter\") {\n                    if (branchMenuVisible && branchHighlightIndex >= 0) {\n                        const items = getBranchMenuItems();\n                        const item = items[branchHighlightIndex];\n                        if (item && item.dataset.selectable === \"1\") {\n                            const value = item.getAttribute(\"data-value\") || \"\";\n                            if (value) {\n                                const result = processBranchSelection(\n                                    value,\n                                    true\n                                );\n                                if (result === \"selected\") closeBranchMenu();\n                                else if (\n                                    result === \"more\" ||\n                                    result === \"fetch\"\n                                ) {\n                                    syncBranchHighlightAfterRender();\n                                    openBranchMenu();\n                                }\n                            }\n                        }\n                    } else {\n                        const result = processBranchSelection(\n                            ghBranchInput!.value,\n                            false\n                        );\n                        if (result === \"selected\") closeBranchMenu();\n                        else if (result === \"more\" || result === \"fetch\")\n                            syncBranchHighlightAfterRender();\n                    }\n                    revalidateBranchesIfStale(true);\n                    e.preventDefault();\n                    return;\n                }\n                if (e.key === \"Escape\") {\n                    if (branchMenuVisible) {\n                        closeBranchMenu();\n                        e.preventDefault();\n                    }\n                }\n            });\n            ghBranchInput.addEventListener(\"change\", () => {\n                const result = processBranchSelection(\n                    ghBranchInput!.value,\n                    false\n                );\n                if (result === \"selected\") closeBranchMenu();\n                else if (result === \"more\" || result === \"fetch\")\n                    syncBranchHighlightAfterRender();\n            });\n        }\n\n        if (ghBranchToggleBtn) {\n            ghBranchToggleBtn.addEventListener(\"click\", () => {\n                if (ghBranchToggleBtn!.disabled) return;\n                if (branchMenuVisible) {\n                    closeBranchMenu();\n                    return;\n                }\n                if (!ghBranchMenu || !ghBranchMenu.childElementCount)\n                    renderOptions();\n                openBranchMenu();\n                if (ghBranchInput && doc?.activeElement !== ghBranchInput)\n                    ghBranchInput.focus();\n            });\n        }\n\n        if (ghBranchMenu) {\n            ghBranchMenu.addEventListener(\"mousedown\", (event) => {\n                event.preventDefault();\n            });\n            ghBranchMenu.addEventListener(\"click\", (event) => {\n                const target = event.target as HTMLElement | null;\n                if (!target) return;\n                const item = target.closest(\"li\");\n                if (!item || !(item instanceof HTMLLIElement)) return;\n                if (item.getAttribute(\"aria-disabled\") === \"true\") return;\n                const value = item.getAttribute(\"data-value\") || \"\";\n                if (!value) return;\n                const result = processBranchSelection(value, true);\n                if (result === \"selected\") closeBranchMenu();\n                else if (result === \"more\" || result === \"fetch\") {\n                    syncBranchHighlightAfterRender();\n                    openBranchMenu();\n                }\n                if (ghBranchInput) ghBranchInput.focus();\n            });\n        }\n\n        if (doc) {\n            doc.addEventListener(\"mousedown\", (event) => {\n                if (!branchMenuVisible) return;\n                const target = event.target as Node | null;\n                if (!target) return;\n                if (ghBranchMenu && ghBranchMenu.contains(target)) return;\n                if (ghBranchInput && target === ghBranchInput) return;\n                if (ghBranchToggleBtn && ghBranchToggleBtn.contains(target))\n                    return;\n                closeBranchMenu();\n            });\n            doc.addEventListener(\"focusin\", (event) => {\n                if (!branchMenuVisible) return;\n                const target = event.target as Node | null;\n                if (!target) {\n                    closeBranchMenu();\n                    return;\n                }\n                if (ghBranchMenu && ghBranchMenu.contains(target)) return;\n                if (ghBranchInput && target === ghBranchInput) return;\n                if (ghBranchToggleBtn && ghBranchToggleBtn.contains(target))\n                    return;\n                closeBranchMenu();\n            });\n        }\n\n        if (ghBranchRefreshBtn) {\n            ghBranchRefreshBtn.addEventListener(\"click\", () => {\n                lastBranchesFetchedAtMs = 0;\n                revalidateBranchesIfStale(true);\n            });\n        }\n\n        if (ghNewBranchBtn) {\n            ghNewBranchBtn.addEventListener(\"click\", () => {\n                if (ghNewBranchBtn!.disabled) return;\n                const next = !isNewBranchRowVisible();\n                if (next) showNewBranchRow(true);\n                else cancelNewBranchFlow(false);\n            });\n        }\n\n        if (ghNewBranchName) {\n            ghNewBranchName.addEventListener(\"keydown\", (event) => {\n                if (event.key === \"Enter\") {\n                    event.preventDefault();\n                    requestNewBranchCreation();\n                } else if (event.key === \"Escape\") {\n                    event.preventDefault();\n                    cancelNewBranchFlow(true);\n                }\n            });\n        }\n\n        if (ghCreateBranchConfirmBtn) {\n            ghCreateBranchConfirmBtn.addEventListener(\"click\", () => {\n                requestNewBranchCreation();\n            });\n        }\n\n        if (ghCancelBranchBtn) {\n            ghCancelBranchBtn.addEventListener(\"click\", () => {\n                cancelNewBranchFlow(true);\n            });\n        }\n\n        if (ghPickFolderBtn) {\n            ghPickFolderBtn.addEventListener(\"click\", openFolderPicker);\n        }\n\n        if (folderPickerOverlay) {\n            folderPickerOverlay.addEventListener(\"click\", (event) => {\n                if (event.target === folderPickerOverlay) closeFolderPicker();\n            });\n        }\n\n        if (folderPickerCancelBtn) {\n            folderPickerCancelBtn.addEventListener(\"click\", () =>\n                closeFolderPicker()\n            );\n        }\n\n        let folderPickerPathDebounce: number | undefined;\n        if (folderPickerPathInput) {\n            folderPickerPathInput.addEventListener(\"input\", () => {\n                if (folderPickerPathDebounce)\n                    win?.clearTimeout(folderPickerPathDebounce);\n                const value = folderPickerPathInput!.value;\n                folderPickerPathDebounce = win?.setTimeout(() => {\n                    setFolderPickerPath(value, true, false);\n                }, 120) as number | undefined;\n            });\n            folderPickerPathInput.addEventListener(\"keydown\", (event) => {\n                if (event.key === \"Enter\") {\n                    event.preventDefault();\n                    setFolderPickerPath(folderPickerPathInput!.value);\n                }\n            });\n            folderPickerPathInput.addEventListener(\"blur\", () => {\n                setFolderPickerPath(folderPickerPathInput!.value);\n            });\n        }\n\n        if (folderPickerUseBtn) {\n            folderPickerUseBtn.addEventListener(\"click\", () => {\n                if (folderPickerPathInput) {\n                    setFolderPickerPath(folderPickerPathInput.value, false);\n                }\n                const selectionRaw = folderPickerCurrentPath\n                    ? `${folderPickerCurrentPath}/`\n                    : \"/\";\n                const normalized = normalizeFolderInput(selectionRaw);\n                setGhFolderDisplay(normalized.display);\n                deps.postToPlugin({\n                    type: \"GITHUB_SET_FOLDER\",\n                    payload: {\n                        owner: currentOwner,\n                        repo: currentRepo,\n                        folder: normalized.payload,\n                    },\n                });\n                persistGhState({ folder: normalized.payload });\n                closeFolderPicker();\n                deps.log(\n                    `Folder selected: ${\n                        normalized.display === \"/\"\n                            ? \"(repo root)\"\n                            : normalized.display\n                    }`\n                );\n                updateExportCommitEnabled();\n                updateFetchButtonEnabled();\n            });\n        }\n\n        // ghFolderInput is read-only; picker interactions keep it in sync.\n\n        if (ghCommitMsgInput) {\n            ghCommitMsgInput.addEventListener(\"input\", () => {\n                updateExportCommitEnabled();\n                persistGhState({\n                    commitMessage: ghCommitMsgInput!.value || \"\",\n                });\n            });\n        }\n\n        if (ghFilenameInput) {\n            ghFilenameInput.addEventListener(\"input\", () => {\n                refreshFilenameValidation();\n                persistGhState({\n                    filename: (ghFilenameInput!.value || \"\").trim(),\n                });\n                updateExportCommitEnabled();\n            });\n            ghFilenameInput.addEventListener(\"blur\", () =>\n                refreshFilenameValidation()\n            );\n        }\n\n        if (ghScopeSelected) {\n            ghScopeSelected.addEventListener(\"change\", () => {\n                if (ghScopeSelected?.checked && ghPrOptionsEl) {\n                    ghPrOptionsEl.style.display = ghCreatePrChk?.checked\n                        ? \"flex\"\n                        : \"none\";\n                }\n                if (ghScopeSelected!.checked) {\n                    persistGhState({ scope: \"selected\" });\n                    requestCollectionsRefresh();\n                }\n                updateExportCommitEnabled();\n            });\n        }\n\n        if (ghScopeAll) {\n            ghScopeAll.addEventListener(\"change\", () => {\n                if (ghScopeAll!.checked) {\n                    persistGhState({ scope: \"all\" });\n                    requestCollectionsRefresh();\n                }\n                updateExportCommitEnabled();\n            });\n        }\n\n        if (ghScopeTypography) {\n            ghScopeTypography.addEventListener(\"change\", () => {\n                if (ghScopeTypography!.checked) {\n                    persistGhState({ scope: \"typography\" });\n                    requestCollectionsRefresh();\n                }\n                if (ghPrOptionsEl)\n                    ghPrOptionsEl.style.display = ghCreatePrChk?.checked\n                        ? \"flex\"\n                        : \"none\";\n                updateExportCommitEnabled();\n            });\n        }\n\n        if (ghCreatePrChk) {\n            ghCreatePrChk.addEventListener(\"change\", () => {\n                const on = !!ghCreatePrChk!.checked;\n                if (ghPrOptionsEl)\n                    ghPrOptionsEl.style.display = on ? \"flex\" : \"none\";\n                const save: Partial<{ createPr: boolean; prBase: string }> = {\n                    createPr: on,\n                };\n                if (on) save.prBase = getPrBaseBranch();\n                persistGhState(save);\n                updateExportCommitEnabled();\n            });\n        }\n\n        if (ghPrTitleInput) {\n            ghPrTitleInput.addEventListener(\"input\", () => {\n                persistGhState({ prTitle: ghPrTitleInput!.value });\n            });\n        }\n\n        if (ghPrBodyInput) {\n            ghPrBodyInput.addEventListener(\"input\", () => {\n                persistGhState({ prBody: ghPrBodyInput!.value });\n            });\n        }\n\n        if (ghFetchPathInput)\n            ghFetchPathInput.addEventListener(\n                \"input\",\n                updateFetchButtonEnabled\n            );\n\n        if (ghFetchTokensBtn) {\n            ghFetchTokensBtn.addEventListener(\"click\", () => {\n                const branch = getCurrentBranch();\n                const path = (ghFetchPathInput?.value || \"\")\n                    .trim()\n                    .replace(/^\\/+/, \"\");\n                if (!currentOwner || !currentRepo) {\n                    deps.log(\"Pick a repository first.\");\n                    return;\n                }\n                if (!branch) {\n                    deps.log(\"Pick a branch first.\");\n                    return;\n                }\n                if (!path) {\n                    deps.log(\n                        \"Enter a path to fetch (e.g., tokens/tokens.json).\"\n                    );\n                    return;\n                }\n                ghImportInFlight = true;\n                lastImportTarget = { branch, path };\n                setImportStatus(\"progress\", `Fetching ${path} from ${branch}\u2026`);\n                updateFetchButtonEnabled();\n                deps.log(\n                    `GitHub: fetching ${path} from ${currentOwner}/${currentRepo}@${branch}\u2026`\n                );\n                const allowHex = !!pickAllowHexCheckbox()?.checked;\n                const contexts = deps.getImportContexts();\n                const payload: UiToPlugin = {\n                    type: \"GITHUB_FETCH_TOKENS\",\n                    payload: {\n                        owner: currentOwner,\n                        repo: currentRepo,\n                        branch,\n                        path,\n                        allowHexStrings: allowHex,\n                        ...(contexts.length > 0 ? { contexts } : {}),\n                    },\n                };\n                deps.postToPlugin(payload);\n                if (contexts.length > 0) {\n                    deps.log(\n                        `GitHub: importing ${contexts.length} selected mode(s) based on current scope.`\n                    );\n                }\n            });\n        }\n\n        if (ghExportAndCommitBtn) {\n            ghExportAndCommitBtn.addEventListener(\"click\", () => {\n                const collectionSelect = pickCollectionSelect();\n                const modeSelect = pickModeSelect();\n\n                const scope: GithubScope =\n                    ghScopeAll && ghScopeAll.checked\n                        ? \"all\"\n                        : ghScopeTypography && ghScopeTypography.checked\n                        ? \"typography\"\n                        : \"selected\";\n                const selectedCollection = collectionSelect\n                    ? collectionSelect.value || \"\"\n                    : \"\";\n                const selectedMode = modeSelect ? modeSelect.value || \"\" : \"\";\n                const commitMessage = (\n                    ghCommitMsgInput?.value || \"Update tokens from Figma\"\n                ).trim();\n                const normalizedFolder = normalizeFolderInput(\n                    ghFolderInput?.value || \"\"\n                );\n                refreshFilenameValidation();\n\n                if (scope === \"selected\") {\n                    if (!selectedCollection || !selectedMode) {\n                        deps.log(\n                            \"Pick a collection and a mode before exporting.\"\n                        );\n                        if (!selectedCollection && collectionSelect)\n                            collectionSelect.focus();\n                        else if (!selectedMode && modeSelect)\n                            modeSelect.focus();\n                        updateExportCommitEnabled();\n                        return;\n                    }\n                }\n\n                if (!normalizedFolder.display) {\n                    deps.log(\"Pick a destination folder (e.g., tokens/).\");\n                    ghPickFolderBtn?.focus();\n                    updateExportCommitEnabled();\n                    return;\n                }\n                if (!filenameValidation.ok) {\n                    deps.log(filenameValidation.message);\n                    ghFilenameInput?.focus();\n                    updateExportCommitEnabled();\n                    return;\n                }\n\n                const filenameToUse = filenameValidation.filename;\n\n                setGhFolderDisplay(normalizedFolder.display);\n                deps.postToPlugin({\n                    type: \"GITHUB_SET_FOLDER\",\n                    payload: {\n                        owner: currentOwner,\n                        repo: currentRepo,\n                        folder: normalizedFolder.payload,\n                    },\n                });\n                persistGhState({\n                    folder: normalizedFolder.payload,\n                    filename: filenameToUse,\n                });\n\n                const createPr = !!(ghCreatePrChk && ghCreatePrChk.checked);\n                const payload: UiToPlugin = {\n                    type: \"GITHUB_EXPORT_AND_COMMIT\",\n                    payload: {\n                        owner: currentOwner,\n                        repo: currentRepo,\n                        branch: getCurrentBranch(),\n                        folder: normalizedFolder.payload,\n                        filename: filenameToUse,\n                        commitMessage,\n                        scope,\n                        styleDictionary:\n                            !!pickStyleDictionaryCheckbox()?.checked,\n                        flatTokens: !!pickFlatTokensCheckbox()?.checked,\n                        createPr,\n                    },\n                };\n\n                if (selectedCollection)\n                    payload.payload.collection = selectedCollection;\n                if (selectedMode) payload.payload.mode = selectedMode;\n\n                if (createPr) {\n                    payload.payload.prBase = getPrBaseBranch();\n                    payload.payload.prTitle = (\n                        ghPrTitleInput?.value || \"\"\n                    ).trim();\n                    payload.payload.prBody = ghPrBodyInput?.value || \"\";\n                }\n\n                const scopeLabel =\n                    scope === \"all\"\n                        ? \"all collections\"\n                        : scope === \"typography\"\n                        ? \"typography\"\n                        : \"selected mode\";\n                const summaryTarget = formatDestinationForLog(\n                    normalizedFolder.payload,\n                    filenameToUse\n                );\n                deps.log(\n                    `GitHub: Export summary \u2192 ${summaryTarget} (${scopeLabel})`\n                );\n                deps.log(\n                    createPr\n                        ? \"Export, Commit & PR requested\u2026\"\n                        : \"Export & Commit requested\u2026\"\n                );\n                deps.postToPlugin(payload);\n            });\n        }\n\n        doc.addEventListener(\"keydown\", handleFolderPickerKeydown);\n\n        updateGhStatusUi();\n        updateFolderControlsEnabled();\n        updateExportCommitEnabled();\n        updateFetchButtonEnabled();\n    }\n\n    function onGitHubConnectClick(): void {\n        const tokenRaw = readPatFromUi();\n        const isMasked = ghTokenInput?.getAttribute(\"data-filled\") === \"1\";\n        if (ghIsAuthed && isMasked) return;\n        if (!tokenRaw) {\n            deps.log(\"GitHub: Paste a Personal Access Token first.\");\n            return;\n        }\n        const remember = !!(ghRememberChk && ghRememberChk.checked);\n        deps.log(\"GitHub: Verifying token\u2026\");\n        deps.postToPlugin({\n            type: \"GITHUB_SET_TOKEN\",\n            payload: { token: tokenRaw, remember },\n        });\n    }\n\n    function onGitHubVerifyClick(): void {\n        onGitHubConnectClick();\n    }\n\n    function onGitHubLogoutClick(): void {\n        deps.postToPlugin({ type: \"GITHUB_FORGET_TOKEN\" });\n        ghIsAuthed = false;\n        ghTokenExpiresAt = null;\n        setPatFieldObfuscated(false);\n        populateGhRepos([]);\n        updateGhStatusUi();\n        currentOwner = \"\";\n        currentRepo = \"\";\n        allBranches = [];\n        filteredBranches = [];\n        desiredBranch = null;\n        defaultBranchFromApi = undefined;\n        loadedPages = 0;\n        hasMorePages = false;\n        isFetchingBranches = false;\n        if (ghBranchInput) {\n            ghBranchInput.value = \"\";\n            branchLastQuery = \"\";\n            branchInputPristine = true;\n        }\n        if (ghBranchMenu)\n            while (ghBranchMenu.firstChild)\n                ghBranchMenu.removeChild(ghBranchMenu.firstChild);\n        closeBranchMenu();\n        setBranchDisabled(true, \"Pick a repository first\u2026\");\n        updateBranchCount();\n        updateFolderControlsEnabled();\n        setGhFolderDisplay(\"\");\n        cancelNewBranchFlow(false);\n        deps.log(\"GitHub: Logged out.\");\n    }\n\n    function handleMessage(msg: PluginToUi): boolean {\n        if (msg.type === \"GITHUB_AUTH_RESULT\") {\n            const p = msg.payload || ({} as any);\n            ghIsAuthed = !!p.ok;\n            ghTokenExpiresAt =\n                typeof p.exp !== \"undefined\" && p.exp !== null\n                    ? p.exp\n                    : typeof p.tokenExpiration !== \"undefined\" &&\n                      p.tokenExpiration !== null\n                    ? p.tokenExpiration\n                    : null;\n\n            if (typeof p.remember === \"boolean\") {\n                updateRememberPref(p.remember, false);\n            }\n\n            if (ghIsAuthed) {\n                setPatFieldObfuscated(true);\n                const who = p.login || \"unknown\";\n                const name = p.name ? ` (${p.name})` : \"\";\n                deps.log(`GitHub: Authenticated as ${who}${name}.`);\n            } else {\n                setPatFieldObfuscated(false);\n                const why = p.error ? `: ${p.error}` : \".\";\n                deps.log(`GitHub: Authentication failed${why}`);\n            }\n\n            updateGhStatusUi();\n            updateExportCommitEnabled();\n            updateFetchButtonEnabled();\n            return true;\n        }\n\n        if (msg.type === \"GITHUB_REPOS\") {\n            const repos = (msg.payload?.repos ?? []) as Array<{\n                full_name: string;\n                default_branch: string;\n                private: boolean;\n            }>;\n            populateGhRepos(repos);\n            deps.log(`GitHub: Repository list updated (${repos.length}).`);\n            return true;\n        }\n\n        if (msg.type === \"GITHUB_RESTORE_SELECTED\") {\n            const p = msg.payload || {};\n            currentOwner = typeof p.owner === \"string\" ? p.owner : \"\";\n            currentRepo = typeof p.repo === \"string\" ? p.repo : \"\";\n            desiredBranch = typeof p.branch === \"string\" ? p.branch : null;\n\n            if (typeof p.folder === \"string\") {\n                const normalized = normalizeFolderInput(p.folder);\n                setGhFolderDisplay(normalized.display);\n            }\n            if (ghFilenameInput) {\n                if (typeof p.filename === \"string\" && p.filename.trim()) {\n                    ghFilenameInput.value = p.filename;\n                } else if (!ghFilenameInput.value) {\n                    ghFilenameInput.value = DEFAULT_GITHUB_FILENAME;\n                }\n            }\n            refreshFilenameValidation();\n            if (typeof p.commitMessage === \"string\" && ghCommitMsgInput) {\n                ghCommitMsgInput.value = p.commitMessage;\n            }\n            if (typeof p.scope === \"string\") {\n                if (p.scope === \"all\" && ghScopeAll) ghScopeAll.checked = true;\n                if (p.scope === \"selected\" && ghScopeSelected)\n                    ghScopeSelected.checked = true;\n                if (p.scope === \"typography\" && ghScopeTypography)\n                    ghScopeTypography.checked = true;\n            }\n            const styleDictChk = pickStyleDictionaryCheckbox();\n            if (styleDictChk && typeof p.styleDictionary === \"boolean\") {\n                styleDictChk.checked = p.styleDictionary;\n            }\n            const flatChk = pickFlatTokensCheckbox();\n            if (flatChk && typeof p.flatTokens === \"boolean\") {\n                flatChk.checked = p.flatTokens;\n            }\n            if (typeof p.createPr === \"boolean\" && ghCreatePrChk) {\n                ghCreatePrChk.checked = p.createPr;\n                if (ghPrOptionsEl)\n                    ghPrOptionsEl.style.display = p.createPr ? \"flex\" : \"none\";\n            }\n            if (typeof p.prTitle === \"string\" && ghPrTitleInput)\n                ghPrTitleInput.value = p.prTitle;\n            if (typeof p.prBody === \"string\" && ghPrBodyInput)\n                ghPrBodyInput.value = p.prBody;\n\n            updateExportCommitEnabled();\n            updateFetchButtonEnabled();\n            return true;\n        }\n\n        if (msg.type === \"GITHUB_BRANCHES\") {\n            const pl = (msg.payload || {}) as any;\n            const owner = String(pl.owner || \"\");\n            const repo = String(pl.repo || \"\");\n            if (owner !== currentOwner || repo !== currentRepo) return true;\n\n            lastBranchesFetchedAtMs = Date.now();\n\n            loadedPages = Number(pl.page || 1);\n            hasMorePages = !!pl.hasMore;\n            isFetchingBranches = false;\n\n            if (typeof pl.defaultBranch === \"string\" && !defaultBranchFromApi) {\n                defaultBranchFromApi = pl.defaultBranch;\n            }\n\n            if (ghNewBranchBtn) ghNewBranchBtn.disabled = false;\n\n            const names = Array.isArray(pl.branches)\n                ? (pl.branches as Array<{ name: string }>).map((b) => b.name)\n                : [];\n            const set = new Set(allBranches);\n            for (const n of names) if (n) set.add(n);\n            allBranches = Array.from(set).sort((a, b) => a.localeCompare(b));\n\n            applyBranchFilter();\n            setBranchDisabled(false);\n            updateFolderControlsEnabled();\n\n            const rate = pl.rate as\n                | { remaining?: number; resetEpochSec?: number }\n                | undefined;\n            if (\n                rate &&\n                typeof rate.remaining === \"number\" &&\n                rate.remaining <= 3 &&\n                typeof rate.resetEpochSec === \"number\"\n            ) {\n                const t = new Date(\n                    rate.resetEpochSec * 1000\n                ).toLocaleTimeString();\n                deps.log(`GitHub: near rate limit; resets ~${t}`);\n            }\n\n            deps.log(\n                `Loaded ${\n                    names.length\n                } branches (page ${loadedPages}) for ${repo}${\n                    hasMorePages ? \"\u2026\" : \"\"\n                }`\n            );\n            return true;\n        }\n\n        if (msg.type === \"GITHUB_BRANCHES_ERROR\") {\n            const pl = (msg.payload || {}) as any;\n            const owner = String(pl.owner || \"\");\n            const repo = String(pl.repo || \"\");\n            if (owner !== currentOwner || repo !== currentRepo) return true;\n            isFetchingBranches = false;\n            setBranchDisabled(false);\n            updateFolderControlsEnabled();\n            deps.log(\n                `Branch load failed (status ${pl.status}): ${\n                    pl.message || \"unknown error\"\n                }`\n            );\n            if (pl.samlRequired)\n                deps.log(\n                    \"This org requires SSO. Open the repo in your browser and authorize SSO for your token.\"\n                );\n            if (pl.rate && typeof pl.rate.resetEpochSec === \"number\") {\n                const t = new Date(\n                    pl.rate.resetEpochSec * 1000\n                ).toLocaleTimeString();\n                deps.log(`Rate limit issue; resets ~${t}`);\n            }\n            return true;\n        }\n\n        if (msg.type === \"GITHUB_CREATE_BRANCH_RESULT\") {\n            const pl = (msg.payload || {}) as any;\n            if (ghCreateBranchConfirmBtn)\n                ghCreateBranchConfirmBtn.disabled = false;\n            if (typeof pl.ok !== \"boolean\") return true;\n\n            if (pl.ok) {\n                const baseBranch = String(pl.baseBranch || \"\");\n                const newBranch = String(pl.newBranch || \"\");\n                const url = String(pl.html_url || \"\");\n\n                if (newBranch) {\n                    const s = new Set(allBranches);\n                    if (!s.has(newBranch)) {\n                        s.add(newBranch);\n                        allBranches = Array.from(s).sort((a, b) =>\n                            a.localeCompare(b)\n                        );\n                    }\n                    desiredBranch = newBranch;\n                    if (ghBranchInput) {\n                        ghBranchInput.value = newBranch;\n                        branchLastQuery = newBranch;\n                        branchInputPristine = false;\n                    }\n                    applyBranchFilter();\n                }\n\n                updateFolderControlsEnabled();\n                showNewBranchRow(false);\n                if (ghNewBranchName) ghNewBranchName.value = \"\";\n\n                if (url) {\n                    deps.log(\n                        `Branch created: ${newBranch} (from ${baseBranch})`\n                    );\n                    const logEl = deps.getLogElement();\n                    if (logEl && doc) {\n                        const wrap = doc.createElement(\"div\");\n                        const a = doc.createElement(\"a\");\n                        a.href = url;\n                        a.target = \"_blank\";\n                        a.textContent = \"View on GitHub\";\n                        wrap.appendChild(a);\n                        logEl.appendChild(wrap);\n                        (logEl as HTMLElement).scrollTop = (\n                            logEl as HTMLElement\n                        ).scrollHeight;\n                    }\n                } else {\n                    deps.log(\n                        `Branch created: ${newBranch} (from ${baseBranch})`\n                    );\n                }\n                return true;\n            }\n\n            const status = pl.status ?? 0;\n            const message = pl.message || \"unknown error\";\n            deps.log(`Create branch failed (status ${status}): ${message}`);\n            if (pl.samlRequired) {\n                deps.log(\n                    \"This org requires SSO. Open the repo in your browser and authorize SSO for your token.\"\n                );\n            } else if (status === 403) {\n                if (pl.noPushPermission) {\n                    deps.log(\n                        \"You do not have push permission to this repository. Ask a maintainer for write access.\"\n                    );\n                } else {\n                    deps.log(\"Likely a token permission issue:\");\n                    deps.log(\n                        '\u2022 Classic PAT: add the \"repo\" scope (or \"public_repo\" for public repos).'\n                    );\n                    deps.log(\n                        '\u2022 Fine-grained PAT: grant this repository and set \"Contents: Read and write\".'\n                    );\n                }\n            }\n            if (pl.rate && typeof pl.rate.resetEpochSec === \"number\") {\n                const t = new Date(\n                    pl.rate.resetEpochSec * 1000\n                ).toLocaleTimeString();\n                deps.log(`Rate limit issue; resets ~${t}`);\n            }\n            return true;\n        }\n\n        if (msg.type === \"GITHUB_FOLDER_LIST_RESULT\") {\n            const pl = (msg.payload || {}) as any;\n            const path = String(pl.path || \"\").replace(/^\\/+|\\/+$/g, \"\");\n            const ok = !!pl.ok;\n            const entries = Array.isArray(pl.entries) ? pl.entries : [];\n            const message = String(pl.message || \"\");\n\n            for (let i = 0; i < folderListWaiters.length; i++) {\n                if (folderListWaiters[i].path === path) {\n                    const waiter = folderListWaiters.splice(i, 1)[0];\n                    if (ok) waiter.resolve({ ok: true, entries });\n                    else\n                        waiter.reject({\n                            ok: false,\n                            message: message || `HTTP ${pl.status || 0}`,\n                            status:\n                                typeof pl.status === \"number\"\n                                    ? pl.status\n                                    : undefined,\n                        });\n                    break;\n                }\n            }\n            return true;\n        }\n\n        if (msg.type === \"GITHUB_CREATE_FOLDER_RESULT\") {\n            const pl = (msg.payload || {}) as any;\n            const fp = String(pl.folderPath || \"\").replace(/^\\/+|\\/+$/g, \"\");\n            const ok = !!pl.ok;\n            const message = String(pl.message || \"\");\n\n            for (let i = 0; i < folderCreateWaiters.length; i++) {\n                if (folderCreateWaiters[i].folderPath === fp) {\n                    const waiter = folderCreateWaiters.splice(i, 1)[0];\n                    if (ok) waiter.resolve({ ok: true });\n                    else\n                        waiter.reject({\n                            ok: false,\n                            message: message || `HTTP ${pl.status || 0}`,\n                            status: pl.status,\n                        });\n                    break;\n                }\n            }\n            return true;\n        }\n\n        if (msg.type === \"GITHUB_COMMIT_RESULT\") {\n            if (msg.payload.ok) {\n                const url = String(msg.payload.commitUrl || \"\");\n                const branch = msg.payload.branch || \"\";\n                const destination = formatDestinationForLog(\n                    msg.payload.folder,\n                    msg.payload.filename\n                );\n                const committedPath = msg.payload.fullPath || destination;\n                deps.log(`Commit succeeded (${branch}): ${url || \"(no URL)\"}`);\n                deps.log(`Committed ${committedPath}`);\n                if (url) {\n                    const logEl = deps.getLogElement();\n                    if (logEl && doc) {\n                        const wrap = doc.createElement(\"div\");\n                        const a = doc.createElement(\"a\");\n                        a.href = url;\n                        a.target = \"_blank\";\n                        a.textContent = \"View commit\";\n                        wrap.appendChild(a);\n                        logEl.appendChild(wrap);\n                        (logEl as HTMLElement).scrollTop = (\n                            logEl as HTMLElement\n                        ).scrollHeight;\n                    }\n                }\n                if (msg.payload.createdPr) {\n                    const pr = msg.payload.createdPr;\n                    deps.log(\n                        `PR prepared (#${pr.number}) from ${pr.head} \u2192 ${pr.base}`\n                    );\n                }\n            } else {\n                const status =\n                    typeof msg.payload.status === \"number\"\n                        ? msg.payload.status\n                        : 0;\n                const message = msg.payload.message || \"unknown error\";\n                const destination = formatDestinationForLog(\n                    msg.payload.folder,\n                    msg.payload.filename\n                );\n                const committedPath = msg.payload.fullPath || destination;\n                if (status === 304) {\n                    deps.log(`Commit skipped: ${message} (${committedPath})`);\n                } else {\n                    deps.log(\n                        `Commit failed (${status}): ${message} (${committedPath})`\n                    );\n                }\n            }\n            return true;\n        }\n\n        if (msg.type === \"GITHUB_PR_RESULT\") {\n            if (msg.payload.ok) {\n                deps.log(\n                    `PR created: #${msg.payload.number} (${msg.payload.head} \u2192 ${msg.payload.base})`\n                );\n                const url = msg.payload.url;\n                if (url) {\n                    const logEl = deps.getLogElement();\n                    if (logEl && doc) {\n                        const wrap = doc.createElement(\"div\");\n                        const a = doc.createElement(\"a\");\n                        a.href = url;\n                        a.target = \"_blank\";\n                        a.textContent = \"View PR\";\n                        wrap.appendChild(a);\n                        logEl.appendChild(wrap);\n                        (logEl as HTMLElement).scrollTop = (\n                            logEl as HTMLElement\n                        ).scrollHeight;\n                    }\n                }\n            } else {\n                deps.log(\n                    `PR creation failed (${msg.payload.status || 0}): ${\n                        msg.payload.message || \"unknown error\"\n                    }`\n                );\n            }\n            return true;\n        }\n\n        if (msg.type === \"GITHUB_FETCH_TOKENS_RESULT\") {\n            ghImportInFlight = false;\n            if (msg.payload.ok) {\n                deps.log(\n                    `Imported tokens from ${msg.payload.path} (${msg.payload.branch})`\n                );\n                const branch = String(msg.payload.branch || \"\");\n                const path = String(msg.payload.path || \"\");\n                lastImportTarget = { branch, path };\n                setImportStatus(\n                    \"success\",\n                    `Imported tokens from ${branch}:${path}.`\n                );\n            } else {\n                deps.log(\n                    `GitHub fetch failed (${msg.payload.status || 0}): ${\n                        msg.payload.message || \"unknown error\"\n                    }`\n                );\n                const status =\n                    typeof msg.payload.status === \"number\"\n                        ? msg.payload.status\n                        : 0;\n                const message = msg.payload.message || \"Unknown error\";\n                const branch = String(msg.payload.branch || \"\");\n                const path = String(msg.payload.path || \"\");\n                lastImportTarget = { branch, path };\n                setImportStatus(\n                    \"error\",\n                    `GitHub import failed (${status}): ${message}`\n                );\n            }\n            updateFetchButtonEnabled();\n            return true;\n        }\n\n        return false;\n    }\n\n    function onSelectionChange(): void {\n        updateExportCommitEnabled();\n    }\n\n    function onCollectionsData(): void {\n        ghCollectionsRefreshing = false;\n        updateExportCommitEnabled();\n    }\n\n    function applyRememberPrefFromPlugin(pref: boolean): void {\n        updateRememberPref(pref, false);\n    }\n\n    return {\n        attach,\n        handleMessage,\n        onSelectionChange,\n        onCollectionsData,\n        setRememberPref: applyRememberPrefFromPlugin,\n    };\n}\n", "/**\n * Centralized DOM element references.\n * Populated during DOMContentLoaded.\n */\nexport const uiElements = {\n    logEl: null as HTMLElement | null,\n    rawEl: null as HTMLElement | null,\n\n    exportAllChk: null as HTMLInputElement | null,\n    collectionSelect: null as HTMLSelectElement | null,\n    modeSelect: null as HTMLSelectElement | null,\n\n    fileInput: null as HTMLInputElement | null,\n    importBtn: null as HTMLButtonElement | null,\n    exportBtn: null as HTMLButtonElement | null,\n    exportTypographyBtn: null as HTMLButtonElement | null,\n    exportPickers: null as HTMLElement | null,\n\n    refreshBtn: null as HTMLButtonElement | null,\n\n    shellEl: null as HTMLElement | null,\n    drawerToggleBtn: null as HTMLButtonElement | null,\n    resizeHandleEl: null as HTMLElement | null,\n\n    w3cPreviewEl: null as HTMLElement | null,\n\n    copyRawBtn: null as HTMLButtonElement | null,\n    copyW3cBtn: null as HTMLButtonElement | null,\n    copyLogBtn: null as HTMLButtonElement | null,\n\n    allowHexChk: null as HTMLInputElement | null,\n    styleDictionaryChk: null as HTMLInputElement | null,\n    flatTokensChk: null as HTMLInputElement | null,\n    githubRememberChk: null as HTMLInputElement | null,\n\n    importScopeOverlay: null as HTMLElement | null,\n    importScopeBody: null as HTMLElement | null,\n    importScopeConfirmBtn: null as HTMLButtonElement | null,\n    importScopeCancelBtn: null as HTMLButtonElement | null,\n    importScopeRememberChk: null as HTMLInputElement | null,\n    importScopeMissingEl: null as HTMLElement | null,\n\n    importScopeSummaryEl: null as HTMLElement | null,\n    importScopeSummaryTextEl: null as HTMLElement | null,\n    importScopeClearBtn: null as HTMLButtonElement | null,\n\n    importSkipLogListEl: null as HTMLElement | null,\n    importSkipLogEmptyEl: null as HTMLElement | null,\n};\n\nexport function initDomElements() {\n    if (typeof document === \"undefined\") return;\n\n    uiElements.logEl = document.getElementById(\"log\");\n    uiElements.rawEl = document.getElementById(\"raw\");\n\n    uiElements.exportAllChk = document.getElementById(\n        \"exportAllChk\"\n    ) as HTMLInputElement | null;\n    uiElements.collectionSelect = document.getElementById(\n        \"collectionSelect\"\n    ) as HTMLSelectElement | null;\n    uiElements.modeSelect = document.getElementById(\n        \"modeSelect\"\n    ) as HTMLSelectElement | null;\n\n    uiElements.fileInput = document.getElementById(\n        \"file\"\n    ) as HTMLInputElement | null;\n    uiElements.importBtn = document.getElementById(\n        \"importBtn\"\n    ) as HTMLButtonElement | null;\n    uiElements.exportBtn = document.getElementById(\n        \"exportBtn\"\n    ) as HTMLButtonElement | null;\n    uiElements.exportTypographyBtn = document.getElementById(\n        \"exportTypographyBtn\"\n    ) as HTMLButtonElement | null;\n    uiElements.exportPickers = document.getElementById(\"exportPickers\");\n\n    uiElements.refreshBtn = document.getElementById(\n        \"refreshBtn\"\n    ) as HTMLButtonElement | null;\n\n    uiElements.shellEl = document.querySelector(\".shell\") as HTMLElement | null;\n    uiElements.drawerToggleBtn = document.getElementById(\n        \"drawerToggleBtn\"\n    ) as HTMLButtonElement | null;\n    uiElements.resizeHandleEl = document.getElementById(\"resizeHandle\");\n\n    uiElements.w3cPreviewEl = document.getElementById(\n        \"w3cPreview\"\n    ) as HTMLElement | null;\n\n    uiElements.copyRawBtn = document.getElementById(\n        \"copyRawBtn\"\n    ) as HTMLButtonElement | null;\n    uiElements.copyW3cBtn = document.getElementById(\n        \"copyW3cBtn\"\n    ) as HTMLButtonElement | null;\n    uiElements.copyLogBtn = document.getElementById(\n        \"copyLogBtn\"\n    ) as HTMLButtonElement | null;\n\n    uiElements.allowHexChk = document.getElementById(\n        \"allowHexChk\"\n    ) as HTMLInputElement | null;\n    uiElements.styleDictionaryChk = document.getElementById(\n        \"styleDictionaryChk\"\n    ) as HTMLInputElement | null;\n    uiElements.flatTokensChk = document.getElementById(\n        \"flatTokensChk\"\n    ) as HTMLInputElement | null;\n    uiElements.githubRememberChk = document.getElementById(\n        \"githubRememberChk\"\n    ) as HTMLInputElement | null;\n\n    uiElements.importScopeOverlay =\n        document.getElementById(\"importScopeOverlay\");\n    uiElements.importScopeBody = document.getElementById(\"importScopeBody\");\n    uiElements.importScopeConfirmBtn = document.getElementById(\n        \"importScopeConfirmBtn\"\n    ) as HTMLButtonElement | null;\n    uiElements.importScopeCancelBtn = document.getElementById(\n        \"importScopeCancelBtn\"\n    ) as HTMLButtonElement | null;\n    uiElements.importScopeRememberChk = document.getElementById(\n        \"importScopeRememberChk\"\n    ) as HTMLInputElement | null;\n    uiElements.importScopeMissingEl = document.getElementById(\n        \"importScopeMissingNotice\"\n    );\n\n    uiElements.importScopeSummaryEl =\n        document.getElementById(\"importScopeSummary\");\n    uiElements.importScopeSummaryTextEl = document.getElementById(\n        \"importScopeSummaryText\"\n    );\n    uiElements.importScopeClearBtn = document.getElementById(\n        \"importScopeClearBtn\"\n    ) as HTMLButtonElement | null;\n\n    uiElements.importSkipLogListEl =\n        document.getElementById(\"importSkipLogList\");\n    uiElements.importSkipLogEmptyEl =\n        document.getElementById(\"importSkipLogEmpty\");\n}\n", "import { UiToPlugin } from \"../messages\";\nimport { uiElements } from \"./dom\";\n\n/** Append a message to the log panel and console. */\nexport function log(msg: string): void {\n    const t = new Date().toLocaleTimeString();\n    const line = document.createElement(\"div\");\n    line.textContent = \"[\" + t + \"] \" + msg;\n    if (uiElements.logEl) {\n        uiElements.logEl.appendChild(line);\n        (uiElements.logEl as HTMLElement).scrollTop = (\n            uiElements.logEl as HTMLElement\n        ).scrollHeight;\n    }\n}\n\n/** Send a typed message to the plugin controller. */\nexport function postToPlugin(message: UiToPlugin): void {\n    (\n        parent as unknown as { postMessage: (m: unknown, t: string) => void }\n    ).postMessage({ pluginMessage: message }, \"*\");\n}\n\n/** Format JSON with indentation while collapsing undefined/null gracefully. */\nexport function prettyJson(obj: unknown): string {\n    try {\n        return JSON.stringify(obj, null, 2);\n    } catch {\n        return String(obj);\n    }\n}\n\nexport function copyElText(el: HTMLElement | null, label: string): void {\n    if (!el) return;\n    try {\n        const text = el.textContent ?? \"\";\n        if (\n            navigator.clipboard &&\n            typeof navigator.clipboard.writeText === \"function\"\n        ) {\n            navigator.clipboard\n                .writeText(text)\n                .then(() => {\n                    log(`Copied ${label} to clipboard.`);\n                })\n                .catch(() => {\n                    throw new Error(\"clipboard write failed\");\n                });\n            return;\n        }\n\n        const ta = document.createElement(\"textarea\");\n        ta.value = text;\n        ta.style.position = \"fixed\";\n        ta.style.opacity = \"0\";\n        document.body.appendChild(ta);\n        ta.select();\n        ta.setSelectionRange(0, ta.value.length);\n\n        const ok = document.execCommand(\"copy\");\n        document.body.removeChild(ta);\n\n        if (ok) log(`Copied ${label} to clipboard (${text.length} chars).`);\n        else throw new Error(\"execCommand(copy) returned false\");\n    } catch {\n        log(`Could not copy ${label}.`);\n    }\n}\n", "import {\n    ImportContextOption,\n    ImportLogEntry,\n    ImportPreference,\n} from \"./storage\";\n\nexport type ImportScopeModalState = {\n    options: ImportContextOption[];\n    collections: string[];\n    inputs: HTMLInputElement[];\n    inputsByCollection: Map<string, HTMLInputElement[]>;\n    onConfirm: (selected: string[], remember: boolean) => void;\n};\n\nexport const appState = {\n    importPreference: null as ImportPreference | null,\n    importLogEntries: [] as ImportLogEntry[],\n    importScopeModalState: null as ImportScopeModalState | null,\n    lastImportSelection: [] as string[],\n    systemDarkMode: false,\n\n    // Export state\n    pendingSave: null as {\n        writable: FileSystemWritableFileStream;\n        name: string;\n    } | null,\n\n    // Resize state\n    resizeTracking: null as {\n        pointerId: number;\n        startX: number;\n        startY: number;\n        startWidth: number;\n        startHeight: number;\n    } | null,\n    resizeQueued: null as { width: number; height: number } | null,\n    resizeRaf: 0,\n\n    // Collections state\n    currentCollections: [] as Array<{\n        id: string;\n        name: string;\n        modes: Array<{ id: string; name: string }>;\n        variables: Array<{ id: string; name: string; type: string }>;\n    }>,\n};\n", "import { ImportSummary } from \"../messages\";\n\nexport const IMPORT_PREF_KEY = \"dtcg.importPreference.v1\";\nexport const IMPORT_LOG_KEY = \"dtcg.importLog.v1\";\n\nexport type ImportContextOption = {\n    context: string;\n    collection: string;\n    mode: string;\n};\n\nexport type ImportPreference = { contexts: string[]; updatedAt: number };\n\nexport type ImportLogEntry = {\n    timestamp: number;\n    source?: \"local\" | \"github\";\n    summary: ImportSummary;\n};\n\nexport function normalizeContextList(list: string[]): string[] {\n    const seen = new Set<string>();\n    const out: string[] = [];\n    for (let i = 0; i < list.length; i++) {\n        const raw = String(list[i] ?? \"\").trim();\n        if (!raw) continue;\n        if (seen.has(raw)) continue;\n        seen.add(raw);\n        out.push(raw);\n    }\n    out.sort((a, b) => (a < b ? -1 : a > b ? 1 : 0));\n    return out;\n}\n\nexport function contextsEqual(a: string[], b: string[]): boolean {\n    if (a.length !== b.length) return false;\n    for (let i = 0; i < a.length; i++) if (a[i] !== b[i]) return false;\n    return true;\n}\n\nexport function readImportPreference(): ImportPreference | null {\n    try {\n        const raw = window.localStorage?.getItem(IMPORT_PREF_KEY);\n        if (!raw) return null;\n        const parsed = JSON.parse(raw);\n        if (!parsed || typeof parsed !== \"object\") return null;\n        const ctxs = Array.isArray((parsed as any).contexts)\n            ? normalizeContextList((parsed as any).contexts as string[])\n            : [];\n        const ts =\n            typeof (parsed as any).updatedAt === \"number\"\n                ? Number((parsed as any).updatedAt)\n                : Date.now();\n        if (ctxs.length > 0) return { contexts: ctxs, updatedAt: ts };\n    } catch {\n        /* ignore */\n    }\n    return null;\n}\n\nexport function writeImportPreference(pref: ImportPreference): void {\n    try {\n        window.localStorage?.setItem(IMPORT_PREF_KEY, JSON.stringify(pref));\n    } catch {\n        /* ignore */\n    }\n}\n\nexport function removeImportPreference(): void {\n    try {\n        window.localStorage?.removeItem(IMPORT_PREF_KEY);\n    } catch {\n        /* ignore */\n    }\n}\n\nexport function readImportLog(): ImportLogEntry[] {\n    try {\n        const raw = window.localStorage?.getItem(IMPORT_LOG_KEY);\n        if (!raw) return [];\n        const parsed = JSON.parse(raw);\n        if (!Array.isArray(parsed)) return [];\n        const entries: ImportLogEntry[] = [];\n        for (let i = 0; i < parsed.length; i++) {\n            const entry = parsed[i];\n            if (!entry || typeof entry !== \"object\") continue;\n            const timestamp =\n                typeof (entry as any).timestamp === \"number\"\n                    ? Number((entry as any).timestamp)\n                    : null;\n            const summary = (entry as any).summary as ImportSummary | undefined;\n            const source =\n                (entry as any).source === \"github\"\n                    ? \"github\"\n                    : (entry as any).source === \"local\"\n                    ? \"local\"\n                    : undefined;\n            if (!timestamp || !summary || typeof summary !== \"object\") continue;\n            if (\n                !Array.isArray(summary.appliedContexts) ||\n                !Array.isArray(summary.availableContexts)\n            )\n                continue;\n            if (!Array.isArray(summary.tokensWithRemovedContexts)) {\n                (summary as any).tokensWithRemovedContexts = [];\n            }\n            if (!Array.isArray(summary.skippedContexts)) {\n                (summary as any).skippedContexts = [];\n            }\n            if (!Array.isArray(summary.missingRequestedContexts)) {\n                (summary as any).missingRequestedContexts = [];\n            }\n            if (\n                typeof summary.createdStyles !== \"number\" ||\n                !isFinite(summary.createdStyles)\n            ) {\n                (summary as any).createdStyles = 0;\n            }\n            entries.push({ timestamp, summary, source });\n        }\n        entries.sort((a, b) => a.timestamp - b.timestamp);\n        return entries;\n    } catch {\n        return [];\n    }\n}\n\nexport function writeImportLog(entries: ImportLogEntry[]): void {\n    try {\n        window.localStorage?.setItem(IMPORT_LOG_KEY, JSON.stringify(entries));\n    } catch {\n        /* ignore */\n    }\n}\n", "import { UiToPlugin } from \"../../messages\";\nimport { uiElements } from \"../dom\";\nimport { appState } from \"../state\";\nimport {\n    ImportContextOption,\n    ImportLogEntry,\n    writeImportPreference,\n    removeImportPreference,\n    writeImportLog,\n    normalizeContextList,\n    contextsEqual,\n} from \"../storage\";\nimport { log, postToPlugin } from \"../utils\";\n\nexport function formatContextList(contexts: string[]): string {\n    const normalized = normalizeContextList(contexts);\n    if (normalized.length === 0) return \"All contexts\";\n    const grouped = new Map<string, string[]>();\n    for (let i = 0; i < normalized.length; i++) {\n        const ctx = normalized[i];\n        const slash = ctx.indexOf(\"/\");\n        const collection = slash >= 0 ? ctx.slice(0, slash) : ctx;\n        const mode = slash >= 0 ? ctx.slice(slash + 1) : \"Mode 1\";\n        const coll = collection ? collection : \"Tokens\";\n        const modes = grouped.get(coll) || [];\n        if (!grouped.has(coll)) grouped.set(coll, modes);\n        if (!modes.includes(mode)) modes.push(mode);\n    }\n    const parts: string[] = [];\n    const collections = Array.from(grouped.keys()).sort((a, b) =>\n        a < b ? -1 : a > b ? 1 : 0\n    );\n    for (let i = 0; i < collections.length; i++) {\n        const coll = collections[i];\n        const modes = grouped.get(coll) || [];\n        modes.sort((a, b) => (a < b ? -1 : a > b ? 1 : 0));\n        parts.push(`${coll} (${modes.join(\", \")})`);\n    }\n    return parts.join(\"; \");\n}\n\nexport function renderImportPreferenceSummary(): void {\n    if (\n        !uiElements.importScopeSummaryEl ||\n        !uiElements.importScopeSummaryTextEl\n    )\n        return;\n    const hasPref =\n        !!appState.importPreference &&\n        appState.importPreference.contexts.length > 0;\n    if (uiElements.importScopeClearBtn)\n        uiElements.importScopeClearBtn.disabled = !hasPref;\n    if (!hasPref) {\n        uiElements.importScopeSummaryEl.hidden = true;\n        return;\n    }\n    uiElements.importScopeSummaryEl.hidden = false;\n    const when = new Date(\n        appState.importPreference!.updatedAt\n    ).toLocaleString();\n    uiElements.importScopeSummaryTextEl.textContent = `Remembered import scope (${when}): ${formatContextList(\n        appState.importPreference!.contexts\n    )}.`;\n}\n\nexport function renderImportLog(): void {\n    if (!(uiElements.importSkipLogListEl && uiElements.importSkipLogEmptyEl))\n        return;\n    uiElements.importSkipLogListEl.innerHTML = \"\";\n    if (!appState.importLogEntries || appState.importLogEntries.length === 0) {\n        uiElements.importSkipLogEmptyEl.hidden = false;\n        return;\n    }\n    uiElements.importSkipLogEmptyEl.hidden = true;\n\n    for (let idx = appState.importLogEntries.length - 1; idx >= 0; idx--) {\n        const entry = appState.importLogEntries[idx];\n        const container = document.createElement(\"div\");\n        container.className = \"import-skip-log-entry\";\n\n        const header = document.createElement(\"div\");\n        header.className = \"import-skip-log-entry-header\";\n        const label =\n            entry.source === \"github\" ? \"GitHub import\" : \"Manual import\";\n        header.textContent = `${label} \u2022 ${new Date(\n            entry.timestamp\n        ).toLocaleString()}`;\n        container.appendChild(header);\n\n        const stats = document.createElement(\"div\");\n        stats.className = \"import-skip-log-entry-stats\";\n        const tokensText = `Imported ${entry.summary.importedTokens} of ${entry.summary.totalTokens} tokens.`;\n        const stylesCreated =\n            typeof entry.summary.createdStyles === \"number\"\n                ? entry.summary.createdStyles\n                : undefined;\n        if (typeof stylesCreated === \"number\") {\n            const stylesLabel = stylesCreated === 1 ? \"style\" : \"styles\";\n            stats.textContent = `${tokensText} ${stylesCreated} ${stylesLabel} created.`;\n        } else {\n            stats.textContent = tokensText;\n        }\n        container.appendChild(stats);\n\n        const contextsLine = document.createElement(\"div\");\n        contextsLine.className = \"import-skip-log-entry-contexts\";\n        contextsLine.textContent =\n            \"Applied: \" + formatContextList(entry.summary.appliedContexts);\n        container.appendChild(contextsLine);\n\n        if (entry.summary.skippedContexts.length > 0) {\n            const skippedLine = document.createElement(\"div\");\n            skippedLine.className = \"import-skip-log-entry-contexts\";\n            skippedLine.textContent =\n                \"Skipped modes: \" +\n                formatContextList(\n                    entry.summary.skippedContexts.map((s) => s.context)\n                );\n            container.appendChild(skippedLine);\n        }\n\n        if (entry.summary.missingRequestedContexts.length > 0) {\n            const missingLine = document.createElement(\"div\");\n            missingLine.className = \"import-skip-log-entry-note\";\n            missingLine.textContent =\n                \"Not found in file: \" +\n                formatContextList(entry.summary.missingRequestedContexts);\n            container.appendChild(missingLine);\n        }\n\n        if (entry.summary.selectionFallbackToAll) {\n            const fallbackLine = document.createElement(\"div\");\n            fallbackLine.className = \"import-skip-log-entry-note\";\n            fallbackLine.textContent =\n                \"Requested modes were missing; imported all contexts instead.\";\n            container.appendChild(fallbackLine);\n        }\n\n        if (entry.summary.tokensWithRemovedContexts.length > 0) {\n            const tokenList = document.createElement(\"ul\");\n            tokenList.className = \"import-skip-log-token-list\";\n            const maxTokens = Math.min(\n                entry.summary.tokensWithRemovedContexts.length,\n                10\n            );\n            for (let t = 0; t < maxTokens; t++) {\n                const tok = entry.summary.tokensWithRemovedContexts[t];\n                const li = document.createElement(\"li\");\n                const removedLabel =\n                    tok.removedContexts.length > 0\n                        ? formatContextList(tok.removedContexts)\n                        : \"none\";\n                const keptLabel =\n                    tok.keptContexts.length > 0\n                        ? formatContextList(tok.keptContexts)\n                        : \"\";\n                li.textContent = `${tok.path} \u2014 skipped ${removedLabel}${\n                    keptLabel ? \"; kept \" + keptLabel : \"\"\n                }`;\n                tokenList.appendChild(li);\n            }\n            if (entry.summary.tokensWithRemovedContexts.length > maxTokens) {\n                const more = document.createElement(\"li\");\n                more.textContent = `\u2026and ${\n                    entry.summary.tokensWithRemovedContexts.length - maxTokens\n                } more token(s).`;\n                tokenList.appendChild(more);\n            }\n            container.appendChild(tokenList);\n        }\n\n        if (\n            entry.summary.skippedContexts.length > 0 &&\n            appState.importPreference &&\n            appState.importPreference.contexts.length > 0\n        ) {\n            const tip = document.createElement(\"div\");\n            tip.className = \"import-skip-log-entry-note\";\n            tip.textContent =\n                \"Tip: Clear the remembered import selection to restore skipped modes.\";\n            container.appendChild(tip);\n        }\n\n        uiElements.importSkipLogListEl.appendChild(container);\n    }\n}\n\nexport function addImportLogEntry(entry: ImportLogEntry): void {\n    appState.importLogEntries.push(entry);\n    if (appState.importLogEntries.length > 10) {\n        appState.importLogEntries = appState.importLogEntries.slice(\n            appState.importLogEntries.length - 10\n        );\n    }\n    writeImportLog(appState.importLogEntries);\n    renderImportLog();\n}\n\nexport function setImportPreference(contexts: string[]): void {\n    const normalized = normalizeContextList(contexts);\n    if (normalized.length === 0) {\n        clearImportPreference(false);\n        return;\n    }\n    const same =\n        appState.importPreference &&\n        contextsEqual(appState.importPreference.contexts, normalized);\n    appState.importPreference = { contexts: normalized, updatedAt: Date.now() };\n    writeImportPreference(appState.importPreference);\n    renderImportPreferenceSummary();\n    if (!same) log(\"Remembered import selection for future imports.\");\n}\n\nexport function clearImportPreference(logChange: boolean): void {\n    if (!appState.importPreference) return;\n    appState.importPreference = null;\n    removeImportPreference();\n    renderImportPreferenceSummary();\n    if (logChange)\n        log(\n            \"Cleared remembered import selection. Next import will prompt for modes.\"\n        );\n}\n\nfunction collectContextsFromJson(root: unknown): ImportContextOption[] {\n    const grouped = new Map<string, Set<string>>();\n\n    function visit(node: unknown, path: string[]): void {\n        if (Array.isArray(node)) {\n            for (let i = 0; i < node.length; i++) visit(node[i], path);\n            return;\n        }\n        if (!node || typeof node !== \"object\") return;\n\n        const obj = node as Record<string, unknown>;\n        if (Object.prototype.hasOwnProperty.call(obj, \"$value\")) {\n            const rawCollection = path[0] ? String(path[0]).trim() : \"Tokens\";\n            let mode = \"Mode 1\";\n            try {\n                const ext = obj[\"$extensions\"];\n                if (ext && typeof ext === \"object\") {\n                    const cf = (ext as any)[\"com.figma\"];\n                    if (\n                        cf &&\n                        typeof cf === \"object\" &&\n                        typeof (cf as any).modeName === \"string\"\n                    ) {\n                        const candidate = String((cf as any).modeName).trim();\n                        if (candidate) mode = candidate;\n                    }\n                }\n            } catch {\n                /* ignore */\n            }\n            const collection = rawCollection ? rawCollection : \"Tokens\";\n            const set = grouped.get(collection) || new Set<string>();\n            if (!grouped.has(collection)) grouped.set(collection, set);\n            set.add(mode);\n            return;\n        }\n\n        for (const key in obj) {\n            if (!Object.prototype.hasOwnProperty.call(obj, key)) continue;\n            if (key.startsWith(\"$\")) continue;\n            visit((obj as any)[key], path.concat(String(key)));\n        }\n    }\n\n    visit(root, []);\n\n    const options: ImportContextOption[] = [];\n    const collections = Array.from(grouped.keys()).sort((a, b) =>\n        a < b ? -1 : a > b ? 1 : 0\n    );\n    for (let i = 0; i < collections.length; i++) {\n        const collection = collections[i];\n        const modes = Array.from(grouped.get(collection) || []).sort((a, b) =>\n            a < b ? -1 : a > b ? 1 : 0\n        );\n        for (let j = 0; j < modes.length; j++) {\n            const mode = modes[j];\n            options.push({\n                context: `${collection}/${mode}`,\n                collection,\n                mode,\n            });\n        }\n    }\n    return options;\n}\n\nexport function updateImportScopeConfirmState(): void {\n    if (!appState.importScopeModalState) return;\n    const state = appState.importScopeModalState;\n    let allCollectionsSelected = true;\n    for (let i = 0; i < state.collections.length; i++) {\n        const collection = state.collections[i];\n        const inputs = state.inputsByCollection.get(collection) || [];\n        if (!inputs.some((input) => input.checked)) {\n            allCollectionsSelected = false;\n            break;\n        }\n    }\n    if (uiElements.importScopeConfirmBtn) {\n        uiElements.importScopeConfirmBtn.disabled = !allCollectionsSelected;\n        const label =\n            state.collections.length > 1\n                ? \"Import selected modes\"\n                : \"Import selected mode\";\n        uiElements.importScopeConfirmBtn.textContent = label;\n    }\n}\n\nlet importScopeKeyListenerAttached = false;\n\nexport function handleImportScopeKeydown(ev: KeyboardEvent): void {\n    if (ev.key === \"Escape\") {\n        ev.preventDefault();\n        closeImportScopeModal();\n    }\n}\n\nexport function openImportScopeModal(opts: {\n    options: ImportContextOption[];\n    initialSelection: string[];\n    rememberInitially: boolean;\n    missingPreferred: string[];\n    onConfirm: (selected: string[], remember: boolean) => void;\n}): void {\n    if (\n        !uiElements.importScopeOverlay ||\n        !uiElements.importScopeBody ||\n        !uiElements.importScopeConfirmBtn ||\n        !uiElements.importScopeCancelBtn\n    ) {\n        opts.onConfirm(opts.initialSelection, opts.rememberInitially);\n        return;\n    }\n\n    uiElements.importScopeBody.innerHTML = \"\";\n\n    const grouped = new Map<string, ImportContextOption[]>();\n    for (let i = 0; i < opts.options.length; i++) {\n        const option = opts.options[i];\n        const list = grouped.get(option.collection) || [];\n        if (!grouped.has(option.collection))\n            grouped.set(option.collection, list);\n        list.push(option);\n    }\n\n    const collections = Array.from(grouped.keys()).sort((a, b) =>\n        a < b ? -1 : a > b ? 1 : 0\n    );\n    appState.importScopeModalState = {\n        options: opts.options,\n        collections,\n        inputs: [],\n        inputsByCollection: new Map(),\n        onConfirm: opts.onConfirm,\n    };\n\n    const initialSelectionsByCollection = new Map<string, string>();\n    for (let i = 0; i < opts.initialSelection.length; i++) {\n        const ctx = opts.initialSelection[i];\n        const match = opts.options.find((opt) => opt.context === ctx);\n        if (match)\n            initialSelectionsByCollection.set(match.collection, match.context);\n    }\n\n    for (let i = 0; i < collections.length; i++) {\n        const collection = collections[i];\n        const groupEl = document.createElement(\"div\");\n        groupEl.className = \"import-scope-group\";\n        const heading = document.createElement(\"h3\");\n        heading.textContent = collection;\n        groupEl.appendChild(heading);\n\n        const modes = (grouped.get(collection) || []).sort((a, b) =>\n            a.mode < b.mode ? -1 : a.mode > b.mode ? 1 : 0\n        );\n        const defaultContext =\n            initialSelectionsByCollection.get(collection) ||\n            modes[0]?.context ||\n            null;\n        const radioName = `importScopeMode_${i}`;\n        for (let j = 0; j < modes.length; j++) {\n            const opt = modes[j];\n            const label = document.createElement(\"label\");\n            label.className = \"import-scope-mode\";\n            const radio = document.createElement(\"input\");\n            radio.type = \"radio\";\n            radio.name = radioName;\n            radio.value = opt.context;\n            radio.checked = defaultContext === opt.context;\n            radio.addEventListener(\"change\", updateImportScopeConfirmState);\n            appState.importScopeModalState.inputs.push(radio);\n            const list =\n                appState.importScopeModalState.inputsByCollection.get(\n                    collection\n                ) || [];\n            if (\n                !appState.importScopeModalState.inputsByCollection.has(\n                    collection\n                )\n            ) {\n                appState.importScopeModalState.inputsByCollection.set(\n                    collection,\n                    list\n                );\n            }\n            list.push(radio);\n\n            const span = document.createElement(\"span\");\n            span.textContent = opt.mode;\n\n            label.appendChild(radio);\n            label.appendChild(span);\n            groupEl.appendChild(label);\n        }\n\n        uiElements.importScopeBody.appendChild(groupEl);\n    }\n\n    if (uiElements.importScopeRememberChk)\n        uiElements.importScopeRememberChk.checked = opts.rememberInitially;\n    if (uiElements.importScopeMissingEl) {\n        if (opts.missingPreferred.length > 0) {\n            uiElements.importScopeMissingEl.hidden = false;\n            uiElements.importScopeMissingEl.textContent =\n                \"Previously remembered modes not present in this file: \" +\n                formatContextList(opts.missingPreferred);\n        } else {\n            uiElements.importScopeMissingEl.hidden = true;\n            uiElements.importScopeMissingEl.textContent = \"\";\n        }\n    }\n\n    updateImportScopeConfirmState();\n\n    uiElements.importScopeOverlay.hidden = false;\n    uiElements.importScopeOverlay.classList.add(\"is-open\");\n    uiElements.importScopeOverlay.setAttribute(\"aria-hidden\", \"false\");\n    if (!importScopeKeyListenerAttached) {\n        window.addEventListener(\"keydown\", handleImportScopeKeydown, true);\n        importScopeKeyListenerAttached = true;\n    }\n    if (uiElements.importScopeConfirmBtn)\n        uiElements.importScopeConfirmBtn.focus();\n}\n\nexport function closeImportScopeModal(): void {\n    if (!uiElements.importScopeOverlay) return;\n    uiElements.importScopeOverlay.classList.remove(\"is-open\");\n    uiElements.importScopeOverlay.hidden = true;\n    uiElements.importScopeOverlay.setAttribute(\"aria-hidden\", \"true\");\n    if (importScopeKeyListenerAttached) {\n        window.removeEventListener(\"keydown\", handleImportScopeKeydown, true);\n        importScopeKeyListenerAttached = false;\n    }\n    appState.importScopeModalState = null;\n}\n\nexport function performImport(\n    json: unknown,\n    allowHex: boolean,\n    contexts: string[]\n): void {\n    const normalized = normalizeContextList(contexts);\n    const payload: UiToPlugin =\n        normalized.length > 0\n            ? {\n                  type: \"IMPORT_DTCG\",\n                  payload: {\n                      json,\n                      allowHexStrings: allowHex,\n                      contexts: normalized,\n                  },\n              }\n            : {\n                  type: \"IMPORT_DTCG\",\n                  payload: { json, allowHexStrings: allowHex },\n              };\n    postToPlugin(payload);\n    appState.lastImportSelection = normalized.slice();\n    const label =\n        normalized.length > 0 ? formatContextList(normalized) : \"all contexts\";\n    log(`Import requested (${label}).`);\n}\n\nexport function startImportFlow(json: unknown, allowHex: boolean): void {\n    const options = collectContextsFromJson(json);\n    if (options.length === 0) {\n        performImport(json, allowHex, []);\n        return;\n    }\n\n    const grouped = new Map<string, ImportContextOption[]>();\n    for (let i = 0; i < options.length; i++) {\n        const option = options[i];\n        const list = grouped.get(option.collection) || [];\n        if (!grouped.has(option.collection))\n            grouped.set(option.collection, list);\n        list.push(option);\n    }\n\n    const availableSet = new Set(options.map((opt) => opt.context));\n    const missingPreferred: string[] = [];\n    let rememberInitially = false;\n    const initialSelectionsByCollection = new Map<string, string>();\n\n    if (\n        appState.importPreference &&\n        appState.importPreference.contexts.length > 0\n    ) {\n        for (let i = 0; i < appState.importPreference.contexts.length; i++) {\n            const ctx = appState.importPreference.contexts[i];\n            if (availableSet.has(ctx)) {\n                const match = options.find((opt) => opt.context === ctx);\n                if (match) {\n                    initialSelectionsByCollection.set(\n                        match.collection,\n                        match.context\n                    );\n                    rememberInitially = true;\n                }\n            } else {\n                missingPreferred.push(ctx);\n            }\n        }\n    }\n\n    const collections = Array.from(grouped.keys()).sort((a, b) =>\n        a < b ? -1 : a > b ? 1 : 0\n    );\n    for (let i = 0; i < collections.length; i++) {\n        const collection = collections[i];\n        if (!initialSelectionsByCollection.has(collection)) {\n            const modes = (grouped.get(collection) || []).sort((a, b) =>\n                a.mode < b.mode ? -1 : a.mode > b.mode ? 1 : 0\n            );\n            if (modes.length > 0)\n                initialSelectionsByCollection.set(collection, modes[0].context);\n        }\n    }\n\n    const initialSelection = collections\n        .map((collection) => initialSelectionsByCollection.get(collection))\n        .filter((ctx): ctx is string => typeof ctx === \"string\");\n\n    const requiresChoice = collections.some((collection) => {\n        const list = grouped.get(collection) || [];\n        return list.length > 1;\n    });\n\n    if (!requiresChoice) {\n        performImport(json, allowHex, initialSelection);\n        return;\n    }\n\n    openImportScopeModal({\n        options,\n        initialSelection,\n        rememberInitially,\n        missingPreferred,\n        onConfirm: (selected, remember) => {\n            if (remember) setImportPreference(selected);\n            else if (appState.importPreference) clearImportPreference(true);\n            performImport(json, allowHex, selected);\n        },\n    });\n}\n\nexport function getPreferredImportContexts(): string[] {\n    if (\n        appState.importPreference &&\n        appState.importPreference.contexts.length > 0\n    )\n        return appState.importPreference.contexts.slice();\n    if (appState.lastImportSelection.length > 0)\n        return appState.lastImportSelection.slice();\n    return [];\n}\n", "import { appState } from \"../state\";\n\nexport function prettyExportName(original: string | undefined | null): string {\n    const name =\n        original && typeof original === \"string\" ? original : \"tokens.json\";\n    const m = name.match(/^(.*)_mode=(.*)\\.tokens\\.json$/);\n    if (m) {\n        const collection = m[1].trim();\n        const mode = m[2].trim();\n        return `${collection} - ${mode}.json`;\n    }\n    return name.endsWith(\".json\") ? name : name + \".json\";\n}\n\nexport function supportsFilePicker(): boolean {\n    return typeof (window as any).showSaveFilePicker === \"function\";\n}\n\nexport async function beginPendingSave(\n    suggestedName: string\n): Promise<boolean> {\n    try {\n        if (!supportsFilePicker()) return false;\n        const handle = await (window as any).showSaveFilePicker({\n            suggestedName,\n            types: [\n                {\n                    description: \"JSON\",\n                    accept: { \"application/json\": [\".json\"] },\n                },\n            ],\n        });\n        const writable: FileSystemWritableFileStream =\n            await handle.createWritable();\n        appState.pendingSave = { writable, name: suggestedName };\n        return true;\n    } catch {\n        appState.pendingSave = null;\n        return false;\n    }\n}\n\nexport async function finishPendingSave(text: string): Promise<boolean> {\n    if (!appState.pendingSave) return false;\n    try {\n        await appState.pendingSave.writable.write(\n            new Blob([text], { type: \"application/json\" })\n        );\n        await appState.pendingSave.writable.close();\n        return true;\n    } catch {\n        try {\n            await appState.pendingSave.writable.close();\n        } catch {\n            /* ignore */\n        }\n        return false;\n    } finally {\n        appState.pendingSave = null;\n    }\n}\n\nexport function triggerJsonDownload(filename: string, text: string): void {\n    try {\n        const blob = new Blob([text], { type: \"application/json\" });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement(\"a\");\n        a.href = url;\n        a.download = filename;\n        a.style.position = \"absolute\";\n        a.style.left = \"-9999px\";\n        document.body.appendChild(a);\n        a.click();\n        setTimeout(() => {\n            URL.revokeObjectURL(url);\n            a.remove();\n        }, 0);\n    } catch {\n        /* ignore */\n    }\n}\n", "import { appState } from \"../state\";\nimport { uiElements } from \"../dom\";\nimport { postToPlugin } from \"../utils\";\n\nexport function postResize(width: number, height: number): void {\n    const w = Math.max(720, Math.min(1600, Math.floor(width)));\n    const h = Math.max(420, Math.min(1200, Math.floor(height)));\n    postToPlugin({ type: \"UI_RESIZE\", payload: { width: w, height: h } });\n}\n\nexport function queueResize(width: number, height: number): void {\n    appState.resizeQueued = { width, height };\n    if (appState.resizeRaf !== 0) return;\n    appState.resizeRaf = window.requestAnimationFrame(() => {\n        appState.resizeRaf = 0;\n        if (!appState.resizeQueued) return;\n        postResize(appState.resizeQueued.width, appState.resizeQueued.height);\n        appState.resizeQueued = null;\n    });\n}\n\nfunction applyResizeDelta(ev: PointerEvent): void {\n    if (\n        !appState.resizeTracking ||\n        ev.pointerId !== appState.resizeTracking.pointerId\n    )\n        return;\n    const dx = ev.clientX - appState.resizeTracking.startX;\n    const dy = ev.clientY - appState.resizeTracking.startY;\n    const nextW = appState.resizeTracking.startWidth + dx;\n    const nextH = appState.resizeTracking.startHeight + dy;\n    queueResize(nextW, nextH);\n    ev.preventDefault();\n}\n\nexport function endResize(ev: PointerEvent): void {\n    if (\n        !appState.resizeTracking ||\n        ev.pointerId !== appState.resizeTracking.pointerId\n    )\n        return;\n    applyResizeDelta(ev);\n    window.removeEventListener(\"pointermove\", handleResizeMove, true);\n    window.removeEventListener(\"pointerup\", endResize, true);\n    window.removeEventListener(\"pointercancel\", cancelResize, true);\n    if (uiElements.resizeHandleEl) {\n        try {\n            uiElements.resizeHandleEl.releasePointerCapture(\n                appState.resizeTracking.pointerId\n            );\n        } catch {\n            /* ignore */\n        }\n    }\n    appState.resizeTracking = null;\n}\n\nexport function cancelResize(ev: PointerEvent): void {\n    if (\n        !appState.resizeTracking ||\n        ev.pointerId !== appState.resizeTracking.pointerId\n    )\n        return;\n    window.removeEventListener(\"pointermove\", handleResizeMove, true);\n    window.removeEventListener(\"pointerup\", endResize, true);\n    window.removeEventListener(\"pointercancel\", cancelResize, true);\n    if (uiElements.resizeHandleEl) {\n        try {\n            uiElements.resizeHandleEl.releasePointerCapture(\n                appState.resizeTracking.pointerId\n            );\n        } catch {\n            /* ignore */\n        }\n    }\n    appState.resizeTracking = null;\n}\n\nexport function handleResizeMove(ev: PointerEvent): void {\n    applyResizeDelta(ev);\n}\n\nexport function autoFitOnce(): void {\n    if (typeof document === \"undefined\") return;\n    const contentW = Math.max(\n        document.documentElement.scrollWidth,\n        document.body ? document.body.scrollWidth : 0\n    );\n    const contentH = Math.max(\n        document.documentElement.scrollHeight,\n        document.body ? document.body.scrollHeight : 0\n    );\n    const vw = window.innerWidth;\n    const vh = window.innerHeight;\n    const needsW = contentW > vw ? contentW : vw;\n    const needsH = contentH > vh ? contentH : vh;\n    if (needsW > vw || needsH > vh) postResize(needsW, needsH);\n}\n", "// src/app/ui.ts\n// In-panel UI logic for the plugin: dom wiring, GitHub workflows, and export helpers.\n// - Mirrors plugin state via postMessage so the UI can function offline\n// - Provides guarded DOM helpers to survive partial renders or optional features\n\nimport type { PluginToUi } from \"./messages\";\nimport \"./ui.css\";\nimport { createGithubUi } from \"./github/ui\";\n\n/* -------------------------------------------------------\n * Globals (assigned after DOMContentLoaded)\n * ----------------------------------------------------- */\nimport { uiElements, initDomElements } from \"./ui/dom\";\nimport { log, postToPlugin, prettyJson, copyElText } from \"./ui/utils\";\nimport { appState } from \"./ui/state\";\nimport { readImportPreference, readImportLog } from \"./ui/storage\";\nimport {\n    renderImportPreferenceSummary,\n    renderImportLog,\n    addImportLogEntry,\n    clearImportPreference,\n    closeImportScopeModal,\n    startImportFlow,\n    getPreferredImportContexts,\n} from \"./ui/features/import\";\nimport {\n    prettyExportName,\n    beginPendingSave,\n    finishPendingSave,\n    triggerJsonDownload,\n} from \"./ui/features/export\";\nimport {\n    endResize,\n    cancelResize,\n    handleResizeMove,\n    autoFitOnce,\n} from \"./ui/features/resize\";\n\n/* -------------------------------------------------------\n * Shared helpers\n * ----------------------------------------------------- */\n\nfunction applyTheme(): void {\n    const effective = appState.systemDarkMode ? \"dark\" : \"light\";\n    if (effective === \"light\") {\n        document.documentElement.setAttribute(\"data-theme\", \"light\");\n    } else {\n        document.documentElement.removeAttribute(\"data-theme\");\n    }\n}\n\n/* -------------------------------------------------------\n * Collections / logging\n * ----------------------------------------------------- */\n\nconst githubUi = createGithubUi({\n    postToPlugin: (message) => postToPlugin(message),\n    log: (message) => log(message),\n    getLogElement: () => uiElements.logEl,\n    getCollectionSelect: () => uiElements.collectionSelect,\n    getModeSelect: () => uiElements.modeSelect,\n    getAllowHexCheckbox: () => uiElements.allowHexChk,\n    getStyleDictionaryCheckbox: () => uiElements.styleDictionaryChk,\n    getFlatTokensCheckbox: () => uiElements.flatTokensChk,\n    getImportContexts: () => getPreferredImportContexts(),\n});\n\n/** Remove every option from a select without replacing the node. */\nfunction clearSelect(sel: HTMLSelectElement): void {\n    while (sel.options.length > 0) sel.remove(0);\n}\n\n/** Update button/checkbox disabled states based on current selections. */\nfunction setDisabledStates(): void {\n    if (uiElements.importBtn && uiElements.fileInput) {\n        const hasFile = !!(\n            uiElements.fileInput.files && uiElements.fileInput.files.length > 0\n        );\n        uiElements.importBtn.disabled = !hasFile;\n    }\n\n    if (\n        uiElements.exportBtn &&\n        uiElements.exportAllChk &&\n        uiElements.collectionSelect &&\n        uiElements.modeSelect &&\n        uiElements.exportPickers\n    ) {\n        const exportAll = !!uiElements.exportAllChk.checked;\n        if (exportAll) {\n            uiElements.exportBtn.disabled = false;\n            (uiElements.exportPickers as HTMLElement).style.opacity = \"0.5\";\n        } else {\n            (uiElements.exportPickers as HTMLElement).style.opacity = \"1\";\n            const hasSelection =\n                !!uiElements.collectionSelect.value &&\n                !!uiElements.modeSelect.value;\n            uiElements.exportBtn.disabled = !hasSelection;\n        }\n    }\n\n    if (uiElements.exportTypographyBtn) {\n        uiElements.exportTypographyBtn.disabled = false;\n    }\n}\n\n/** Render the collections/modes dropdowns from plugin-provided data. */\nfunction populateCollections(data: {\n    collections: Array<{\n        id: string;\n        name: string;\n        modes: Array<{ id: string; name: string }>;\n        variables: Array<{ id: string; name: string; type: string }>;\n    }>;\n}): void {\n    appState.currentCollections = data.collections;\n    if (!(uiElements.collectionSelect && uiElements.modeSelect)) return;\n\n    clearSelect(uiElements.collectionSelect);\n    for (let i = 0; i < data.collections.length; i++) {\n        const c = data.collections[i];\n        const opt = document.createElement(\"option\");\n        opt.value = c.name;\n        opt.textContent = c.name;\n        uiElements.collectionSelect.appendChild(opt);\n    }\n    onCollectionChange();\n}\n\n/** Update mode selection and preview when the collection dropdown changes. */\nfunction onCollectionChange(): void {\n    if (!(uiElements.collectionSelect && uiElements.modeSelect)) return;\n\n    const selected = uiElements.collectionSelect.value;\n    clearSelect(uiElements.modeSelect);\n\n    let firstModeSet = false;\n    for (let i = 0; i < appState.currentCollections.length; i++) {\n        const c = appState.currentCollections[i];\n        if (c.name === selected) {\n            for (let j = 0; j < c.modes.length; j++) {\n                const m = c.modes[j];\n                const opt = document.createElement(\"option\");\n                opt.value = m.name;\n                opt.textContent = m.name;\n                uiElements.modeSelect.appendChild(opt);\n            }\n            // ensure a default mode is selected for enablement logic\n            if (\n                uiElements.modeSelect.options.length > 0 &&\n                uiElements.modeSelect.selectedIndex === -1\n            ) {\n                uiElements.modeSelect.selectedIndex = 0;\n                firstModeSet = true;\n            }\n            break;\n        }\n    }\n\n    setDisabledStates();\n    githubUi.onSelectionChange();\n\n    // If we auto-set a mode (firstModeSet), update the preview as well\n    if (firstModeSet) requestPreviewForCurrent();\n}\n\n/** Restore the most recently used collection/mode pair. */\nfunction applyLastSelection(\n    last: { collection: string; mode: string } | null\n): void {\n    if (!last || !(uiElements.collectionSelect && uiElements.modeSelect))\n        return;\n\n    let found = false;\n    for (let i = 0; i < uiElements.collectionSelect.options.length; i++) {\n        if (uiElements.collectionSelect.options[i].value === last.collection) {\n            uiElements.collectionSelect.selectedIndex = i;\n            found = true;\n            break;\n        }\n    }\n\n    onCollectionChange();\n\n    if (found) {\n        for (let j = 0; j < uiElements.modeSelect.options.length; j++) {\n            if (uiElements.modeSelect.options[j].value === last.mode) {\n                uiElements.modeSelect.selectedIndex = j;\n                break;\n            }\n        }\n    }\n\n    setDisabledStates();\n}\n\n/** Ask the plugin for a preview of the currently selected token scope. */\nfunction requestPreviewForCurrent(): void {\n    if (!(uiElements.collectionSelect && uiElements.modeSelect)) return;\n    const collection = uiElements.collectionSelect.value || \"\";\n    const mode = uiElements.modeSelect.value || \"\";\n    if (!collection || !mode) {\n        if (uiElements.w3cPreviewEl)\n            uiElements.w3cPreviewEl.textContent =\n                \"{ /* select a collection & mode to preview */ }\";\n        return;\n    }\n    const styleDictionary = !!(\n        uiElements.styleDictionaryChk && uiElements.styleDictionaryChk.checked\n    );\n    const flatTokens = !!(\n        uiElements.flatTokensChk && uiElements.flatTokensChk.checked\n    );\n    postToPlugin({\n        type: \"PREVIEW_REQUEST\",\n        payload: { collection, mode, styleDictionary, flatTokens },\n    });\n}\n\n/* -------------------------------------------------------\n * GitHub: Branch helpers (Variant 4)\n * ----------------------------------------------------- */\n/** Toggle the branch select and associated placeholders. */\n\n/* -------------------------------------------------------\n * Message pump\n * ----------------------------------------------------- */\nwindow.addEventListener(\"message\", async (event: MessageEvent) => {\n    const data: unknown = (event as unknown as { data?: unknown }).data;\n    if (!data || typeof data !== \"object\") return;\n\n    let msg: PluginToUi | any | null = null;\n    if (\n        (data as any).pluginMessage &&\n        typeof (data as any).pluginMessage === \"object\"\n    ) {\n        const maybe = (data as any).pluginMessage;\n        if (maybe && typeof maybe.type === \"string\") msg = maybe;\n    }\n    if (!msg) return;\n\n    // Keep generic INFO/ERROR logs visible\n    if (msg.type === \"ERROR\") {\n        log(\"ERROR: \" + (msg.payload?.message ?? \"\"));\n        return;\n    }\n    if (msg.type === \"INFO\") {\n        log(msg.payload?.message ?? \"\");\n        return;\n    }\n\n    if (msg.type === \"IMPORT_SUMMARY\") {\n        const summary = msg.payload.summary;\n        if (summary && Array.isArray(summary.appliedContexts)) {\n            appState.lastImportSelection = summary.appliedContexts.slice();\n        } else {\n            appState.lastImportSelection = [];\n        }\n        addImportLogEntry({\n            timestamp: msg.payload.timestamp,\n            source: msg.payload.source,\n            summary,\n        });\n        renderImportPreferenceSummary();\n        return;\n    }\n\n    if (githubUi.handleMessage(msg)) return;\n\n    if (msg.type === \"EXPORT_RESULT\") {\n        const files = Array.isArray(msg.payload?.files)\n            ? msg.payload.files\n            : [];\n        if (files.length === 0) {\n            log(\"Nothing to export.\");\n            return;\n        }\n\n        if (appState.pendingSave && files.length === 1) {\n            const only = files[0];\n            const fname = prettyExportName(only?.name);\n            const text = prettyJson(only?.json);\n\n            const ok = await finishPendingSave(text);\n            if (ok) {\n                log(\"Saved \" + fname + \" via file picker.\");\n                const div = document.createElement(\"div\");\n                const link = document.createElement(\"a\");\n                link.href = \"#\";\n                link.textContent = \"Download \" + fname + \" again\";\n                link.addEventListener(\"click\", (e) => {\n                    e.preventDefault();\n                    triggerJsonDownload(fname, text);\n                });\n                if (uiElements.logEl) {\n                    div.appendChild(link);\n                    uiElements.logEl.appendChild(div);\n                    (uiElements.logEl as HTMLElement).scrollTop = (\n                        uiElements.logEl as HTMLElement\n                    ).scrollHeight;\n                }\n                log(\"Export ready.\");\n                return;\n            }\n            log(\n                \"Could not write via file picker; falling back to download links.\"\n            );\n        }\n\n        setDrawerOpen(true);\n        for (let k = 0; k < files.length; k++) {\n            const f = files[k];\n            const fname = prettyExportName(f?.name);\n            const text = prettyJson(f?.json);\n            triggerJsonDownload(fname, text);\n\n            const div = document.createElement(\"div\");\n            const link = document.createElement(\"a\");\n            link.href = \"#\";\n            link.textContent = \"Download \" + fname;\n            link.addEventListener(\"click\", (e) => {\n                e.preventDefault();\n                triggerJsonDownload(fname, text);\n            });\n            if (uiElements.logEl) {\n                div.appendChild(link);\n                uiElements.logEl.appendChild(div);\n                (uiElements.logEl as HTMLElement).scrollTop = (\n                    uiElements.logEl as HTMLElement\n                ).scrollHeight;\n            }\n        }\n        log(\"Export ready.\");\n        return;\n    }\n\n    if (msg.type === \"W3C_PREVIEW\") {\n        const displayName = prettyExportName(msg.payload.name);\n        const header = `/* ${displayName} */\\n`;\n        if (uiElements.w3cPreviewEl)\n            uiElements.w3cPreviewEl.textContent =\n                header + prettyJson(msg.payload.json);\n        return;\n    }\n\n    if (msg.type === \"COLLECTIONS_DATA\") {\n        githubUi.onCollectionsData();\n        populateCollections({ collections: msg.payload.collections });\n        if (uiElements.exportAllChk)\n            uiElements.exportAllChk.checked = !!msg.payload.exportAllPref;\n        if (\n            uiElements.styleDictionaryChk &&\n            typeof msg.payload.styleDictionaryPref === \"boolean\"\n        ) {\n            uiElements.styleDictionaryChk.checked =\n                !!msg.payload.styleDictionaryPref;\n        }\n        if (\n            uiElements.flatTokensChk &&\n            typeof msg.payload.flatTokensPref === \"boolean\"\n        ) {\n            uiElements.flatTokensChk.checked = !!msg.payload.flatTokensPref;\n        }\n        if (\n            uiElements.allowHexChk &&\n            typeof msg.payload.allowHexPref === \"boolean\"\n        ) {\n            uiElements.allowHexChk.checked = !!msg.payload.allowHexPref;\n        }\n        if (typeof msg.payload.githubRememberPref === \"boolean\") {\n            if (uiElements.githubRememberChk)\n                uiElements.githubRememberChk.checked =\n                    msg.payload.githubRememberPref;\n        }\n        const last = (msg.payload as any).last as {\n            collection: string;\n            mode: string;\n        } | null;\n        applyLastSelection(last);\n        setDisabledStates();\n        requestPreviewForCurrent();\n        return;\n    }\n\n    if (msg.type === \"RAW_COLLECTIONS_TEXT\") {\n        if (uiElements.rawEl) uiElements.rawEl.textContent = msg.payload.text;\n        return;\n    }\n});\n\n/* -------------------------------------------------------\n * DOM wiring (runs when document exists)\n * ----------------------------------------------------- */\n\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n    if (typeof document === \"undefined\") return;\n\n    initDomElements();\n\n    // System theme listener\n    const mediaQuery = window.matchMedia(\"(prefers-color-scheme: dark)\");\n    appState.systemDarkMode = mediaQuery.matches;\n    mediaQuery.addEventListener(\"change\", (e) => {\n        appState.systemDarkMode = e.matches;\n        applyTheme();\n    });\n    // Initial apply (defaults to auto/system until we get prefs)\n    applyTheme();\n\n    appState.importPreference = readImportPreference();\n    appState.importLogEntries = readImportLog();\n    renderImportPreferenceSummary();\n    renderImportLog();\n\n    if (uiElements.importScopeClearBtn) {\n        uiElements.importScopeClearBtn.addEventListener(\"click\", () =>\n            clearImportPreference(true)\n        );\n    }\n\n    if (uiElements.importScopeConfirmBtn) {\n        uiElements.importScopeConfirmBtn.addEventListener(\"click\", () => {\n            if (!appState.importScopeModalState) {\n                closeImportScopeModal();\n                return;\n            }\n            const state = appState.importScopeModalState;\n            const selections: string[] = [];\n            for (let i = 0; i < state.collections.length; i++) {\n                const collection = state.collections[i];\n                const inputs = state.inputsByCollection.get(collection) || [];\n                const selected = inputs.find((input) => input.checked);\n                if (!selected) return;\n                selections.push(selected.value);\n            }\n            const remember = uiElements.importScopeRememberChk\n                ? !!uiElements.importScopeRememberChk.checked\n                : false;\n            closeImportScopeModal();\n            state.onConfirm(selections, remember);\n        });\n    }\n\n    if (uiElements.importScopeCancelBtn) {\n        uiElements.importScopeCancelBtn.addEventListener(\"click\", () =>\n            closeImportScopeModal()\n        );\n    }\n\n    if (uiElements.importScopeOverlay) {\n        uiElements.importScopeOverlay.addEventListener(\"click\", (ev) => {\n            if (ev.target === uiElements.importScopeOverlay)\n                closeImportScopeModal();\n        });\n    }\n\n    if (uiElements.resizeHandleEl) {\n        uiElements.resizeHandleEl.addEventListener(\n            \"pointerdown\",\n            (event: PointerEvent) => {\n                if (event.button !== 0 && event.pointerType === \"mouse\") return;\n                if (appState.resizeTracking) return;\n                event.preventDefault();\n                appState.resizeTracking = {\n                    pointerId: event.pointerId,\n                    startX: event.clientX,\n                    startY: event.clientY,\n                    startWidth: window.innerWidth,\n                    startHeight: window.innerHeight,\n                };\n                try {\n                    uiElements.resizeHandleEl!.setPointerCapture(\n                        event.pointerId\n                    );\n                } catch {\n                    /* ignore */\n                }\n                window.addEventListener(\"pointermove\", handleResizeMove, true);\n                window.addEventListener(\"pointerup\", endResize, true);\n                window.addEventListener(\"pointercancel\", cancelResize, true);\n            }\n        );\n    }\n\n    githubUi.attach({ document, window });\n\n    if (uiElements.fileInput)\n        uiElements.fileInput.addEventListener(\"change\", setDisabledStates);\n\n    if (uiElements.exportAllChk) {\n        uiElements.exportAllChk.addEventListener(\"change\", () => {\n            setDisabledStates();\n            postToPlugin({\n                type: \"SAVE_PREFS\",\n                payload: { exportAll: !!uiElements.exportAllChk!.checked },\n            });\n            githubUi.onSelectionChange();\n        });\n    }\n\n    if (uiElements.styleDictionaryChk) {\n        uiElements.styleDictionaryChk.addEventListener(\"change\", () => {\n            postToPlugin({\n                type: \"SAVE_PREFS\",\n                payload: {\n                    styleDictionary: !!uiElements.styleDictionaryChk!.checked,\n                },\n            });\n            requestPreviewForCurrent();\n            githubUi.onSelectionChange();\n        });\n    }\n\n    if (uiElements.flatTokensChk) {\n        uiElements.flatTokensChk.addEventListener(\"change\", () => {\n            postToPlugin({\n                type: \"SAVE_PREFS\",\n                payload: { flatTokens: !!uiElements.flatTokensChk!.checked },\n            });\n            requestPreviewForCurrent();\n            githubUi.onSelectionChange();\n        });\n    }\n\n    if (uiElements.githubRememberChk) {\n        uiElements.githubRememberChk.addEventListener(\"change\", () => {\n            postToPlugin({\n                type: \"SAVE_PREFS\",\n                payload: {\n                    githubRememberToken:\n                        !!uiElements.githubRememberChk!.checked,\n                },\n            });\n        });\n    }\n\n    if (uiElements.refreshBtn) {\n        uiElements.refreshBtn.addEventListener(\"click\", () => {\n            postToPlugin({ type: \"FETCH_COLLECTIONS\" });\n        });\n    }\n\n    if (uiElements.importBtn && uiElements.fileInput) {\n        uiElements.importBtn.addEventListener(\"click\", () => {\n            if (\n                !uiElements.fileInput!.files ||\n                uiElements.fileInput!.files.length === 0\n            ) {\n                log(\"Select a JSON file first.\");\n                return;\n            }\n            const reader = new FileReader();\n            reader.onload = function () {\n                try {\n                    const text = String(reader.result);\n                    const json = JSON.parse(text);\n                    if (\n                        !json ||\n                        typeof json !== \"object\" ||\n                        json instanceof Array\n                    ) {\n                        log(\n                            \"Invalid JSON structure for tokens (expected an object).\"\n                        );\n                        return;\n                    }\n                    const allowHex = !!(\n                        uiElements.allowHexChk && uiElements.allowHexChk.checked\n                    );\n                    startImportFlow(json, allowHex);\n                } catch (e) {\n                    const msg = e instanceof Error ? e.message : String(e);\n                    log(\"Failed to parse JSON: \" + msg);\n                }\n            };\n            reader.readAsText(uiElements.fileInput!.files[0]);\n        });\n    }\n\n    if (uiElements.exportBtn) {\n        uiElements.exportBtn.addEventListener(\"click\", async () => {\n            let exportAll = false;\n            if (uiElements.exportAllChk)\n                exportAll = !!uiElements.exportAllChk.checked;\n\n            const styleDictionary = !!(\n                uiElements.styleDictionaryChk &&\n                uiElements.styleDictionaryChk.checked\n            );\n            const flatTokens = !!(\n                uiElements.flatTokensChk && uiElements.flatTokensChk.checked\n            );\n\n            const payload: {\n                exportAll: boolean;\n                collection?: string;\n                mode?: string;\n                styleDictionary?: boolean;\n                flatTokens?: boolean;\n            } = { exportAll, styleDictionary, flatTokens };\n            if (\n                !exportAll &&\n                uiElements.collectionSelect &&\n                uiElements.modeSelect\n            ) {\n                payload.collection = uiElements.collectionSelect.value;\n                payload.mode = uiElements.modeSelect.value;\n                if (!(payload.collection && payload.mode)) {\n                    log('Pick collection and mode or use \"Export all\".');\n                    return;\n                }\n            }\n\n            const suggestedName = exportAll\n                ? \"tokens.json\"\n                : prettyExportName(\n                      `${payload.collection ?? \"Tokens\"}_mode=${\n                          payload.mode ?? \"Mode 1\"\n                      }.tokens.json`\n                  );\n\n            await beginPendingSave(suggestedName);\n\n            postToPlugin({ type: \"EXPORT_DTCG\", payload });\n            if (exportAll) log(\"Export all requested.\");\n            else\n                log(\n                    `Export requested for \"${payload.collection || \"\"}\" / \"${\n                        payload.mode || \"\"\n                    }\".`\n                );\n        });\n    }\n\n    if (uiElements.exportTypographyBtn) {\n        uiElements.exportTypographyBtn.addEventListener(\"click\", async () => {\n            await beginPendingSave(\"typography.json\");\n            postToPlugin({ type: \"EXPORT_TYPOGRAPHY\" });\n            log(\"Typography export requested.\");\n        });\n    }\n\n    if (uiElements.drawerToggleBtn) {\n        uiElements.drawerToggleBtn.addEventListener(\"click\", () => {\n            const current =\n                uiElements.drawerToggleBtn!.getAttribute(\"aria-expanded\") ===\n                \"true\";\n            setDrawerOpen(!current);\n        });\n    }\n\n    if (uiElements.collectionSelect) {\n        uiElements.collectionSelect.addEventListener(\"change\", () => {\n            onCollectionChange();\n            if (uiElements.collectionSelect && uiElements.modeSelect) {\n                postToPlugin({\n                    type: \"SAVE_LAST\",\n                    payload: {\n                        collection: uiElements.collectionSelect.value,\n                        mode: uiElements.modeSelect.value,\n                    },\n                });\n                requestPreviewForCurrent();\n            }\n            githubUi.onSelectionChange();\n        });\n    }\n\n    if (uiElements.modeSelect) {\n        uiElements.modeSelect.addEventListener(\"change\", () => {\n            if (uiElements.collectionSelect && uiElements.modeSelect) {\n                postToPlugin({\n                    type: \"SAVE_LAST\",\n                    payload: {\n                        collection: uiElements.collectionSelect.value,\n                        mode: uiElements.modeSelect.value,\n                    },\n                });\n            }\n            setDisabledStates();\n            requestPreviewForCurrent();\n            githubUi.onSelectionChange();\n        });\n    }\n\n    if (uiElements.copyRawBtn)\n        uiElements.copyRawBtn.addEventListener(\"click\", () =>\n            copyElText(uiElements.rawEl, \"Raw Figma Collections\")\n        );\n    if (uiElements.copyW3cBtn)\n        uiElements.copyW3cBtn.addEventListener(\"click\", () =>\n            copyElText(uiElements.w3cPreviewEl, \"W3C Preview\")\n        );\n    if (uiElements.copyLogBtn)\n        uiElements.copyLogBtn.addEventListener(\"click\", () =>\n            copyElText(uiElements.logEl, \"Log\")\n        );\n\n    githubUi.onSelectionChange();\n    autoFitOnce();\n\n    if (uiElements.rawEl)\n        uiElements.rawEl.textContent = \"Loading variable collections\u2026\";\n    setDisabledStates();\n    setDrawerOpen(getSavedDrawerOpen());\n    postToPlugin({ type: \"UI_READY\" });\n\n    // Poll for updates (heartbeat)\n    setInterval(() => {\n        postToPlugin({ type: \"PING\" });\n    }, 500);\n});\n\n/* -------------------------------------------------------\n * Drawer helpers\n * ----------------------------------------------------- */\n/** Persist drawer state and adjust CSS hooks so the UI animates correctly. */\nfunction setDrawerOpen(open: boolean): void {\n    if (uiElements.shellEl) {\n        if (open) uiElements.shellEl.classList.remove(\"drawer-collapsed\");\n        else uiElements.shellEl.classList.add(\"drawer-collapsed\");\n    }\n    if (uiElements.drawerToggleBtn) {\n        uiElements.drawerToggleBtn.setAttribute(\n            \"aria-expanded\",\n            open ? \"true\" : \"false\"\n        );\n        uiElements.drawerToggleBtn.textContent = open ? \"Hide\" : \"Show\";\n        uiElements.drawerToggleBtn.title = open ? \"Hide log\" : \"Show log\";\n    }\n    try {\n        window.localStorage.setItem(\"drawerOpen\", open ? \"1\" : \"0\");\n    } catch {\n        /* ignore */\n    }\n}\n\n/** Load the saved drawer state flag from local storage. */\nfunction getSavedDrawerOpen(): boolean {\n    try {\n        const v = window.localStorage.getItem(\"drawerOpen\");\n        if (v === \"0\") return false;\n        if (v === \"1\") return true;\n    } catch {\n        /* ignore */\n    }\n    return true;\n}\n"],
  "mappings": "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",
  "names": ["e"]
}
